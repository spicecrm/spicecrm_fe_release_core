/** 
 * Â© 2015 - 2020 aac services k.s. All rights reserved.
 * release: 2020.04.001
 * date: 2020-12-17 12:49:07
 * build: 2020.04.001.1608205747102
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,s,t,o){var i,l=arguments.length,n=l<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,s,t,o);else for(var c=e.length-1;0<=c;c--)(i=e[c])&&(n=(l<3?i(n):3<l?i(s,t,n):i(s,t))||n);return 3<l&&n&&Object.defineProperty(s,t,n),n},__metadata=this&&this.__metadata||function(e,s){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,s)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleExchange=exports.ExchangeUserSettings=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),services_1=require("../../services/services"),ExchangeUserSettings=function(){function ExchangeUserSettings(e,s,t,o){this.metadata=e,this.model=s,this.backend=t,this.configuration=o,this.subscriptionOptions=["contacts","calendar","tasks"],this.subscriptions=[],this.modules=[],this.userconfig=[];o=this.configuration.getCapabilityConfig("ewsconfig");o&&o.subscriptiontimeout&&(this.subscriptiontimeout=parseInt(o.subscriptiontimeout,10))}return ExchangeUserSettings.prototype.ngOnInit=function(){this.getConfig()},ExchangeUserSettings.prototype.getConfig=function(){var s=this;this.backend.getRequest("spicecrmexchange/config/"+this.model.id).subscribe(function(e){s.modules=e.modules,s.userconfig=e.userconfig,s.subscriptions=e.subscriptions})},ExchangeUserSettings.prototype.timedout=function(e){var s=new moment;return new moment(e).add(this.subscriptiontimeout,"m").isBefore(s)},ExchangeUserSettings.prototype.lastActive=function(s){var e=this.subscriptions.find(function(e){return e.folder_id==s});return e?e.last_active:""},ExchangeUserSettings.prototype.getModuleNameById=function(e){return this.metadata.getModuleById(e)},ExchangeUserSettings.prototype.isActive=function(s){return this.userconfig&&0<=this.userconfig.findIndex(function(e){return e.sysmodule_id==s})},ExchangeUserSettings.prototype.toggleActive=function(e,s){var t=this;s?this.backend.postRequest("spicecrmexchange/config/"+this.model.id+"/"+e).subscribe(function(e){t.userconfig=e.userconfig,t.subscriptions=e.subscriptions,t.configuration.setData("exchangeuserconfig",t.userconfig)}):this.backend.deleteRequest("spicecrmexchange/config/"+this.model.id+"/"+e).subscribe(function(e){t.userconfig=e.userconfig,t.subscriptions=e.subscriptions,t.configuration.setData("exchangeuserconfig",t.userconfig)})},__decorate([core_1.Component({template:'<h2 class="slds-text-heading_small"><system-label label="LBL_EXCHANGE_SETTINGS"></system-label></h2><system-collapsable-tab tabtitle="LBL_MODULES" [collapsible]="false"><table width="100%" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped slds-size--1-of-1"><thead><tr class="slds-line-height_reset"><th scope="col"><div class="slds-truncate"><system-label label="LBL_MODULE"></system-label></div></th><th scope="col"><div class="slds-truncate"><system-label label="LBL_ACTIVE"></system-label></div></th></tr></thead><tbody><tr *ngFor="let module of modules" class="slds-hint-parent"><td><div class="slds-truncate"><system-label-modulename [module]="getModuleNameById(module.sysmodule_id)"></system-label-modulename></div></td><td><div class="slds-form-element"><label class="slds-checkbox_toggle slds-grid"><span class="slds-form-element__label slds-m-bottom_none"></span> <input type="checkbox" [ngModel]="isActive(module.sysmodule_id)" (ngModelChange)="toggleActive(module.sysmodule_id, $event)"> <span class="slds-checkbox_faux_container" aria-live="assertive"><span class="slds-checkbox_faux" style="cursor: initial"></span></span></label></div></td></tr></tbody></table></system-collapsable-tab><system-collapsable-tab tabtitle="LBL_SUBSCRIPTIONS" [collapsible]="false"><table width="100%" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped slds-size--1-of-1"><thead><tr class="slds-line-height_reset"><th scope="col"><div class="slds-truncate"><system-label label="LBL_FOLDER"></system-label></div></th><th scope="col"><div class="slds-truncate"><system-label label="LBL_LAST_ACTIVE_GMT"></system-label></div></th><th scope="col"><div class="slds-truncate"><system-label label="LBL_SUBSCRIPTION_ID"></system-label></div></th></tr></thead><tbody><tr *ngFor="let subscription of subscriptions" class="slds-hint-parent"><td><div class="slds-truncate">{{subscription.folder_id}}</div></td><td><div class="slds-truncate slds-badge" [ngClass]="{\'slds-theme--error\': timedout(subscription.last_active)}">{{subscription.last_active}}</div></td><td><div class="slds-truncate">{{subscription.subscriptionid}}</div></td></tr></tbody></table></system-collapsable-tab>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.backend,services_1.configurationService])],ExchangeUserSettings)}();exports.ExchangeUserSettings=ExchangeUserSettings;var ModuleExchange=function(){function ModuleExchange(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,systemcomponents_1.SystemComponents,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents],declarations:[ExchangeUserSettings]})],ModuleExchange)}();exports.ModuleExchange=ModuleExchange;