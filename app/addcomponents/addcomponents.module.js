/*
SpiceUI 1.1.0

This file is part of SpiceCRM in its "More" Editions and thus is licensed and copyrighted software. Your installation or use of this SpiceCRM file is subject to the license agreement you entered regaridng the use of SpiceCRM with aac services k.s or any of its affiliates and partners.

If you are unsure about your licese agreement please contat aac services k.s. at office@all-about-crm.com

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
*/

"use strict";var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__decorate=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;0<=n;n--)(o=e[n])&&(a=(r<3?o(a):3<r?o(t,s,a):o(t,s))||a);return 3<r&&a&&Object.defineProperty(t,s,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),forms_1=require("@angular/forms"),core_1=require("@angular/core"),services_1=require("../services/services"),services_2=require("../services/services"),services_3=require("../services/services"),services_4=require("../services/services"),services_5=require("../services/services"),services_6=require("../services/services"),services_7=require("../services/services"),services_8=require("../services/services"),services_9=require("../services/services"),services_10=require("../services/services"),services_11=require("../services/services"),services_12=require("../services/services"),services_13=require("../services/services"),services_14=require("../services/services"),services_15=require("../services/services"),services_16=require("../services/services"),router_1=require("@angular/router"),spiceprocess=function(){function e(e){this.backend=e,this.module="",this.id="",this.stages=[],this.drop$=new core_1.EventEmitter}return e.prototype.getStages=function(){var t=this;this.backend.getRequest("spicebeanguide/"+this.module+(""!==this.id?"/"+this.id:"")).subscribe(function(e){t.stages=e})},e.prototype.getStageData=function(t){var s={};return this.stages.some(function(e){if(e.stage==t)return s=e.stagedata,!0}),s},e.prototype.dropitem=function(e,t){this.drop$.emit({id:e,stage:t})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_12.backend])],e)}();exports.spiceprocess=spiceprocess;var objectfields_1=require("../objectfields/objectfields"),systemcomponents_1=require("../systemcomponents/systemcomponents"),objectcomponents_1=require("../objectcomponents/objectcomponents"),SpiceProcess=function(){function SpiceProcess(e,t,s){var i=this;this.broadcast=e,this.model=t,this.spiceprocess=s,this.componentconfig={},this.coachingVisible=!0,this.currentStage="",this.opportunityStage="",this.broadcast.message$.subscribe(function(e){i.handleMessage(e)})}return SpiceProcess.prototype.ngOnInit=function(){this.componentconfig.defaults&&!1===this.componentconfig.coachingVisible&&(this.coachingVisible=this.componentconfig.coachingVisible)},SpiceProcess.prototype.ngAfterViewInit=function(){this.spiceprocess.module=this.model.module,this.currentStage=this.model.data.sales_stage,this.spiceprocess.id=this.model.id,this.spiceprocess.getStages()},SpiceProcess.prototype.handleMessage=function(e){if(e.messagedata.module===this.model.module&&e.messagedata.id===this.model.id)switch(e.messagetype){case"model.loaded":case"model.save":this.currentStage=this.model.data.sales_stage,this.opportunityStage=this.model.data.sales_stage}},SpiceProcess.prototype.toggleCoaching=function(){this.coachingVisible=!this.coachingVisible},SpiceProcess.prototype.getContainerStyle=function(){if(!this.coachingVisible)return{height:"0px","padding-top":"0px","padding-bottom":"0px"}},SpiceProcess.prototype.getButtonclass=function(){if(this.coachingVisible)return"slds-flip--vertical"},SpiceProcess.prototype.setActive=function(e){this.currentStage=e},SpiceProcess.prototype.getStageDescription=function(){var t=this,s="";return this.spiceprocess.stages.some(function(e){if(t.currentStage===e.stage)return s=e.stagedata.stage_description,!0}),s},SpiceProcess.prototype.getStageClass=function(t){var s=this,i=!1,o="";return this.spiceprocess.stages.some(function(e){if(t===e.stage)return o=i?"slds-is-incomplete":t==s.opportunityStage?"slds-is-current":"slds-is-complete",!0;e.stage===s.opportunityStage&&(i=!0)}),t===this.currentStage&&(o+=" slds-is-active"),o},SpiceProcess.prototype.getChecks=function(){var t=this,s=[];return this.spiceprocess.stages.some(function(e){if(e.stage===t.currentStage)return s=e.stagedata.checks,!0}),s},SpiceProcess=__decorate([core_1.Component({selector:"spice-process",template:'<div class="slds-path-coach" style="margin: 32px 16px 16px 16px; border-top: #d8dde6 1px solid;" [ngStyle]="getContainerStyle()"><div class="slds-grid" style="margin-top:-16px"><button [ngClass]="getButtonclass()" class="slds-button slds-button--icon-border-filled slds-path__trigger slds-no-flex slds-m-horizontal--small" (click)="toggleCoaching()"><system-button-icon [icon]="\'chevrondown\'"></system-button-icon></button><div class="slds-tabs--path" role="application"><ul class="slds-tabs--path__nav" role="tablist"><li *ngFor="let stage of spiceprocess.stages" class="slds-tabs--path__item" [ngClass]="getStageClass(stage.stage)" role="presentation" (click)="setActive(stage.stage)"><a class="slds-tabs--path__link" aria-selected="false" role="tab" href="javascript:void(0);" aria-live="assertive"><span class="slds-tabs--path__stage"><system-icon [icon]="\'check\'" [size]="\'x-small\'" [sprite]="\'utility\'" [addclasses]="\'spicecrm-processicon\'"></system-icon></span> <span class="slds-tabs--path__title">{{stage.stagedata.stage_name}}</span></a></li></ul></div><button disabled class="slds-button slds-button--brand slds-path__mark-complete slds-no-flex slds-m-horizontal--small"><system-button-icon [icon]="\'check\'"></system-button-icon>Mark Status as Complete</button></div><div *ngIf="coachingVisible"><div class="slds-tabs--path__content slds-show" role="tabpanel"><div class="slds-grid slds-grid--align-spread"><div class="slds-coach__keys slds-size--1-of-2 slds-m-left--x-large slds-p-vertical--medium"><div class="slds-grid slds-grid--align-spread"><h2 class="slds-text-title--caps slds-p-bottom--small">Checks</h2></div><dl class="slds-dl--horizontal"><ng-container *ngFor="let check of getChecks()"><dt class="slds-coach__item slds-dl--horizontal__label"><system-utility-icon [icon]="check.result ? \'check\' : \'warning\'" [size]="\'x-small\'"></system-utility-icon></dt><dd class="slds-coach__value slds-dl--horizontal__detail">{{check.name}}</dd></ng-container></dl></div><div class="slds-coach__guidance slds-size--1-of-2 slds-m-left--x-large slds-p-vertical--medium" [innerHtml]="getStageDescription()"></div></div></div></div></div>',providers:[spiceprocess]}),__metadata("design:paramtypes",[services_6.broadcast,services_2.model,spiceprocess])],SpiceProcess)}();exports.SpiceProcess=SpiceProcess;var SpiceKanbanStagePipe=function(){function e(e){this.spiceprocess=e}return e.prototype.transform=function(e,t){for(var s=[],i=this.spiceprocess.getStageData(t),o=0,r=e;o<r.length;o++){var a=r[o];a[i.statusfield]&&0==a[i.statusfield].indexOf(t)&&s.push(a)}return s},e=__decorate([core_1.Pipe({name:"spicekanbanstagepipe"}),__metadata("design:paramtypes",[spiceprocess])],e)}();exports.SpiceKanbanStagePipe=SpiceKanbanStagePipe;var SpiceKanban=function(){function SpiceKanban(e,t,s,i,o,r){var a=this;this.broadcast=e,this.model=t,this.modellist=s,this.spiceprocess=i,this.metadata=o,this.userpreferences=r,this.componentconfig={},this.modellistsubscribe=void 0,this.requestedFields=[],this.spiceprocess.module=this.model.module,this.spiceprocess.getStages(),this.componentconfig=this.metadata.getComponentConfig("SpiceKanban",this.model.module),this.modellistsubscribe=this.modellist.listtype$.subscribe(function(e){return a.switchListtype()}),this.requestedFields=["name","account_name","account_id","sales_stage","amount_usdollar","amount"],this.modellist.getListData(this.requestedFields)}return SpiceKanban.prototype.ngOnDestroy=function(){this.modellistsubscribe.unsubscribe()},SpiceKanban.prototype.switchListtype=function(){this.modellist.getListData(this.requestedFields)},SpiceKanban.prototype.showSum=function(){return""!==this.componentconfig.sum},SpiceKanban.prototype.getContainerStyle=function(){return{"margin-right":"-12px","padding-right":"6px",height:"calc(100vh - "+this.oppContainer.element.nativeElement.getBoundingClientRect().top+"px)"}},Object.defineProperty(SpiceKanban.prototype,"sizeClass",{get:function(){return"slds-size--1-of-"+this.spiceprocess.stages.length},enumerable:!0,configurable:!0}),SpiceKanban.prototype.getColumnStyle=function(){return{width:this.oppContainer.element.nativeElement.getBoundingClientRect().width/this.spiceprocess.stages.length}},SpiceKanban.prototype.getStageCount=function(e){for(var t=this.spiceprocess.getStageData(e),s=0,i=0,o=this.modellist.listData.list;i<o.length;i++){var r=o[i];r[t.statusfield]&&0==r[t.statusfield].indexOf(e)&&s++}return s},SpiceKanban.prototype.getStageSum=function(e){for(var t=this.spiceprocess.getStageData(e),s=0,i=0,o=this.modellist.listData.list;i<o.length;i++){var r=o[i];r[t.statusfield]&&0==r[t.statusfield].indexOf(e)&&(s+=parseFloat(r[this.componentconfig.sum]))}return this.userpreferences.formatMoney(s,0)},SpiceKanban.prototype.getStageItems=function(e){for(var t=this.spiceprocess.getStageData(e),s=[],i=0,o=this.modellist.listData.list;i<o.length;i++){var r=o[i];r[t.statusfield]&&0==r[t.statusfield].indexOf(e)&&s.push(r)}return s},SpiceKanban.prototype.getMoney=function(e){return this.userpreferences.formatMoney(parseFloat(e),0)},SpiceKanban.prototype.onScroll=function(e){var t=this.oppContainer.element.nativeElement;t.scrollTop+t.clientHeight+50>t.scrollHeight&&this.modellist.loadMoreList()},SpiceKanban.prototype.ondragover=function(e){e.preventDefault()},SpiceKanban.prototype.ondrop=function(e,t){var s=e.dataTransfer.getData("text");this.spiceprocess.dropitem(s,t)},__decorate([core_1.ViewChild("oppContainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],SpiceKanban.prototype,"oppContainer",void 0),SpiceKanban=__decorate([core_1.Component({selector:"spice-kanban",template:'<div class="slds-m-top--small slds-m-horizontal--small"><div class="slds-tabs--path" role="application"><ul class="slds-tabs--path__nav" role="tablist"><ng-container *ngFor="let stage of spiceprocess.stages"><li class="slds-tabs--path__item slds-is-incomplete" role="presentation"><a class="slds-tabs--path__link" aria-selected="false" role="tab" href="javascript:void(0);" aria-live="assertive"><span class="slds-tabs--path__stage"><system-icon [icon]="\'check\'" [size]="\'x-small\'" [sprite]="\'utility\'" [addclasses]="\'spicecrm-processicon\'"></system-icon></span> <span class="slds-tabs--path__title">{{stage.stagedata.stage_name}} ({{getStageCount(stage.stage)}})</span></a></li></ng-container></ul></div><div *ngIf="this.componentconfig.sum" class="slds-grid" style="border-bottom: 1px solid #d8dde6;"><div *ngFor="let stage of spiceprocess.stages" class="slds-col slds-p-horizontal--xx-small slds-m-top--x-small" [ngClass]="sizeClass"><div *ngIf="showSum()" class="slds-text-heading--medium slds-text-align--center slds-p-vertical--x-small">â‚¬{{getStageSum(stage.stage)}}</div></div></div><div #oppContainer class="slds-scrollable--y" [ngStyle]="getContainerStyle()" (scroll)="onScroll()"><div class="slds-grid"><div *ngFor="let stage of spiceprocess.stages" class="slds-col slds-p-horizontal--xx-small slds-m-top--x-small" [ngClass]="sizeClass" (dragover)="ondragover($event)" (drop)="ondrop($event, stage.stage)"><ul class="slds-has-dividers--around-space slds-m-top--x-small"><li spice-kanban-tile *ngFor="let item of this.modellist.listData.list|spicekanbanstagepipe:stage.stage" draggable [item]="item" class="slds-item"></li></ul></div></div><system-spinner *ngIf="modellist.isLoading"></system-spinner></div></div>',providers:[spiceprocess]}),__metadata("design:paramtypes",[services_6.broadcast,services_2.model,services_4.modellist,spiceprocess,services_1.metadata,services_13.userpreferences])],SpiceKanban)}();exports.SpiceKanban=SpiceKanban;var SpiceKanbanTile=function(){function SpiceKanbanTile(e,t,s,i,o,r,a){var n=this;this.broadcast=e,this.modellist=t,this.model=s,this.view=i,this.modelutilities=o,this.metadata=r,this.spiceprocess=a,this.item={},this.componentconfig={},this.componentFields={},this.dropsubscription={},this.componentconfig=this.metadata.getComponentConfig("SpiceKanbanTile",this.modellist.module),this.componentFields=this.metadata.getFieldSetFields(this.componentconfig.fieldset),this.dropsubscription=this.spiceprocess.drop$.subscribe(function(e){n.handelDrop(e)}),this.view.labels="short"}return SpiceKanbanTile.prototype.ngOnDestroy=function(){this.dropsubscription.unsubscribe()},SpiceKanbanTile.prototype.handelDrop=function(e){e.id==this.model.id&&(this.model.startEdit(),this.model.data.sales_stage=e.stage,this.model.edit())},SpiceKanbanTile.prototype.ngOnInit=function(){this.model.module=this.modellist.module,this.model.id=this.item.id,this.model.data=this.modelutilities.backendModel2spice(this.modellist.module,this.item)},SpiceKanbanTile.prototype.goDetail=function(){this.model.goDetail()},SpiceKanbanTile.prototype.ondragstart=function(e){e.dataTransfer.setData("text",this.model.id)},SpiceKanbanTile.prototype.allowDrop=function(e){e.preventDefault()},SpiceKanbanTile.prototype.dragleave=function(e){e.preventDefault()},SpiceKanbanTile.prototype.ondrop=function(e){var t=e.dataTransfer.getData("text");this.spiceprocess.dropitem(t,this.model.data.sales_stage)},__decorate([core_1.Input(),__metadata("design:type",Object)],SpiceKanbanTile.prototype,"item",void 0),SpiceKanbanTile=__decorate([core_1.Component({selector:"[spice-kanban-tile]",template:'<div class="slds-tile slds-tile--board"><div class="slds-grid slds-grid--align-spread"><h3 class="slds-truncate" (click)="goDetail()"><a href="javascript:void(0);">{{item.summary_text}}</a></h3><object-action-menu [buttonsize]="\'x-small\'"></object-action-menu></div><div class="slds-tile__detail slds-text-body--small"><field-container *ngIf="componentconfig.amount" [field]="componentconfig.amount" [fielddisplayclass]="\'slds-text-heading--medium\'"></field-container><div class="slds-grid" *ngFor="let componentField of componentFields"><field-label class="slds-truncate" [fieldname]="componentField.field" [fieldconfig]="componentField.fieldconfig"></field-label><field-container class="slds-col--bump-left slds-truncate" [field]="componentField.field" [fieldconfig]="componentField.fieldconfig" [fielddisplayclass]="\'slds-truncate\'"></field-container></div></div></div>',providers:[services_2.model,services_9.view],host:{"[class]":"'slds-item'","(dragstart)":"ondragstart($event)","(drop)":"ondrop($event)"}}),__metadata("design:paramtypes",[services_6.broadcast,services_4.modellist,services_2.model,services_9.view,services_5.modelutilities,services_1.metadata,spiceprocess])],SpiceKanbanTile)}();exports.SpiceKanbanTile=SpiceKanbanTile;var SpiceMap=function(){function SpiceMap(e,t,s,i,o,r,a){this.zone=e,this.language=t,this.model=s,this.modelutilities=i,this.backend=o,this.router=r,this.metadata=a,this.componentconfig={},this.map={},this.mapBoundaries={},this.modelMarker={},this.surroundingFunction={},this.surroundingMarkers=[],this.surroundingObjects=[],this.listfields=[]}return SpiceMap.prototype.getListFields=function(){return this.metadata.getFieldSetFields(this.componentconfig.fieldset)},SpiceMap.prototype.ngAfterViewInit=function(){var t=this;this.metadata.loadLibs("maps.googleapis").subscribe(function(e){t.renderMap()})},Object.defineProperty(SpiceMap.prototype,"latField",{get:function(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_latitude":"address_latitude"},enumerable:!0,configurable:!0}),Object.defineProperty(SpiceMap.prototype,"lngField",{get:function(){return this.componentconfig.key&&""!=this.componentconfig.key?this.componentconfig.key+"_address_longitude":"address_longitude"},enumerable:!0,configurable:!0}),Object.defineProperty(SpiceMap.prototype,"lat",{get:function(){return this.model.data[this.latField]},enumerable:!0,configurable:!0}),Object.defineProperty(SpiceMap.prototype,"lng",{get:function(){return this.model.data[this.lngField]},enumerable:!0,configurable:!0}),SpiceMap.prototype.renderMap=function(){var e=this,t={lat:48.2,lng:16.3};this.lng&&this.lat&&(t={lat:this.lat,lng:this.lng}),this.map=new google.maps.Map(this.mapelement.element.nativeElement,{center:t,scrollwheel:!0,zoom:14,minZoom:8}),this.lng&&this.lat&&(this.modelMarker=new google.maps.Marker({position:t,map:this.map,icon:"http://maps.google.com/mapfiles/ms/micons/red-dot.png",title:this.model.data.summary_text})),this.map.addListener("bounds_changed",function(){e.mapBoundaries=e.map.getBounds(),e.surroundingFunction&&window.clearTimeout(e.surroundingFunction),e.surroundingFunction=window.setTimeout(function(){return e.getSurrounding()},500)})},SpiceMap.prototype.reCenter=function(){this.map.setCenter(this.modelMarker.position)},SpiceMap.prototype.isApiLoaded=function(){return!(!window.google||!window.google.maps)},SpiceMap.prototype.getSurrounding=function(){for(var o=this,e=0,t=this.surroundingMarkers;e<t.length;e++){t[e].setMap(null)}this.surroundingMarkers=[];var s=this.mapBoundaries.getNorthEast(),i=this.mapBoundaries.getSouthWest(),r={join:"AND",conditions:[{field:"id",operator:"<>",value:this.model.id},{field:this.lngField,operator:"<",value:s.lng()},{field:this.latField,operator:"<",value:s.lat()},{field:this.lngField,operator:">",value:i.lng()},{field:this.latField,operator:">",value:i.lat()}]},a={searchfields:JSON.stringify(r),fields:JSON.stringify(["id","name",this.lngField,this.latField])};this.backend.getRequest("module/"+this.model.module,a).subscribe(function(e){for(var t in e.list){for(var s in e.list[t])e.list[t][s]=o.modelutilities.backend2spice(o.model.module,s,e.list[t][s]);var i=new google.maps.Marker({position:{lat:e.list[t][o.latField],lng:e.list[t][o.lngField]},map:o.map,title:e.list[t].summary_text,icon:"http://maps.google.com/mapfiles/ms/micons/green.png",sugarId:e.list[t].id,sugarModule:o.model.module});o.surroundingMarkers.push(i)}o.surroundingObjects=e.list,o.zone.run(function(){})})},SpiceMap.prototype.mouseOver=function(t){this.surroundingMarkers.some(function(e){if(e.sugarId===t)return e.setIcon("http://maps.google.com/mapfiles/ms/micons/yellow-dot.png"),!0})},SpiceMap.prototype.mouseOut=function(t){this.surroundingMarkers.some(function(e){if(e.sugarId===t)return e.setIcon("http://maps.google.com/mapfiles/ms/micons/green.png"),!0})},__decorate([core_1.ViewChild("mapelement",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],SpiceMap.prototype,"mapelement",void 0),SpiceMap=__decorate([core_1.Component({selector:"spice-map",template:'<article class="slds-card slds-card_boundary slds-m-bottom--medium"><div class="slds-card__header slds-grid"><header class="slds-media slds-media--center slds-has-flexi-truncate"><div class="slds-media__body slds-truncate"><h2><span class="slds-text-heading--small">{{language.getLabel(\'LBL_MAP_VIEW\')}} ({{surroundingObjects.length}})</span></h2></div></header><div class="slds-button-group" role="group"><button class="slds-button slds-button--neutral" (click)="reCenter()">{{language.getLabel(\'LBL_RECENTER\')}}</button></div></div><div class="slds-card__body slds-p-horizontal--small"><div #mapelement style="width: 100%; height: 400px; border-radius: 4px; overflow: hidden;"></div><div class="slds-p-top--small"><table class="slds-table slds-table--bordered slds-table--fixed-layout"><thead><tr class="slds-text-title--caps"><th *ngFor="let item of getListFields()" class="slds-is-sortable" scope="col"><a href="javascript:void(0);" class="slds-th__action slds-text-link--reset"><span class="slds-truncate">{{language.getFieldDisplayName(module, item.field, item.fieldconfig)}}</span></a></th><th class="slds-cell-shrink" scope="col"></th></tr></thead><tbody><tr object-related-list-item *ngFor="let surroundingObject of surroundingObjects" [module]="model.module" [listfields]="getListFields()" [listitem]="surroundingObject" class="slds-hint-parent" (mouseenter)="mouseOver(surroundingObject.id)" (mouseleave)="mouseOut(surroundingObject.id)"></tr></tbody></table></div></div></article>',providers:[services_3.relatedmodels]}),__metadata("design:paramtypes",[core_1.NgZone,services_8.language,services_2.model,services_5.modelutilities,services_12.backend,router_1.Router,services_1.metadata])],SpiceMap)}();exports.SpiceMap=SpiceMap;var DhtmlxDiagram=function(){function DhtmlxDiagram(e,t){this.metadata=e,this.libloader=t,this.libloader.load()}return DhtmlxDiagram=__decorate([core_1.Component({selector:"dhtmlx-diagram",template:"dhtmlx"}),__metadata("design:paramtypes",[services_1.metadata,services_16.LibLoaderService])],DhtmlxDiagram)}();exports.DhtmlxDiagram=DhtmlxDiagram;var SpiceTimestream=function(){function SpiceTimestream(e,t,s,i,o,r){var a=this;this.language=e,this.userpreferences=t,this.model=s,this.modellist=i,this.modelutilities=o,this.metadata=r,this.modellistsubscribe=void 0,this.requestedFields=[],this.focusDate=new moment,this.timestream={period:"y",dateStart:null,dateEnd:null},this.modellistsubscribe=this.modellist.listtype$.subscribe(function(e){return a.switchListtype()}),this.requestedFields=["name","account_name","account_id","sales_stage","amount_usdollar","amount"],this.modellist.getListData(this.requestedFields),this.period="y"}return SpiceTimestream.prototype.switchListtype=function(){this.modellist.getListData(this.requestedFields)},Object.defineProperty(SpiceTimestream.prototype,"period",{get:function(){return this.timestream.period},set:function(e){switch(e){case"M":var t=moment(this.focusDate).month();this.timestream.dateStart=new moment(this.focusDate),this.timestream.dateStart.month(t),this.timestream.dateStart.date(1),this.timestream.dateStart.day(0),this.timestream.dateStart.hour(0),this.timestream.dateStart.minute(0),this.timestream.dateEnd=new moment(this.focusDate),this.timestream.dateEnd.month(t),this.timestream.dateEnd.date(31),this.timestream.dateEnd.day(6),this.timestream.dateEnd.hour(23),this.timestream.dateEnd.minute(59);break;case"Q":var s=moment(this.focusDate).month()+1;this.timestream.dateStart=new moment(this.focusDate),this.timestream.dateStart.month(3*Math.floor(s/3)),this.timestream.dateStart.date(1),this.timestream.dateStart.hour(0),this.timestream.dateStart.minute(0),this.timestream.dateEnd=new moment(this.focusDate),this.timestream.dateEnd.month(3*Math.floor(s/3)+3),this.timestream.dateEnd.date(31),this.timestream.dateEnd.hour(23),this.timestream.dateEnd.minute(59);break;case"y":this.timestream.dateStart=new moment(this.focusDate),this.timestream.dateStart.month(0),this.timestream.dateStart.date(1),this.timestream.dateStart.hour(0),this.timestream.dateStart.minute(0),this.timestream.dateEnd=new moment(this.focusDate),this.timestream.dateEnd.month(11),this.timestream.dateEnd.date(31),this.timestream.dateEnd.hour(23),this.timestream.dateEnd.minute(59)}this.timestream.period=e},enumerable:!0,configurable:!0}),Object.defineProperty(SpiceTimestream.prototype,"periodText",{get:function(){switch(this.timestream.period){case"M":return moment(this.timestream.dateStart).day(6).format("MMM/Y");case"Q":return this.timestream.dateStart.format("Q/Y");case"y":return this.timestream.dateStart.format("Y")}},enumerable:!0,configurable:!0}),SpiceTimestream.prototype.prev=function(){this.focusDate.subtract(1,this.timestream.period),this.period=this.timestream.period},SpiceTimestream.prototype.next=function(){this.focusDate.add(1,this.timestream.period),this.period=this.timestream.period},__decorate([core_1.ViewChild("streamwindow",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],SpiceTimestream.prototype,"streamwindow",void 0),SpiceTimestream=__decorate([core_1.Component({selector:"spice-timestream",template:'<div class="slds-grid"><div class="slds-border--right slds-size--1-of-8" style="width:250px;"><div class="slds-border--bottom slds-p-vertical--xx-small slds-p-horizontal--x-small" style="height: 40px;"><div class="slds-grid slds-grid--align-spread slds-grid_vertical-align-center"><div class="slds-form-element slds-p-horizontal--small slds-size--1-of-2"><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="period"><option value="y">{{language.getLabel(\'LBL_YEAR\')}}</option><option value="Q">{{language.getLabel(\'LBL_QUARTER\')}}</option><option value="M">{{language.getLabel(\'LBL_MONTH\')}}</option></select></div></div></div><div class="slds-grid"><button class="slds-button slds-button_icon" (click)="prev()"><system-button-icon [icon]="\'left\'"></system-button-icon></button><div class="slds-p-horizontal--small">{{periodText}}</div><button class="slds-button slds-button_icon" (click)="next()"><system-button-icon [icon]="\'right\'"></system-button-icon></button></div></div></div><div *ngFor="let item of modellist.listData.list" class="slds-border--bottom slds-p-vertical--xx-small slds-p-horizontal--x-small" style="height: 34px;" spice-timestream-label [item]="item" [parentmodel]="model"></div></div><div #streamwindow class="slds-size--7-of-8"><div style="height: 40px;" spice-timestream-header [timestream]="timestream"></div><div *ngFor="let item of modellist.listData.list" spice-timestream-item [timestream]="timestream" [elementstart]="item.start_date" [elementend]="item.end_date" style="height: 34px;"></div></div></div>'}),__metadata("design:paramtypes",[services_8.language,services_13.userpreferences,services_2.model,services_4.modellist,services_5.modelutilities,services_1.metadata])],SpiceTimestream)}();exports.SpiceTimestream=SpiceTimestream;var SpiceTimestreamHeader=function(){function e(e,t){this.elementRef=e,this.userpreferences=t,this.timestream={},this.dateElements=[]}return Object.defineProperty(e.prototype,"startDate",{get:function(){return this.timestream.datestart.format(this.userpreferences.getDateFormat())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return this.timestream.dateend.format(this.userpreferences.getDateFormat())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.elementRef.nativeElement.parentElement.getBoundingClientRect().width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"periods",{get:function(){var e=[],t=0;switch(this.timestream.period){case"M":for(var s=moment(this.timestream.dateStart);s.isSameOrBefore(this.timestream.dateEnd);)e.push({name:s.format("DD"),displayclass:0==s.day()||6==s.day()?"slds-theme_shade":""}),s.add(1,"d");break;case"Q":for(;t<3;){var i=(new moment).month(this.timestream.dateStart.month()+t);e.push({name:i.format("MMM")}),t++}break;case"y":for(;t<12;){i=(new moment).month(t);e.push({name:i.format("MMM")}),t++}}return e},enumerable:!0,configurable:!0}),e.prototype.getPeriodStyle=function(){return{width:"calc(100% / "+this.periods.length+")"}},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"timestream",void 0),e=__decorate([core_1.Component({selector:"[spice-timestream-header]",template:'<div class="slds-grid slds-border--top slds-border--bottom" style="height: 100%"><div *ngFor="let period of periods; let i = index" class="slds-border--right" [ngStyle]="getPeriodStyle()" [ngClass]="period.displayclass"><div class="slds-align--absolute-center" style="height: 100%">{{period.name}}</div></div></div>'}),__metadata("design:paramtypes",[core_1.ElementRef,services_13.userpreferences])],e)}();exports.SpiceTimestreamHeader=SpiceTimestreamHeader;var SpiceTimestreamLabel=function(){function e(e,t,s,i){this.elementRef=e,this.metadata=t,this.model=s,this.footer=i,this.item={},this.parentmodel={},this.showPopover=!1,this.showPopoverTimeout={},this.popoverCmp=null}return e.prototype.ngOnInit=function(){this.model.module=this.parentmodel.module,this.model.id=this.item.id,this.model.data=this.item},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.renderPopover()},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.destroyPopover()},e.prototype.renderPopover=function(){var t=this;this.metadata.addComponent("fieldModelFooterPopover",this.footer.footercontainer).subscribe(function(e){e.instance.popovermodule=t.parentmodel.module,e.instance.popoverid=t.item.id,e.instance.parentElementRef=t.elementRef,e.instance.self=e,t.popoverCmp=e})},e.prototype.destroyPopover=function(){this.popoverCmp&&this.popoverCmp.destroy()},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"parentmodel",void 0),e=__decorate([core_1.Component({selector:"[spice-timestream-label]",template:'<div class="slds-grid slds-grid--align-spread slds-grid_vertical-align-center"><div class="slds-text-link_reset" (mouseover)="onMouseOver()" (mouseout)="onMouseOut()">{{item.name}}</div><object-action-menu [buttonsize]="\'small\'"></object-action-menu></div>',providers:[services_2.model,services_9.view]}),__metadata("design:paramtypes",[core_1.ElementRef,services_1.metadata,services_2.model,services_14.footer])],e)}();exports.SpiceTimestreamLabel=SpiceTimestreamLabel;var SpiceTimestreamItem=function(){function e(e,t){this.elementRef=e,this.userpreferences=t,this.timestream={},this.elementstart={},this.elementend={}}return Object.defineProperty(e.prototype,"displayItem",{get:function(){return this.elementstart&&this.elementend&&this.elementstart.isBefore(this.elementend)&&this.elementstart.isBefore(this.timestream.dateEnd)&&this.elementend.isAfter(this.timestream.dateStart)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startdate",{get:function(){return this.elementstart.isBefore(this.timestream.dateStart)?this.timestream.dateStart:this.elementstart},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enddate",{get:function(){return this.elementend.isAfter(this.timestream.dateEnd)?this.timestream.dateEnd:this.elementend},enumerable:!0,configurable:!0}),e.prototype.getStart=function(){var e=this.timestream.dateEnd.diff(this.timestream.dateStart,"days");return this.startdate.diff(this.timestream.dateStart,"days")/e*100},e.prototype.getWidth=function(){var e=this.timestream.dateEnd.diff(this.timestream.dateStart,"days");return this.enddate.diff(this.startdate,"days")/e*100},e.prototype.getElementStyle=function(){return{left:this.getStart()+"%",width:this.getWidth()+"%"}},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"timestream",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"elementstart",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"elementend",void 0),e=__decorate([core_1.Component({selector:"[spice-timestream-item]",template:'<div class="slds-grid slds-border--bottom slds-is-relative" style="height: 100%"><div *ngIf="displayItem" class="slds-is-absolute slds-theme--shade" style="height:10px; top: 11px; border-radius: 3px; background-color: #CA1B1F;" [ngStyle]="getElementStyle()"></div></div>'}),__metadata("design:paramtypes",[core_1.ElementRef,services_13.userpreferences])],e)}();exports.SpiceTimestreamItem=SpiceTimestreamItem;var SpiceTerritorriesDetail=function(){function SpiceTerritorriesDetail(e,t,s,i,o,r,a){this.language=e,this.model=t,this.modelutilities=s,this.configuration=i,this.backend=o,this.router=r,this.metadata=a,this.expanded=!0}return SpiceTerritorriesDetail.prototype.togglePanel=function(){this.expanded=!this.expanded},SpiceTerritorriesDetail.prototype.getChevronStyle=function(){if(!this.expanded)return{transform:"rotate(45deg)","margin-top":"4px"}},SpiceTerritorriesDetail.prototype.getTabStyle=function(){if(!this.expanded)return{"margin-top":"-100%"}},SpiceTerritorriesDetail.prototype.getContainerStyle=function(){return{overflow:"hidden"}},SpiceTerritorriesDetail=__decorate([core_1.Component({selector:"spice-territorries-detail",template:'<div class="slds-panel__section slds-p-horizontal--none slds-p-vertical--none"><h3 class="slds-text-heading--small slds-section-title--divider slds-m-bottom--medium"><div class="panelChevron" (click)="togglePanel()" [ngStyle]="getChevronStyle()"></div>Territorry management</h3><div class="slds-p-horizontal--small slds-grid" [ngStyle]="getContainerStyle()"><div class="spicecrm-object-record-details-tab-row-field slds-size--1-of-2"><field-label [fieldname]="\'korgobjectmain\'"></field-label><spice-territorries-primary></spice-territorries-primary></div><div class="spicecrm-object-record-details-tab-row-field slds-size--1-of-2"><field-label [fieldname]="\'korgobjectmultiple\'"></field-label><spice-territories-additional></spice-territories-additional></div></div></div>'}),__metadata("design:paramtypes",[services_8.language,services_2.model,services_5.modelutilities,services_7.configurationService,services_12.backend,router_1.Router,services_1.metadata])],SpiceTerritorriesDetail)}();exports.SpiceTerritorriesDetail=SpiceTerritorriesDetail;var tfieldGeneric=function(){function e(e,t,s,i,o){this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=o,this.fieldname="",this.fieldconfig={},this.fieldid="",this.fielddisplayclass="",this.fieldid=this.model.generateGuid()}return e.prototype.isEditable=function(){return!(!this.view.isEditable||this.fieldconfig.readonly||this.model.data&&this.model.data.acl_fieldcontrol&&this.model.data.acl_fieldcontrol[this.fieldname]&&parseInt(this.model.data.acl_fieldcontrol[this.fieldname])<3)},e.prototype.isEditMode=function(){return!("edit"!==this.view.mode||!this.isEditable())},e.prototype.displayLink=function(){try{return this.fieldconfig.link&&this.model.data.acl.detail}catch(e){return!1}},e.prototype.setEditMode=function(){this.model.startEdit(),this.view.setEditMode()},e.prototype.getFieldClass=function(){return[]},e.prototype.setFieldError=function(e){},e.prototype.getFieldError=function(){},e.prototype.clearFieldError=function(){},e.prototype.fieldHasError=function(){return!1},e.prototype.goRecord=function(){this.router.navigate(["/module/"+this.model.module+"/"+this.model.id])},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldconfig",void 0),e=__decorate([core_1.Component({}),__metadata("design:paramtypes",[services_2.model,services_9.view,services_8.language,services_1.metadata,router_1.Router])],e)}(),SpiceTerritorriesPrimary=function(c){function e(e,t,s,i,o,r,a,n,l){var d=c.call(this,e,t,i,o,r)||this;return d.model=e,d.view=t,d.popup=s,d.language=i,d.metadata=o,d.router=r,d.elementRef=a,d.renderer=n,d.territories=l,d.relateSearchOpen=!1,d.objectsearchterm="",d.showPopover=!1,d.showPopoverTimeout={},d.popup.closePopup$.subscribe(function(){return d.closePopups()}),d}return __extends(e,c),e.prototype.getTerritorryName=function(){return this.model.data.korgobjectmain?this.territories.getTerritoryName(this.model.module,this.model.data.korgobjectmain):""},e.prototype.canRemove=function(){return this.territories.isUserTerritory(this.model.module,this.model.data.korgobjectmain)},e.prototype.getTerritories=function(){for(var e=[],t=0,s=this.territories.userTerritories[this.model.module];t<s.length;t++){var i=s[t];(""===this.objectsearchterm||""!==this.objectsearchterm&&-1!==i.name.toLowerCase().indexOf(this.objectsearchterm.toLowerCase()))&&e.push(i)}return e},e.prototype.setTerritory=function(e){this.model.data.korgobjectmain=e,this.closePopups()},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},e.prototype.closePopups=function(){this.clickListener(),this.model.data.korgobjectmain&&(this.objectsearchterm=""),this.relateSearchOpen=!1},e.prototype.clearField=function(){this.model.data.korgobjectmain=""},e.prototype.onFocus=function(){var t=this;this.relateSearchOpen=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},e.prototype.relateSearchStyle=function(){if(this.relateSearchOpen)return{width:this.elementRef.nativeElement.getBoundingClientRect().width+"px",display:"block"}},e.prototype.getPopoverStyle=function(){var e=this.elementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return{position:"fixed",top:e.top+(e.height-t.height)/2+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-15+"px",display:this.showPopover?"":"none"}},e.prototype.getPopoverSide=function(){var e=this.elementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return e.left<t.width?"right":"left"},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.showPopover=!0},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.showPopover=!1},__decorate([core_1.ViewChild("popover",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"popover",void 0),e=__decorate([core_1.Component({selector:"spice-territorries-primary",template:'<div class="slds-truncate" title="{{field}}"><p *ngIf="!isEditMode()" class="slds-text-body--regular slds-truncate slds-p-vertical--x-small slds-border--bottom"><span>{{getTerritorryName()}}</span> <button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon" (click)="view.setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></p><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-form-element slds-lookup"><div *ngIf="model.data.korgobjectmain" class="slds-form-element__control"><div class="slds-pill_container"><span class="slds-pill slds-m-vertical--xxx-small slds-p-vertical--xx-small slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-hierarchy slds-pill__icon_container"><system-icon [icon]="\'hierarchy\'" [sprite]="\'standard\'" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{getTerritorryName()}}</span> <button *ngIf="canRemove()" class="slds-button slds-button--icon slds-pill__remove" (click)="clearField()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!model.data.korgobjectmain" class="slds-form-element__control slds-grid slds-box--border" [ngClass]="getFieldClass()"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow slds-m-vertical--xxx-small"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="objectsearchterm" (focus)="onFocus()" [placeholder]="language.getLabel(\'LBL_SEARCH\') + \' \' + language.getLabel(\'LBL_TERRITORY\')" role="combobox"></div></div></div><div *ngIf="relateSearchOpen" class="slds-lookup__menu" [ngStyle]="relateSearchStyle()"><ul class="slds-lookup__list" role="listbox"><li *ngFor="let territory of getTerritories()" role="presentation" (click)="setTerritory(territory.id)"><span class="slds-lookup__item-action slds-media" role="option"><div class="slds-media__body"><div class="slds-lookup__result-text">{{territory.name}}</div></div></span></li><li *ngIf="getTerritories().length === 0"><span class="slds-lookup__item-action slds-media" role="option"><div class="slds-media__body"><div class="slds-lookup__result-text">no territory found</div></div></span></li></ul></div></div></div>',providers:[services_10.popup],host:{}}),__metadata("design:paramtypes",[services_2.model,services_9.view,services_10.popup,services_8.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer,services_11.territories])],e)}(exports.tfieldGeneric=tfieldGeneric);exports.SpiceTerritorriesPrimary=SpiceTerritorriesPrimary;var SpiceTerritoriesAdditional=function(c){function e(e,t,s,i,o,r,a,n,l){var d=c.call(this,e,t,i,o,r)||this;return d.model=e,d.view=t,d.popup=s,d.language=i,d.metadata=o,d.router=r,d.elementRef=a,d.renderer=n,d.territories=l,d.territorySearchOpen=!1,d.objectsearchterm="",d.showPopover=!1,d.showPopoverTimeout={},d.searchObjects=!1,d.popup.closePopup$.subscribe(function(){return d.closePopups()}),d}return __extends(e,c),e.prototype.getTerritoryName=function(e){return this.territories.getTerritoryName(this.model.module,e)},e.prototype.getTerritorryNames=function(){var e=[];if(this.model.data.korgobjectmultiple)for(var t=0,s=JSON.parse(this.model.data.korgobjectmultiple).secondary;t<s.length;t++){var i=s[t];e.push(this.getTerritoryName(i))}return e.join(", ")},e.prototype.getAdditonalTerritories=function(){var e=[];if(this.model.data.korgobjectmultiple)for(var t=0,s=JSON.parse(this.model.data.korgobjectmultiple).secondary;t<s.length;t++){var i=s[t];e.push({id:i,name:this.getTerritoryName(i)})}return e},e.prototype.getTerritories=function(){var e=[],t={primary:this.model.data.korgobjectmain,secondary:[]};if(""!==this.model.data.korgobjectmultiple)JSON.parse(this.model.data.korgobjectmultiple);for(var s=0,i=this.territories.userTerritories[this.model.module];s<i.length;s++){var o=i[s];-1===t.secondary.indexOf(o.id)&&o.id!==t.primary&&(""===this.objectsearchterm||""!==this.objectsearchterm&&-1!==o.name.toLowerCase().indexOf(this.objectsearchterm.toLowerCase()))&&e.push(o)}return e},e.prototype.addTerritory=function(e){var t={primary:this.model.data.korgobjectmain,secondary:[]};this.model.data.korgobjectmultiple&&(t=JSON.parse(this.model.data.korgobjectmultiple)),t.secondary.push(e.id),this.model.data.korgobjectmultiple=JSON.stringify(t),this.territorySearchOpen=!1},e.prototype.canRemove=function(e){return this.territories.isUserTerritory(this.model.module,e)},e.prototype.startSearch=function(){var t=this;this.searchObjects=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.closePopups(),this.searchObjects=!1,this.territorySearchOpen=!1)},e.prototype.closePopups=function(){this.clickListener(),this.model.data.korgobjectmain&&(this.objectsearchterm=""),this.searchObjects=!1},e.prototype.removeTerritory=function(s){var i=JSON.parse(this.model.data.korgobjectmultiple);i.secondary.some(function(e,t){if(e===s)return i.secondary.splice(t,1),!0}),this.model.data.korgobjectmultiple=JSON.stringify(i)},e.prototype.onFocus=function(){this.territorySearchOpen=!0},e.prototype.relateSearchStyle=function(){if(this.territorySearchOpen)return{width:this.elementRef.nativeElement.getBoundingClientRect().width+"px",display:"block"}},e.prototype.getPopoverStyle=function(){var e=this.elementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return{position:"fixed",top:e.top+(e.height-t.height)/2+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-15+"px",display:this.showPopover?"":"none"}},e.prototype.getPopoverSide=function(){var e=this.elementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return e.left<t.width?"right":"left"},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.showPopover=!0},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.showPopover=!1},__decorate([core_1.ViewChild("popover",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"popover",void 0),e=__decorate([core_1.Component({selector:"spice-territories-additional",template:'<div title="{{field}}"><p *ngIf="!isEditMode()" class="slds-text-body--regular slds-truncate slds-p-vertical--x-small slds-border--bottom"><span>{{getTerritorryNames()}}</span> <button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon" (click)="view.setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></p><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-form-element slds-lookup"><div class="slds-form-element__control"><div class="slds-pill_container" (click)="startSearch()"><div *ngIf="searchObjects" class="slds-form-element__control slds-grid slds-box--border slds-m-bottom--xx-small" [ngClass]="getFieldClass()"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="objectsearchterm" (focus)="onFocus()" [placeholder]="language.getLabel(\'LBL_SEARCH\') + \' \' + language.getLabel(\'LBL_TERRITORY\')" role="combobox"></div></div><span class="slds-pill slds-m-vertical--xxx-small slds-p-vertical--xx-small" *ngFor="let addTerritory of getAdditonalTerritories()"><span class="slds-icon_container slds-icon-standard-hierarchy slds-pill__icon_container"><system-icon [icon]="\'hierarchy\'" [sprite]="\'standard\'" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{addTerritory.name}}</span> <button *ngIf="canRemove(addTerritory.id)" class="slds-button slds-button--icon slds-pill__remove" (click)="removeTerritory(addTerritory.id)"><system-button-icon [icon]="\'close\'" (click)="removeTerritory(addTerritory.id)"></system-button-icon></button></span></div></div></div><div *ngIf="territorySearchOpen" class="slds-lookup__menu" [ngStyle]="relateSearchStyle()"><ul class="slds-lookup__list" role="listbox"><li *ngFor="let territory of getTerritories()" role="presentation" (click)="addTerritory(territory)"><span class="slds-lookup__item-action slds-media" role="option"><div class="slds-media__body"><div class="slds-lookup__result-text">{{territory.name}}</div></div></span></li><li *ngIf="getTerritories().length === 0"><span class="slds-lookup__item-action slds-media" role="option"><div class="slds-media__body"><div class="slds-lookup__result-text">no territory found</div></div></span></li></ul></div></div></div>',providers:[services_10.popup],host:{}}),__metadata("design:paramtypes",[services_2.model,services_9.view,services_10.popup,services_8.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer,services_11.territories])],e)}(tfieldGeneric);exports.SpiceTerritoriesAdditional=SpiceTerritoriesAdditional;var AddComponentsModule=function(){function AddComponentsModule(e,t){this.metadata=e,this.vms=t,this.version="1.0",this.build_date="2018-10-25",this.vms.registerModule(this)}return AddComponentsModule=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents],declarations:[SpiceProcess,SpiceKanban,SpiceKanbanStagePipe,SpiceKanbanTile,SpiceMap,DhtmlxDiagram,SpiceTimestream,SpiceTimestreamHeader,SpiceTimestreamLabel,SpiceTimestreamItem,SpiceTerritorriesDetail,SpiceTerritorriesPrimary,SpiceTerritoriesAdditional],entryComponents:[SpiceProcess,SpiceKanban,SpiceMap,SpiceTerritorriesDetail],exports:[SpiceProcess,SpiceKanban,SpiceMap,DhtmlxDiagram]}),__metadata("design:paramtypes",[services_1.metadata,services_15.VersionManagerService])],AddComponentsModule)}();exports.AddComponentsModule=AddComponentsModule;