/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2019. All Rights reserved)*/
"use strict";var __decorate=this&&this.__decorate||function(e,s,t,o){var i,a=arguments.length,l=a<3?s:null===o?o=Object.getOwnPropertyDescriptor(s,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,s,t,o);else for(var n=e.length-1;0<=n;n--)(i=e[n])&&(l=(a<3?i(l):3<a?i(s,t,l):i(s,t))||l);return 3<a&&l&&Object.defineProperty(s,t,l),l},__metadata=this&&this.__metadata||function(e,s){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,s)};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),forms_1=require("@angular/forms"),directives_1=require("../directives/directives"),core_1=require("@angular/core"),http_1=require("@angular/common/http"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),rxjs_1=require("rxjs"),operators_1=require("rxjs/operators"),services_1=require("../services/services"),services_2=require("../services/services"),services_3=require("../services/services"),services_4=require("../services/services"),services_5=require("../services/services"),services_6=require("../services/services"),services_7=require("../services/services"),services_8=require("../services/services"),services_9=require("../services/services"),services_10=require("../services/services"),services_11=require("../services/services"),services_12=require("../services/services"),services_13=require("../services/services"),services_14=require("../services/services"),services_15=require("../services/services"),services_16=require("../services/services"),services_17=require("../services/services"),services_18=require("../services/services"),services_19=require("../services/services"),services_20=require("../services/services"),objectfields_1=require("../objectfields/objectfields"),systemcomponents_1=require("../systemcomponents/systemcomponents"),MenuService=function(){function e(e,s){this.http=e,this.configurationService=s,this.menuitems=[]}return e.prototype.loadModules=function(){new http_1.HttpHeaders},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,services_5.configurationService])],e)}();exports.MenuService=MenuService;var GlobalHeader=function(){function e(e,s,t,o,i){var a=this;this.session=e,this.router=s,this.toast=t,this.elementRef=o,this.layout=i,this.router.events.subscribe(function(e){e instanceof router_1.ActivationStart&&"Users"===e.snapshot.params.module&&e.snapshot.params.id&&(a.session.authData.admin||e.snapshot.params.id==a.session.authData.userId||(a.toast.sendToast("You are not allowed to view or edit foreign user data.","warning",null,3),a.router.navigate(["/module/Users"])))})}return e.prototype.ngDoCheck=function(){this.header?this.layout.headerheight=this.header.element.nativeElement.getBoundingClientRect().height:this.layout.headerheight=0},Object.defineProperty(e.prototype,"issmall",{get:function(){return"small"==this.layout.screenwidth},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("header",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"header",void 0),e=__decorate([core_1.Component({selector:"global-header",template:'<header #header *ngIf="session.authData.sessionId && session.authData.loaded === true" class="slds-global-header_container"><global-header-top></global-header-top><global-navigation *ngIf="!issmall"></global-navigation><div class="slds-hide--medium slds-context-bar" style="height: 0px;"></div></header>',providers:[]}),__metadata("design:paramtypes",[services_2.session,router_1.Router,services_16.toast,core_1.ElementRef,services_20.layout])],e)}();exports.GlobalHeader=GlobalHeader;var GlobalHeaderTop=function(){function e(e,s){this.metadata=e,this.layout=s}return Object.defineProperty(e.prototype,"showSearch",{get:function(){return this.metadata.getActiveRole().showsearch&&"0"!=this.metadata.getActiveRole().showsearch},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSmall",{get:function(){return"small"==this.layout.screenwidth},enumerable:!0,configurable:!0}),e=__decorate([core_1.Component({selector:"global-header-top",template:'<div class="slds-global-header slds-grid slds-grid--align-spread slds-p-left--medium"><div class="slds-show--large slds-large-size--1-of-6"><div class="slds-global-header__item slds-p-left--none"><img class="slds-show--large" style="max-height: 25px;" src="./config/headerimage"></div></div><div *ngIf="isSmall" class="slds-x-small-size--1-of-12"><div class="slds-global-header__item slds-p-horizontal--none"><global-navigation-compact></global-navigation-compact></div></div><div *ngIf="showSearch" class="slds-x-small-size--11-of-12 slds-medium-size--4-of-6 slds-large-size--3-of-6"><div class="slds-global-header__item"><global-header-search></global-header-search></div></div><div *ngIf="!isSmall" class="slds-medium-size--2-of-6 slds-large-size--1-of-6"><div class="slds-global-header__item slds-grid slds-grid--align-end slds-grid--vertical-align-center"><global-header-tools></global-header-tools><global-user></global-user></div></div></div>'}),__metadata("design:paramtypes",[services_12.metadata,services_20.layout])],e)}();exports.GlobalHeaderTop=GlobalHeaderTop;var GlobalHeaderSearch=function(){function e(e,s,t,o,i,a){this.router=e,this.broadcast=s,this.fts=t,this.elementRef=o,this.renderer=i,this.language=a,this.showRecent=!1,this.searchTimeOut=void 0,this.searchTerm="",this.searchTermUntrimmed="",this._searchmodule="all",this.searchresults=[]}return Object.defineProperty(e.prototype,"searchmodule",{get:function(){return this.language.getModuleName(this._searchmodule)},set:function(e){this._searchmodule=e,this.searchTerm&&this.showRecent&&this.executeSearch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showModuleSelector",{get:function(){return 768<=window.innerWidth},enumerable:!0,configurable:!0}),e.prototype.onFocus=function(){var s=this;this.showRecent=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return s.onClick(e)})},e.prototype.closePopup=function(){this.clickListener(),this.showRecent=!1,this.searchTerm="",this.searchTermUntrimmed=""},e.prototype.doSearch=function(){this.searchTerm=this.searchTermUntrimmed.trim(),this.searchTerm.length&&this.searchTerm!==this.fts.searchTerm&&this.executeSearch()},e.prototype.executeSearch=function(){var a=this,e=[];this.showModuleSelector&&"all"!=this._searchmodule&&e.push(this._searchmodule),this.searchresults=[],this.fts.searchByModules(this.searchTerm,e,10).subscribe(function(e){for(var s=[],t=0,o=a.fts.moduleSearchresults;t<o.length;t++){var i=o[t];s=s.concat(i.data.hits)}s.sort(function(e,s){return e._score>s._score?-1:1}),a.searchresults=s.splice(0,10)})},e.prototype.clearSearchTerm=function(){this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTerm="",this.searchTermUntrimmed="",this.fts.searchTerm=""},e.prototype.search=function(e){var s=this;switch(this.showRecent=!0,e.key){case"ArrowDown":case"ArrowUp":break;case"Enter":this.searchTerm=this.searchTermUntrimmed.trim(),this.searchTerm.length&&(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.showRecent=!1,0<this.searchTerm.length&&this.router.navigate(["/search/"+btoa(this.searchTerm)]));break;default:this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout(function(){return s.doSearch()},1e3)}},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopup()},e.prototype.selected=function(e){this.showRecent=!1,this.clearSearchTerm()},e=__decorate([core_1.Component({selector:"global-header-search",template:'<div class="slds-global-header__item_search" style="min-width: 15rem"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox-group"><div *ngIf="showModuleSelector" class="slds-combobox_object-switcher slds-combobox-addon_start"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" dropdowntrigger role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><input type="text" class="slds-input slds-combobox__input slds-combobox__input-value" [(ngModel)]="searchmodule" role="textbox"><system-icon icon="down" sprite="utility" size="x-small" addclasses="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right"></system-icon></div><div class="slds-dropdown slds-dropdown_length-10 slds-dropdown_x-small slds-dropdown_left"><ul class="slds-listbox slds-listbox_vertical" role="group"><li role="presentation" class="slds-listbox__item" (click)="searchmodule = \'all\'"><div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><div class="slds-media__figure slds-listbox__option-icon"><system-utility-icon icon="check" size="x-smal" *ngIf="\'all\' == searchmodule"></system-utility-icon></div><div class="slds-media__body"><div class="slds-truncate">{{language.getLabel(\'LBL_ALL\')}}</div></div></div></li><li *ngFor="let searchModule of fts.loadedSearchModules" role="presentation" (click)="searchmodule = searchModule" class="slds-listbox__item"><div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><div class="slds-media__figure slds-listbox__option-icon"><system-utility-icon icon="check" size="x-smal" *ngIf="searchModule == searchmodule"></system-utility-icon></div><div class="slds-media__body"><div class="slds-truncate">{{language.getModuleName(searchModule)}}</div></div></div></li></ul></div></div></div></div></div></div><div class="slds-combobox_container slds-combobox-addon_end" [ngClass]="{\'slds-combobox-addon_start\': !showModuleSelector}"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" role="combobox" [ngClass]="{\'slds-is-open\': showRecent}"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left slds-global-search__form-element" role="none"><system-utility-icon icon="search" addclasses="slds-input__icon slds-input__icon--left"></system-utility-icon><input class="slds-input slds-combobox__input" type="search" [placeholder]="language.getLabel(\'LBL_SEARCH_SPICE\')" (focus)="onFocus()" [(ngModel)]="searchTermUntrimmed" (keyup)="search($event)"></div><div class="slds-dropdown slds-dropdown_fluid" role="listbox"><global-header-search-recent-items *ngIf="searchTerm === \'\'" (selected)="selected($event)"></global-header-search-recent-items><global-header-search-results-items *ngIf="searchTerm !== \'\'" [searchTerm]="searchTerm" [searchResults]="searchresults" (selected)="selected($event)"></global-header-search-results-items></div></div></div></div></div></div></div>',providers:[services_8.fts]}),__metadata("design:paramtypes",[router_1.Router,services_7.broadcast,services_8.fts,core_1.ElementRef,core_1.Renderer,services_4.language])],e)}();exports.GlobalHeaderSearch=GlobalHeaderSearch;var GlobalHeaderSearchResultsItems=function(){function e(e,s,t){this.router=e,this.language=s,this.fts=t,this.searchTerm="",this.searchModule="",this.searchResults=[],this.selected=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"searchModuleName",{get:function(){return this.language.getLabel("LBL_INSPICECRM")},enumerable:!0,configurable:!0}),e.prototype.goSearch=function(){0<this.searchTerm.length&&(this.selected.emit(!0),this.router.navigate(["/search/"+btoa(this.searchTerm)]))},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"searchTerm",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"searchModule",void 0),__decorate([core_1.Input(),__metadata("design:type",Array)],e.prototype,"searchResults",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selected",void 0),e=__decorate([core_1.Component({selector:"global-header-search-results-items",template:'<ul role="listbox"><li role="presentation" (click)="goSearch()"><span class="slds-lookup__item-action slds-media slds-media--center" role="option"><system-spinner *ngIf="fts.runningmodulesearch" [size]="20" class="slds-p-right--x-small"></system-spinner><system-icon *ngIf="!fts.runningmodulesearch" icon="search" size="small" sprite="utility"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{language.getLabel(\'LBL_SEARCH\')}} "{{searchTerm}}" {{searchModuleName}}</div></div></span></li><ng-container *ngIf="!fts.runningmodulesearch"><li global-header-search-results-item *ngFor="let searchResult of searchResults" [hit]="searchResult" (selected)="selected.emit(true)"></li></ng-container></ul>'}),__metadata("design:paramtypes",[router_1.Router,services_4.language,services_8.fts])],e)}();exports.GlobalHeaderSearchResultsItems=GlobalHeaderSearchResultsItems;var GlobalHeaderSearchResultsItem=function(){function e(e,s,t){this.model=e,this.router=s,this.language=t,this.hit={},this.selected=new core_1.EventEmitter}return e.prototype.navigateTo=function(){this.selected.emit(!0),this.router.navigate(["/module/"+this.model.module+"/"+this.model.id])},e.prototype.gethref=function(){return"#/module/"+this.model.module+"/"+this.model.id},e.prototype.ngOnInit=function(){for(var e in this.model.module=this.hit._type,this.model.id=this.hit._id,this.hit._source)this.model.data[e]=this.hit._source[e]},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"hit",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selected",void 0),e=__decorate([core_1.Component({selector:"[global-header-search-results-item]",template:'<span class="slds-lookup__item-action slds-media slds-media--center" role="option"><system-icon [module]="model.module" size="small"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{model.data.summary_text}}</div><span class="slds-lookup__result-meta slds-text-body--small">{{language.getModuleName(model.module, true)}}</span></div></span>',providers:[services_9.model],host:{"(click)":"navigateTo()"}}),__metadata("design:paramtypes",[services_9.model,router_1.Router,services_4.language])],e)}();exports.GlobalHeaderSearchResultsItem=GlobalHeaderSearchResultsItem;var GlobalHeaderSearchRecentItems=function(){function e(e,s,t){this.language=e,this.recent=s,this.router=t,this.selected=new core_1.EventEmitter}return e.prototype.goRecent=function(){this.router.navigate(["/recent"])},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selected",void 0),e=__decorate([core_1.Component({selector:"global-header-search-recent-items",template:'<ul role="listbox"><li role="presentation" (click)="goRecent()"><span class="slds-lookup__item-action slds-media slds-media--center" role="option"><system-icon icon="breadcrumbs" size="small" sprite="utility"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{language.getLabel(\'LBL_RECENTLYVIEWED\')}}</div></div></span></li><li global-header-search-recent-item *ngFor="let item of recent.items.slice(0, 10)" [item]="item" (selected)="selected.emit(true)"></li></ul>'}),__metadata("design:paramtypes",[services_4.language,services_10.recent,router_1.Router])],e)}();exports.GlobalHeaderSearchRecentItems=GlobalHeaderSearchRecentItems;var GlobalHeaderSearchRecentItem=function(){function e(e,s,t){this.model=e,this.router=s,this.language=t,this.item={},this.selected=new core_1.EventEmitter}return e.prototype.navigateTo=function(){this.selected.emit(!0),this.router.navigate(["/module/"+this.model.module+"/"+this.model.id])},e.prototype.gethref=function(){return"#/module/"+this.model.module+"/"+this.model.id},e.prototype.ngOnInit=function(){this.model.module=this.item.module_name,this.model.id=this.item.item_id,this.model.data.summary_text=this.item.item_summary},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selected",void 0),e=__decorate([core_1.Component({selector:"[global-header-search-recent-item]",template:'<span class="slds-lookup__item-action slds-media slds-media--center" role="option"><system-icon [module]="model.module" size="small"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{model.data.summary_text}}</div><span class="slds-lookup__result-meta slds-text-body--small">{{language.getModuleName(model.module, true)}}</span></div></span>',providers:[services_9.model],host:{"(click)":"navigateTo()"}}),__metadata("design:paramtypes",[services_9.model,router_1.Router,services_4.language])],e)}();exports.GlobalHeaderSearchRecentItem=GlobalHeaderSearchRecentItem;var GlobalHeaderTools=function(){function GlobalHeaderTools(e,s,t,o,i){var a=this;this.session=e,this.metadata=s,this.router=t,this.language=o,this.broadcast=i,this.containerItems=[],this.broadcast.message$.subscribe(function(e){a.handleMessage(e)})}return GlobalHeaderTools.prototype.ngAfterViewInit=function(){this.buildTools()},GlobalHeaderTools.prototype.handleMessage=function(e){switch(e.messagetype){case"applauncher.setrole":case"loader.reloaded":this.buildTools()}},GlobalHeaderTools.prototype.buildTools=function(){var s=this;this.containerItems.forEach(function(e){e.destroy()}),this.containerItems=[];var e=this.metadata.getComponentConfig("GlobalHeaderTools");if(!e.componentset)return!1;for(var t=0,o=this.metadata.getComponentSetObjects(e.componentset);t<o.length;t++){var i=o[t];this.metadata.addComponent(i.component,this.toolcontainer).subscribe(function(e){s.containerItems.push(e)})}},__decorate([core_1.ViewChild("toolcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalHeaderTools.prototype,"toolcontainer",void 0),GlobalHeaderTools=__decorate([core_1.Component({selector:"global-header-tools",template:'<div class="slds-grid slds-grid--vertical-align-center"><div #toolcontainer></div></div>'}),__metadata("design:paramtypes",[services_2.session,services_12.metadata,router_1.Router,services_4.language,services_7.broadcast])],GlobalHeaderTools)}();exports.GlobalHeaderTools=GlobalHeaderTools;var GlobalHeaderActions=function(){function GlobalHeaderActions(e,s,t,o,i){this.renderer=e,this.elementRef=s,this.session=t,this.metadata=o,this.language=i,this.isOpen=!1}return GlobalHeaderActions.prototype.ngAfterViewInit=function(){var t=this,e=this.metadata.getComponentConfig("GlobalHeaderActions");if(e&&e.actionset)for(var s=this.metadata.getActionSetItems(e.actionset),o=function(s){i.metadata.addComponent(s.component,i.actioncontainerheader).subscribe(function(e){e.instance.actionconfig=s.actionconfig,e.instance.closemenu&&e.instance.closemenu.subscribe(function(e){t.isOpen=!1})})},i=this,a=0,l=s;a<l.length;a++){o(l[a])}},GlobalHeaderActions.prototype.toggleOpen=function(){var s=this;this.isOpen=!this.isOpen,this.isOpen?this.clickListener=this.renderer.listen("document","click",function(e){return s.onClick(e)}):this.clickListener&&this.clickListener()},GlobalHeaderActions.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.isOpen=!1,this.clickListener())},__decorate([core_1.ViewChild("actioncontainerheader",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalHeaderActions.prototype,"actioncontainerheader",void 0),GlobalHeaderActions=__decorate([core_1.Component({selector:"global-header-actions",template:'<div class="slds-show--medium slds-dropdown-trigger slds-dropdown-trigger_click slds-p-horizontal--xxx-small" [ngClass]="{\'slds-is-open\': isOpen}"><div class="slds-p-around--xx-small" (click)="toggleOpen()"><system-utility-icon [icon]="\'add\'" [size]="\'x-small\'"></system-utility-icon></div><div class="slds-is-absolute slds-dropdown slds-dropdown_right slds-nubbin_top-right" style="right:-10px;top:25px;"><ul class="slds-dropdown__list" role="menu"><li #actioncontainerheader class="slds-dropdown__header" role="separator"><span class="slds-text-title_caps">{{language.getLabel(\'LBL_CREATE\')}}</span></li></ul></div></div>'}),__metadata("design:paramtypes",[core_1.Renderer2,core_1.ElementRef,services_2.session,services_12.metadata,services_4.language])],GlobalHeaderActions)}();exports.GlobalHeaderActions=GlobalHeaderActions;var GlobalHeaderActionItem=function(){function GlobalHeaderActionItem(e,s,t,o,i){this.session=e,this.metadata=s,this.model=t,this.language=o,this.dockedComposer=i,this.actionconfig={},this.closemenu=new core_1.EventEmitter}return GlobalHeaderActionItem.prototype.ngOnInit=function(){this.actionconfig.module&&(this.model.module=this.actionconfig.module)},GlobalHeaderActionItem.prototype.click=function(){this.dockedComposer.addComposer(this.model.module),this.closemenu.emit(!0)},Object.defineProperty(GlobalHeaderActionItem.prototype,"label",{get:function(){return this.actionconfig.label?this.language.getLabel(this.actionconfig.label):this.language.getModuleLabel(this.model.module,"LBL_NEW_FORM_TITLE")},enumerable:!0,configurable:!0}),GlobalHeaderActionItem=__decorate([core_1.Component({selector:"global-header-action-item",template:'<li class="slds-dropdown__item" role="presentation"><a href="javascript:void(0)" (click)="click()" class="slds-grid slds-grid_vertical-align-center slds-p-horizontal--x-small slds-p-vertical--xx-small"><system-icon [module]="model.module" addclasses="\'slds-icon slds-icon_small"></system-icon><div class="slds-truncate slds-size--1-of-1">{{label}}</div></a></li>',providers:[services_9.model]}),__metadata("design:paramtypes",[services_2.session,services_12.metadata,services_9.model,services_4.language,services_14.dockedComposer])],GlobalHeaderActionItem)}();exports.GlobalHeaderActionItem=GlobalHeaderActionItem;var GlobalHeaderFavorite=function(){function GlobalHeaderFavorite(e,s,t,o,i,a,l){var n=this;this.metadata=e,this.favorite=s,this.router=t,this.popup=o,this.renderer=i,this.elementRef=a,this.language=l,this.showFavorites=!1,this.router.events.subscribe(function(e){e instanceof router_1.NavigationStart&&n.favorite.disable()}),o.closePopup$.subscribe(function(e){n.showFavorites=!1,n.clickListener&&n.clickListener()})}return Object.defineProperty(GlobalHeaderFavorite.prototype,"canShowFavorites",{get:function(){return this.metadata.getActiveRole().showfavorites&&"0"!=this.metadata.getActiveRole().showfavorites},enumerable:!0,configurable:!0}),Object.defineProperty(GlobalHeaderFavorite.prototype,"nofavorites",{get:function(){return 0==this.favorite.favorites.length},enumerable:!0,configurable:!0}),GlobalHeaderFavorite.prototype.isDisabled=function(){return!this.favorite.isEnabled},Object.defineProperty(GlobalHeaderFavorite.prototype,"isfavorite",{get:function(){return this.favorite.isFavorite},enumerable:!0,configurable:!0}),GlobalHeaderFavorite.prototype.getFavoriteActive=function(){return this.favorite.isFavorite?"spicecrm-favorite--active":"spicecrm-favorite--inactive"},GlobalHeaderFavorite.prototype.toggleFavorite=function(){this.favorite.isFavorite?this.favorite.deleteFavorite():this.favorite.setFavorite()},GlobalHeaderFavorite.prototype.closeFavorites=function(){this.showFavorites=!1},GlobalHeaderFavorite.prototype.toggleFavorites=function(){var s=this;this.showFavorites=!this.showFavorites,this.showFavorites?this.clickListener=this.renderer.listen("document","click",function(e){return s.onClick(e)}):this.clickListener&&this.clickListener()},GlobalHeaderFavorite.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.showFavorites=!1,this.clickListener())},GlobalHeaderFavorite=__decorate([core_1.Component({selector:"global-header-favorite",template:'<div *ngIf="canShowFavorites" class="slds-show--medium slds-dropdown-trigger slds-dropdown-trigger--click slds-is-open"><div class="slds-button-group"><button class="slds-button slds-button--icon slds-button--icon-border slds-p-horizontal--xx-small slds-p-vertical--xx-small-small" [ngClass]="getFavoriteActive()" [disabled]="isDisabled()" (click)="toggleFavorite()"><system-utility-icon icon="favorite" size="x-small"></system-utility-icon></button> <button class="slds-button slds-button--icon slds-button--icon-border slds-p-horizontal--xx-small slds-p-vertical--xx-small" [disabled]="nofavorites" (click)="toggleFavorites()"><system-button-icon icon="down" size="xx-small"></system-button-icon></button></div><div *ngIf="showFavorites" class="slds-dropdown slds-dropdown--right slds-dropdown--medium"><ul class="slds-dropdown__list" role="menu"><li class="slds-dropdown__header" role="separator"><span class="slds-text-title--caps">{{language.getLabel(\'LBL_FAVORITES\')}}</span></li><li global-header-search-recent-item class="slds-dropdown__item" role="presentation" *ngFor="let item of favorite.favorites" [item]="item" (selected)="closeFavorites()"></li></ul></div></div>',providers:[services_6.popup],styles:[":host >>> .spicecrm-favorite--inactive svg {fill: transparent; stroke: grey;}",":host >>> .slds-button.spicecrm-favorite--inactive:focus  svg {fill: transparent; stroke: grey;}",":host >>> .slds-button.spicecrm-favorite--inactive:not(:disabled):hover svg {fill: transparent; stroke: #CA1B21;}"]}),__metadata("design:paramtypes",[services_12.metadata,services_11.favorite,router_1.Router,services_6.popup,core_1.Renderer2,core_1.ElementRef,services_4.language])],GlobalHeaderFavorite)}();exports.GlobalHeaderFavorite=GlobalHeaderFavorite;var GlobalHeaderWorkbench=function(){function GlobalHeaderWorkbench(e,s,t){this.session=e,this.router=s,this.language=t}return GlobalHeaderWorkbench.prototype.isAdmin=function(){return this.session.isAdmin},GlobalHeaderWorkbench.prototype.goAdmin=function(){this.router.navigate(["/admin"])},GlobalHeaderWorkbench=__decorate([core_1.Component({selector:"global-header-workbench",template:'<div *ngIf="isAdmin()" class="slds-p-around--xx-small" [title]="language.getLabel(\'LBL_WORKBENCH\')" (click)="goAdmin()"><system-utility-icon [icon]="\'setup\'" [size]="\'x-small\'"></system-utility-icon></div>'}),__metadata("design:paramtypes",[services_2.session,router_1.Router,services_4.language])],GlobalHeaderWorkbench)}();exports.GlobalHeaderWorkbench=GlobalHeaderWorkbench;var GlobalFooter=function(){function e(e,s,t){this.session=e,this.footer=s,this.modalservice=t}return e.prototype.ngAfterViewInit=function(){this.footer.footercontainer=this.footercontainer,this.footer.modalcontainer=this.modalcontainer,this.footer.modalbackdrop=this.modalbackdrop},__decorate([core_1.ViewChild("footercontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"footercontainer",void 0),__decorate([core_1.ViewChild("modalcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"modalcontainer",void 0),__decorate([core_1.ViewChild("modalbackdrop",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"modalbackdrop",void 0),e=__decorate([core_1.Component({selector:"global-footer",template:'<footer><global-docked-composer-container *ngIf="session.authData.sessionId && session.authData.loaded === true"></global-docked-composer-container><div #footercontainer></div><div data-info="ModalContainer" style="position:fixed;z-index:10000"><div #backdrop class="slds-backdrop" [class.slds-backdrop_open]="modalservice.backdropVisible" [style.zIndex]="modalservice.backdropZindex"></div><span #modalcontainer></span></div><system-toast-container class="slds-notify_container"></system-toast-container></footer>'}),__metadata("design:paramtypes",[services_2.session,services_17.footer,services_19.modal])],e)}();exports.GlobalFooter=GlobalFooter;var GlobalLogin=function(){function e(e,s,t,o,i,a,l,n){var r=this;if(this.loginService=e,this.http=s,this.configuration=t,this.session=o,this.cookie=i,this.language=a,this.sanitizer=l,this.changeDetectorRef=n,this.promptUser=!1,this.username="",this.password="",this._selectedlanguage="",this.selectedsite="",this.lastSelectedLanguage=null,this.showForgotPass=!1,this.externalSidebarUrl=null,sessionStorage["OAuth-Token"]&&0<sessionStorage["OAuth-Token"].length){var d=new http_1.HttpHeaders;d=d.set("OAuth-Token",sessionStorage["OAuth-Token"]),sessionStorage[btoa(sessionStorage["OAuth-Token"]+":siteid")]&&this.configuration.setSiteID(atob(sessionStorage[btoa(sessionStorage["OAuth-Token"]+":siteid")])),this.http.get(this.configuration.getBackendUrl()+"/login",{headers:d}).subscribe(function(e){var s=e;r.session.authData.sessionId=s.id,r.session.authData.userId=s.userid,r.session.authData.userName=s.user_name,r.session.authData.userimage=s.user_image,r.session.authData.first_name=s.first_name,r.session.authData.last_name=s.last_name,r.session.authData.display_name=s.display_name,r.session.authData.email=s.email,r.session.authData.admin=1==s.admin,r.session.authData.dev=1==s.dev,r.session.authData.renewPass="1"===s.renewPass,r.session.authData.renewPass||r.loginService.load()},function(e){switch(e.status){case 401:r.promptUser=!0}})}else this.promptUser=!0,this.selectedsite=this.cookie.getValue("spiceuibackend"),this.selectedsite&&this.configuration.setSiteID(this.selectedsite);this.lastSelectedLanguage=this.cookie.getValue("spiceuilanguage")}return e.prototype.handleResize=function(){this.changeDetectorRef.detectChanges()},e.prototype.keypressed=function(e){13!==e.keyCode||this.showForgotPass||this.session.authData.renewPass||this.login()},e.prototype.login=function(){0<this.username.length&&0<this.password.length&&(this.loginService.authData.userName=this.username,this.loginService.authData.password=this.password,this.loginService.login())},Object.defineProperty(e.prototype,"selectedlanguage",{get:function(){return this._selectedlanguage||(this.lastSelectedLanguage?this.selectedlanguage=this.lastSelectedLanguage:this.configuration.data.languages&&(this.selectedlanguage=this.configuration.data.languages.default)),this._selectedlanguage},set:function(e){this._selectedlanguage=e,this.language.currentlanguage=e},enumerable:!0,configurable:!0}),e.prototype.getLanguages=function(){var e=[];if(this.configuration.data.languages)for(var s=0,t=this.configuration.data.languages.available;s<t.length;s++){var o=t[s];e.push({language:o.language_code,text:o.language_name})}return e},e.prototype.doLogin=function(){this.loginService.login()},Object.defineProperty(e.prototype,"currentSiteId",{get:function(){return this.configuration.data.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sites",{get:function(){return this.configuration.sites},enumerable:!0,configurable:!0}),e.prototype.getBackendUrls=function(){return this.configuration.data.backendUrls?this.configuration.data.backendUrls:[]},e.prototype.setSite=function(e){this.configuration.setSiteID(e.srcElement.value)},e.prototype.showForgotPassword=function(){this.showForgotPass?this.showForgotPass=!1:this.showForgotPass=!0},Object.defineProperty(e.prototype,"showSidebar",{get:function(){return 1024<=window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showExternalSidebar",{get:function(){try{var e=!_.isEmpty(this.configuration.data.loginSidebarUrl);return e&&null===this.externalSidebarUrl&&(this.externalSidebarUrl=this.sanitizer.bypassSecurityTrustResourceUrl(this.configuration.data.loginSidebarUrl)),e}catch(e){return!1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showNewsfeed",{get:function(){try{return!!this.configuration.initialized&&_.isEmpty(this.configuration.data.loginSidebarUrl)}catch(e){return!1}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showProgressBar",{get:function(){return this.configuration.data.loginProgressBar},enumerable:!0,configurable:!0}),e=__decorate([core_1.Component({selector:"global-login",template:'<div class="slds-grid slds-wrap slds-is-absolute slds-size--1-of-1" style="height:100vh; top: 0px;"><div class="slds-align--absolute-center slds-size--1-of-1 slds-large-size--1-of-2"><div class="slds-size--1-of-1 slds-medium-size--2-of-3 slds-p-around--medium"><div class="slds-align--absolute-center slds-p-vertical--medium"><img src="./config/loginimage"></div><div class="slds-box--border" *ngIf="!loginService.session.authData.sessionId && promptUser"><div class="slds-p-around--medium"><form *ngIf="!showForgotPass" (submit)="login($event)"><div class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'user\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="text" name="username" autocomplete [(ngModel)]="username" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="1"></div></div><div class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="password" name="password" autocomplete [(ngModel)]="password" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="2"></div></div><div *ngIf="sites.length > 1" class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control"><div class="slds-select_container slds-m-vertical--xx-small"><select name="currentsite" class="slds-select slds-p-horizontal--large" [ngModel]="currentSiteId" (change)="setSite($event)"><option *ngFor="let site of sites" [value]="site.id">{{site.display}}</option></select></div></div></div><div *ngIf="getLanguages().length > 1" class="slds-form-element slds-m-vertical--small"><div class="slds-form-element__control"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select slds-p-horizontal--large" name="selectLang" [(ngModel)]="selectedlanguage"><option *ngFor="let lang of getLanguages()" [value]="lang.language">{{lang.text}}</option></select></div></div></div><button type="submit" value="Submit" class="slds-button slds-button--brand" style="width:100%;" tabindex="0">Login</button><global-login-google (googletoken)="doLogin()"></global-login-google></form><div class="slds-p-vertical--x-small slds-grid slds-grid--align-spread slds-grid_vertical-align-center" *ngIf="configuration.getData(\'allowForgotPass\')"><div class="slds-truncate slds-text-body_small" title="Forgot password">Forgot password</div><button class="slds-button" (click)="showForgotPassword()"><system-button-icon *ngIf="!showForgotPass" [icon]="\'chevrondown\'" [size]="\'xx-small\'"></system-button-icon><system-button-icon *ngIf="showForgotPass" [icon]="\'chevronup\'" [size]="\'xx-small\'"></system-button-icon></button></div><global-login-forgot-password class="slds-col" *ngIf="showForgotPass" (hasNewPassword)="showForgotPass = $event"></global-login-forgot-password></div></div><global-login-reset-password *ngIf="loginService.session.authData.renewPass" [oldpassword]="password"></global-login-reset-password><ng-container *ngIf="loginService.session.authData.sessionId && !loginService.session.authData.renewPass"><system-loader-progress></system-loader-progress></ng-container></div><div class="slds-is-absolute" style="bottom: 10px;">Â© 2015 - 2019 aac services k.s. All rights reserved.</div></div><div *ngIf="promptUser && showSidebar" class="slds-size--1-of-1 slds-large-size--1-of-2" [class.slds-scrollable--y]="!showExternalSidebar"><iframe *ngIf="showExternalSidebar" [src]="externalSidebarUrl" style="border:none;width:100%;height:100%"></iframe><ng-container *ngIf="showNewsfeed"><global-newsfeed></global-newsfeed></ng-container></div></div>',host:{"(window:keypress)":"this.keypressed($event)","(window:resize)":"handleResize()"}}),__metadata("design:paramtypes",[services_1.loginService,http_1.HttpClient,services_5.configurationService,services_2.session,services_18.cookie,services_4.language,platform_browser_1.DomSanitizer,core_1.ChangeDetectorRef])],e)}();exports.GlobalLogin=GlobalLogin;var GlobalSetup=function(){function e(e,s,t,o){this.toast=e,this.http=s,this.router=t,this.configurationService=o,this.systemid="000",this.systemname="",this.systemurl="",this.systemproxy=1,this.systemdevmode=0,this.systemloginprogressbar=1,this.systemallowforgotpass=0,this.checking=!1}return Object.defineProperty(e.prototype,"saveEnabled",{get:function(){return""!=this.systemname&&""!=this.systemurl&&!this.checking},enumerable:!0,configurable:!0}),e.prototype.testConnection=function(){var t=this;this.checking=!0,this.http.get("config/check",{params:{url:btoa(this.systemurl)}}).subscribe(function(e){var s=e;1!=s.success?(t.toast.sendToast(s.message,"error"),t.checking=!1):t.saveConnection()},function(e){e.status})},e.prototype.saveConnection=function(){var t=this;this.checking=!0;var e={id:this.systemid,display:this.systemname,backendUrl:this.systemurl,proxy:this.systemproxy,developerMode:this.systemdevmode,loginProgressBar:this.systemloginprogressbar,allowForgotPass:this.systemloginprogressbar};this.http.post("config/set",e,{}).subscribe(function(e){var s=e;1==s.success?(t.configurationService.setSiteData(s.site),t.router.navigate(["/login"])):t.checking=!1},function(e){e.status})},e=__decorate([core_1.Component({selector:"global-setup",template:'<div class="slds-align--absolute-center slds-p-around--medium" style="height: 80%;"><div class="slds-box" style="width: 50%;"><h2 class="slds-text-heading--medium slds-p-vertical--small slds-p-horizontal--x-small">Define Backend Connection</h2><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label"><abbr class="slds-required">*</abbr>id</label><div class="slds-form-element__control"><input type="text" class="slds-input" [disabled]="checking" [(ngModel)]="systemid"></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label"><abbr class="slds-required">*</abbr>Name</label><div class="slds-form-element__control"><input type="text" class="slds-input" [disabled]="checking" [(ngModel)]="systemname"></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label"><abbr class="slds-required">*</abbr>Backend URL</label><div class="slds-form-element__control"><input type="text" class="slds-input" [disabled]="checking" [(ngModel)]="systemurl"></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label">use proxy</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [disabled]="checking" [(ngModel)]="systemproxy"><option value="1">Yes</option><option value="0">No</option></select></div></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label">developermode</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [disabled]="checking" [(ngModel)]="systemdevmode"><option value="1">Yes</option><option value="0">No</option></select></div></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label">Show Loader Details</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [disabled]="checking" [(ngModel)]="systemloginprogressbar"><option value="0">Yes</option><option value="1">No</option></select></div></div></div><div class="slds-form-element slds-p-vertical--xx-small"><label class="slds-form-element__label">Show Forgot Password on Login Screen</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [disabled]="checking" [(ngModel)]="systemallowforgotpass"><option value="0">Yes</option><option value="1">No</option></select></div></div></div><div class="slds-text-align--right slds-p-vertical--small"><button class="slds-button slds-button--brand" [disabled]="!saveEnabled" (click)="testConnection()">Check & Save</button></div></div></div>'}),__metadata("design:paramtypes",[services_16.toast,http_1.HttpClient,router_1.Router,services_5.configurationService])],e)}();exports.GlobalSetup=GlobalSetup;var GlobalLoginForgotPassword=function(){function e(e,s,t){this.http=e,this.configuration=s,this.toast=t,this.email="",this.token="",this.password=void 0,this.repeatPassword=void 0,this.pwdCheck=new RegExp("//"),this.pwdGuideline="",this.infoLoaded=!1,this.emailEmpty=!1,this.tokenEmpty=!1,this.tokenInvalid=!1,this.promptUser=!1,this.showForgotPasswordEmail=!0,this.promptNewPass=!1,this.showForgotPasswordToken=!1,this.hasNewPassword=new core_1.EventEmitter,this.getInfo()}return e.prototype.getInfo=function(){var s=this;this.http.get(this.configuration.getBackendUrl()+"/forgotPassword/info").subscribe(function(e){s.pwdCheck=new RegExp(e.pwdCheck.regex),s.pwdGuideline=e.pwdCheck.guideline,s.infoLoaded=!0})},Object.defineProperty(e.prototype,"pwderror",{get:function(){return!(!this.password||this.pwdCheck.test(this.password))&&"Password does not match the Guideline."},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pwdreperror",{get:function(){return this.password!=this.repeatPassword&&"Inputs for the new Password does not match."},enumerable:!0,configurable:!0}),e.prototype.keypressed=function(e){13===e.keyCode&&(this.showForgotPasswordEmail&&this.sendEmail(),this.showForgotPasswordToken&&this.sendToken(),this.promptNewPass&&this.sendNewPass())},e.prototype.sendEmail=function(){var s=this;0<this.email.length?(this.emailEmpty=!1,this.http.get(this.configuration.getBackendUrl()+"/forgotPassword/"+this.email).subscribe(function(e){e?0==e.result?s.toast.sendToast(e.message,"error"):(s.showForgotPasswordToken=!0,s.showForgotPasswordEmail=!1,s.toast.sendToast("Successfully sent, check your inbox to get the token code","success")):s.toast.sendToast("User with the given email does not exist","error")},function(e){switch(e.status){case 401:s.showForgotPasswordEmail=!0}})):this.emailEmpty=!0},e.prototype.sendToken=function(){var t=this;0<this.token.length?(this.tokenEmpty=!1,this.http.post(this.configuration.getBackendUrl()+"/forgotPassword/"+this.email+"/"+this.token,{}).subscribe(function(e){var s=e;t.showForgotPasswordEmail=!1,s.token_valid?(t.showForgotPasswordToken=!1,t.promptNewPass=!0):(t.tokenInvalid=!0,t.toast.sendToast("Token or email is invalid","error","Token is expired, or invalid or does not belong to this email address",!1))},function(e){switch(e.status){case 401:t.showForgotPasswordToken=!0}})):this.emailEmpty=!0},e.prototype.sendNewPass=function(){var s=this;if(this.infoLoaded&&this.pwderror)return!1;this.password&&0==this.pwdreperror&&this.http.post(this.configuration.getBackendUrl()+"/forgotPassword/resetPass",{email:this.email,token:this.token,password:this.password}).subscribe(function(e){s.promptNewPass=!1,s.toast.sendToast("please log in with new password","default","please return to login form and enter login data with new password",!1),s.hasNewPassword.emit(!1)},function(e){switch(e.status){case 401:s.promptNewPass=!0}})},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"hasNewPassword",void 0),e=__decorate([core_1.Component({selector:"global-login-forgot-password",template:'<div id="login-forgot-password"><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': emailEmpty}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left" *ngIf="showForgotPasswordEmail"><system-utility-icon [icon]="\'email\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="email" [(ngModel)]="email" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="3" placeholder="Email address of your user account"></div></div><div class="slds-button slds-button--brand" (click)="sendEmail()" *ngIf="showForgotPasswordEmail">Send</div><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': (tokenEmpty || tokenInvalid)}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left" *ngIf="showForgotPasswordToken"><system-utility-icon [icon]="\'shield\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="text" [(ngModel)]="token" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="4" placeholder="Token that was sent via email"></div></div><div class="slds-button slds-button--brand" (click)="sendToken()" *ngIf="showForgotPasswordToken">Confirm</div><div class="spiceNewPasswordModal" *ngIf="promptNewPass"><div *ngIf="pwdGuideline" class="slds-m-vertical--medium">Password Guideline:<br>{{pwdGuideline}}</div><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': passField.touched && passField.dirty && pwderror}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input #passField="ngModel" type="password" [(ngModel)]="password" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="1" placeholder="enter new password"></div><div *ngIf="passField.touched && passField.dirty && pwderror" class="slds-form-element__help slds-text-color--error">{{pwderror}}</div></div><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': repPassField.touched && repPassField.dirty && pwdreperror}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="password" #repPassField="ngModel" [(ngModel)]="repeatPassword" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="2" placeholder="repeat new password"></div><div *ngIf="repPassField.touched && repPassField.dirty && pwdreperror" class="slds-form-element__help slds-text-color--error">{{pwdreperror}}</div></div><div class="slds-button slds-button--brand" (click)="sendNewPass()" tabindex="3">Save</div></div></div>',host:{"(window:keypress)":"this.keypressed($event)"}}),__metadata("design:paramtypes",[http_1.HttpClient,services_5.configurationService,services_16.toast])],e)}();exports.GlobalLoginForgotPassword=GlobalLoginForgotPassword;var GlobalLoginResetPassword=function(){function e(e,s,t,o,i){this.loginService=e,this.http=s,this.configuration=t,this.toast=o,this.session=i,this.oldPassword=void 0,this.password=void 0,this.repeatPassword=void 0,this.promptNewPass=!1,this.pwdCheck=new RegExp("//"),this.pwdGuideline=void 0,this.infoLoaded=!1,this.getInfo()}return Object.defineProperty(e.prototype,"oldPwError",{get:function(){return this.oldPassword==this.password&&"Old password is not allowed to be used as a new password"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pwderror",{get:function(){return!(!this.password||this.pwdCheck.test(this.password))&&"Password does not match the Guideline."},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pwdreperror",{get:function(){return this.password!=this.repeatPassword&&"Inputs for the new Password does not match."},enumerable:!0,configurable:!0}),e.prototype.keypressed=function(e){13===e.keyCode&&this.sendNewPass()},e.prototype.getInfo=function(){var s=this;this.http.get(this.configuration.getBackendUrl()+"/forgotPassword/info").subscribe(function(e){s.pwdCheck=new RegExp(e.pwdCheck.regex),s.pwdGuideline=e.pwdCheck.guideline,s.infoLoaded=!0})},e.prototype.sendNewPass=function(){var s=this;if(this.infoLoaded&&this.pwderror)return!1;if(this.password&&0==this.pwdreperror&&0==this.oldPwError){var e=new http_1.HttpHeaders;e=e.set("OAuth-Token",this.session.authData.sessionId),this.http.post(this.configuration.getBackendUrl()+"/resetTempPass",{password:this.password},{headers:e}).subscribe(function(e){s.session.authData.renewPass=!1,s.toast.sendToast("Password was successfully changed","success","",5),s.loginService.load()},function(e){switch(e.status){case 401:s.promptNewPass=!0}})}},__decorate([core_1.Input("oldpassword"),__metadata("design:type",String)],e.prototype,"oldPassword",void 0),e=__decorate([core_1.Component({selector:"global-login-reset-password",template:'<div id="reset-password"><div style="height: 640px;"><section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open"><div class="slds-modal__container"><header class="slds-modal__header"><button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close"><system-button-icon [icon]="\'close\'"></system-button-icon><span class="slds-assistive-text">Close</span></button><h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">New password</h2></header><div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1"><div *ngIf="pwdGuideline" class="slds-m-vertical--medium">Password Guideline:<br>{{pwdGuideline}}</div><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': passField.touched && passField.dirty && (pwderror || oldPwError)}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input #passField="ngModel" type="password" [(ngModel)]="password" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="1" placeholder="enter new password" autofocus></div><div *ngIf="passField.touched && passField.dirty && pwderror" class="slds-form-element__help slds-text-color--error">{{pwderror}}</div><div *ngIf="passField.touched && passField.dirty && oldPwError" class="slds-form-element__help slds-text-color--error">{{oldPwError}}</div></div><div class="slds-form-element slds-m-vertical--small" [ngClass]="{\'slds-has-error\': repPassField.touched && repPassField.dirty && pwdreperror}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'lock\'" [addclasses]="\'slds-input__icon slds-icon-text-default\'"></system-utility-icon><input type="password" #repPassField="ngModel" [(ngModel)]="repeatPassword" class="slds-input slds-p-horizontal--large slds-p-vertical--small" tabindex="2" placeholder="repeat new password"></div><div *ngIf="repPassField.touched && repPassField.dirty && pwdreperror" class="slds-form-element__help slds-text-color--error">{{pwdreperror}}</div></div></div><footer class="slds-modal__footer"><button class="slds-button slds-button--brand" (click)="sendNewPass()" tabindex="3">Save</button></footer></div></section><div class="slds-backdrop slds-backdrop_open"></div></div></div>',host:{"(window:keypress)":"this.keypressed($event)"}}),__metadata("design:paramtypes",[services_1.loginService,http_1.HttpClient,services_5.configurationService,services_16.toast,services_2.session])],e)}();exports.GlobalLoginResetPassword=GlobalLoginResetPassword;var GlobalNavigation=function(){function e(e,s,t,o){this.menuService=e,this.metadata=s,this.elementRef=t,this.broadcast=o,this.resizeTimeOut=void 0,e.loadModules()}return __decorate([core_1.ViewChild("menucontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"menucontainer",void 0),e=__decorate([core_1.Component({selector:"global-navigation",template:'<div class="slds-context-bar"><global-app-launcher></global-app-launcher><global-navigation-menu class="slds-context-bar__secondary" role="navigation"></global-navigation-menu></div>',providers:[MenuService]}),__metadata("design:paramtypes",[MenuService,services_12.metadata,core_1.ElementRef,services_7.broadcast])],e)}();exports.GlobalNavigation=GlobalNavigation;var GlobalNavigationMenu=function(){function e(e,s,t,o,i){var a=this;this.menuService=e,this.metadata=s,this.elementRef=t,this.broadcast=o,this.navigation=i,this.moreComponentRef=void 0,this.menuItems=[],this.renderedItems=[],this.moreItems=[],this.movingActive=!1,this.rendering=!1,this.resizeTimeOut=void 0,this.broadcast.message$.subscribe(function(e){a.handleMessage(e)}),this.navigation.activeModule$.subscribe(function(e){return a.checkActiveModule()})}return e.prototype.ngAfterViewInit=function(){this.buildMenuItems(),this.renderMenu()},e.prototype.buildMenuItems=function(){this.menuItems=[];for(var e=0,s=this.metadata.getRoleModules(!0);e<s.length;e++){var t=s[e];this.menuItems.push(t)}},e.prototype.handleResize=function(){var e=this;this.buildMenuItems(),this.resizeTimeOut&&window.clearTimeout(this.resizeTimeOut),this.resizeTimeOut=window.setTimeout(function(){return e.renderMenu()},250)},e.prototype.checkActiveModule=function(){if(this.movingActive||this.rendering)return!1;for(var e=this.menuItems.indexOf(this.navigation.activeModule),s=!1,t=0,o=this.renderedItems;t<o.length;t++){if(o[t].module==this.navigation.activeModule){s=!0;break}}if(!s&&0!=e&&e+1>this.renderedItems.length){var i=this.menuItems.splice(e,1),a=this.renderedItems.pop();return a&&(a.componentRef.destroy(),this.menuItems.splice(this.renderedItems.length,0,i[0]),this.movingActive=!0,this.destroyMoreItem(),this.addMenuItem(this.menuItems[this.renderedItems.length],this.menuItems[this.renderedItems.length])),!1}return!0},e.prototype.destroyMenu=function(){for(var e=0,s=this.renderedItems;e<s.length;e++){s[e].componentRef.destroy()}this.renderedItems=[],this.destroyMoreItem(),this.movingActive=!1},e.prototype.renderMenu=function(){this.destroyMenu(),this.rendering=!0,this.addMenuItem(this.menuItems[0],this.menuItems[0])},e.prototype.addMenuItem=function(s,t){var o=this;this.metadata.addComponentDirect("GlobalNavigationMenuItem",this.menucontainer).subscribe(function(e){e.instance.item={module:s,name:t},o.renderedItems.push({module:s,componentRef:e})})},e.prototype.addMoreItem=function(){var t=this;this.destroyMoreItem(),this.metadata.addComponentDirect("GlobalNavigationMenuMore",this.menucontainer).subscribe(function(e){t.moreItems=[];for(var s=t.renderedItems.length;s<t.menuItems.length;)t.moreItems.push(t.menuItems[s]),s++;e.instance.moreMenuItems=t.moreItems,t.moreComponentRef={componentRef:e}})},e.prototype.destroyMoreItem=function(){this.moreComponentRef&&(this.moreComponentRef.componentRef.destroy(),this.moreComponentRef=void 0)},e.prototype.getRenderedWidth=function(){for(var e=0,s=0,t=this.renderedItems;s<t.length;s++){e+=t[s].width}return e},e.prototype.handleMessage=function(e){switch(e.messagetype){case"applauncher.setrole":case"loader.reloaded":this.buildMenuItems(),this.renderMenu();break;case"navigation.itemadded":for(var s=0,t=this.renderedItems;s<t.length;s++){var o=t[s];o.module===e.messagedata.module&&(o.width=e.messagedata.width)}var i=this.getRenderedWidth();if(this.movingActive)this.elementRef.nativeElement.offsetWidth,this.movingActive=!1,this.addMoreItem();else if(i>this.elementRef.nativeElement.offsetWidth)this.renderedItems.pop().componentRef.destroy(),this.menuItems.length>this.renderedItems.length?this.addMoreItem():this.rendering=!1;else this.menuItems.length>this.renderedItems.length&&this.addMenuItem(this.menuItems[this.renderedItems.length],this.menuItems[this.renderedItems.length]);break;case"navigation.moreadded":if(this.moreComponentRef.width=e.messagedata.width,0<this.renderedItems.length&&this.getRenderedWidth()+e.messagedata.width>this.elementRef.nativeElement.offsetWidth)this.renderedItems.pop().componentRef.destroy(),this.checkActiveModule()&&this.addMoreItem()}},__decorate([core_1.ViewChild("menucontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"menucontainer",void 0),__decorate([core_1.ViewChild("morecontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"morecontainer",void 0),e=__decorate([core_1.Component({selector:"global-navigation-menu",template:'<ul class="slds-grid"><div #menucontainer></div><div #morecontainer></div></ul>',providers:[MenuService],host:{"(window:resize)":"handleResize()"}}),__metadata("design:paramtypes",[MenuService,services_12.metadata,core_1.ElementRef,services_7.broadcast,services_13.navigation])],e)}();exports.GlobalNavigationMenu=GlobalNavigationMenu;var GlobalNavigationMenuItem=function(){function GlobalNavigationMenuItem(e,s,t,o,i,a,l,n,r,d){this.metadata=e,this.language=s,this.router=t,this.elementRef=o,this.broadcast=i,this.navigation=a,this.model=l,this.recent=n,this.favorite=r,this.renderer=d,this.itemtext="test",this.item={module:null,name:null},this.isOpen=!1,this.isInitialized=!1,this.itemMenu=[],this.favorites=[],this.menucomponents=[]}return GlobalNavigationMenuItem.prototype.executeMenuItem=function(t){var o=this;this.itemMenu.some(function(e,s){if(e.id===t){switch(e.action){case"add":o.isOpen=!1,o.model.addModel()}return!0}})},GlobalNavigationMenuItem.prototype.navigateTo=function(){this.isOpen=!1,this.router.navigate(["/module/"+this.item.module])},GlobalNavigationMenuItem.prototype.navigateRecent=function(e){this.isOpen=!1,this.router.navigate(["/module/"+this.item.module+"/"+e])},GlobalNavigationMenuItem.prototype.ngOnInit=function(){this.itemMenu=this.metadata.getModuleMenu(this.item.module),this.model.module=this.item.module},GlobalNavigationMenuItem.prototype.toggleOpen=function(){var s=this;this.isInitialized||this.initialize(),this.isOpen=!this.isOpen,this.isOpen?(this.favorites=this.getFavorites(),this.buildMenu(),this.clickListener=this.renderer.listen("document","click",function(e){return s.onClick(e)})):this.clickListener&&this.clickListener()},GlobalNavigationMenuItem.prototype.initialize=function(){var s=this;"Home"!=this.item.module?this.recent.getModuleRecent(this.item.module).subscribe(function(e){s.isInitialized=!0}):this.isInitialized=!0},Object.defineProperty(GlobalNavigationMenuItem.prototype,"recentitems",{get:function(){return this.recent.moduleItems[this.item.module]?this.recent.moduleItems[this.item.module]:[]},enumerable:!0,configurable:!0}),GlobalNavigationMenuItem.prototype.getFavorites=function(){return this.favorite.getFavorites(this.item.module)},GlobalNavigationMenuItem.prototype.onClick=function(e){(!this.elementRef.nativeElement.contains(e.target)||this.elementRef.nativeElement.contains(e.target)&&this.menulist.element.nativeElement.contains(e.target))&&(this.isOpen=!1)},GlobalNavigationMenuItem.prototype.hasMenu=function(){return 0<this.itemMenu.length||this.metadata.getModuleTrackflag(this.item.module)},GlobalNavigationMenuItem.prototype.getMenuLabel=function(e){return this.language.getModuleLabel(this.item.module,e)},GlobalNavigationMenuItem.prototype.isActive=function(){return this.navigation.activeModule==this.item.module},GlobalNavigationMenuItem.prototype.ngAfterViewInit=function(){this.broadcast.broadcastMessage("navigation.itemadded",{module:this.item.module,width:this.elementRef.nativeElement.offsetWidth}),this.model.module=this.item.module},GlobalNavigationMenuItem.prototype.buildMenu=function(){var t=this;this.destroyMenu();for(var e=function(s){switch(s.action){case"NEW":o.metadata.checkModuleAcl(o.item.module,"create")&&o.metadata.addComponent("GlobalNavigationMenuItemNew",o.menucontainer).subscribe(function(e){t.menucomponents.push(e)});break;case"ROUTE":o.metadata.addComponent("GlobalNavigationMenuItemRoute",o.menucontainer).subscribe(function(e){e.instance.actionconfig=s.actionconfig,t.menucomponents.push(e)})}},o=this,s=0,i=this.itemMenu;s<i.length;s++){e(i[s])}},GlobalNavigationMenuItem.prototype.ngOnDestroy=function(){this.destroyMenu()},GlobalNavigationMenuItem.prototype.destroyMenu=function(){for(var e=0,s=this.menucomponents;e<s.length;e++){s[e].destroy()}},__decorate([core_1.ViewChild("menulist",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalNavigationMenuItem.prototype,"menulist",void 0),__decorate([core_1.ViewChild("menucontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalNavigationMenuItem.prototype,"menucontainer",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],GlobalNavigationMenuItem.prototype,"itemtext",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],GlobalNavigationMenuItem.prototype,"item",void 0),GlobalNavigationMenuItem=__decorate([core_1.Component({selector:"global-navigation-menu-item",template:'<li class="slds-context-bar__dropdown-trigger slds-dropdown-trigger slds-dropdown-trigger--click" [ngClass]="{\'slds-is-open\': isOpen}" aria-haspopup="true"><a href="javascript:void(0);" class="slds-context-bar__label-action" (click)="navigateTo()"><span class="slds-truncate">{{language.getModuleName(item.name)}}</span></a><div *ngIf="hasMenu()" class="slds-context-bar__icon-action slds-p-left--none"><button class="slds-button slds-button--icon slds-context-bar__button" (click)="toggleOpen()"><system-button-icon [icon]="\'chevrondown\'"></system-button-icon></button></div><div class="slds-dropdown slds-nubbin--top"><ul #menulist class="slds-dropdown__list" role="menu"><div #menucontainer></div><ng-container *ngIf="favorites.length > 0"><li class="slds-has-divider--top-space" role="separator"></li><li class="slds-dropdown__header" role="separator"><span class="slds-text-title--caps">{{language.getLabel(\'LBL_FAVORITES\')}}</span></li><li *ngFor="let favorite of favorites" class="slds-dropdown__item" role="presentation" (click)="navigateRecent(favorite.item_id)"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{favorite.item_summary}}</span></a></li></ng-container><ng-container *ngIf="item.module != \'Home\'"><li class="slds-has-divider--top-space" role="separator"></li><li class="slds-dropdown__header" role="separator"><span class="slds-text-title--caps">{{language.getLabel(\'LBL_RECENTLYVIEWED\')}}</span></li><li *ngFor="let recentItem of recentitems" class="slds-dropdown__item" role="presentation" (click)="navigateRecent(recentItem.item_id)"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{recentItem.item_summary}}</span></a></li><li class="slds-dropdown__item slds-align--absolute-center slds-text-color_inverse-weak slds-p-around--xx-small" *ngIf="recentitems.length == 0 && isInitialized">{{language.getLabel(\'LBL_NO_ENTRIES\')}}</li></ng-container></ul><system-spinner *ngIf="!isInitialized" size="16"></system-spinner></div></li>',host:{"[class.slds-context-bar__item]":"true","[class.slds-is-active]":"isActive()"},providers:[services_9.model]}),__metadata("design:paramtypes",[services_12.metadata,services_4.language,router_1.Router,core_1.ElementRef,services_7.broadcast,services_13.navigation,services_9.model,services_10.recent,services_11.favorite,core_1.Renderer2])],GlobalNavigationMenuItem)}();exports.GlobalNavigationMenuItem=GlobalNavigationMenuItem;var GlobalNavigationMenuItemNew=function(){function GlobalNavigationMenuItemNew(e,s){this.language=e,this.model=s}return GlobalNavigationMenuItemNew.prototype.exceuteItem=function(){this.model.id="",this.model.addModel()},GlobalNavigationMenuItemNew=__decorate([core_1.Component({selector:"global-navigation-menu-item-new",template:'<li class="slds-dropdown__item" role="presentation" (click)="exceuteItem()"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><global-nevigation-menu-item-icon [icon]="\'add\'"></global-nevigation-menu-item-icon>{{language.getModuleName(model.module, true)}}</span></a></li>'}),__metadata("design:paramtypes",[services_4.language,services_9.model])],GlobalNavigationMenuItemNew)}();exports.GlobalNavigationMenuItemNew=GlobalNavigationMenuItemNew;var GlobalNavigationMenuItemRoute=function(){function GlobalNavigationMenuItemRoute(e,s,t,o){this.metadata=e,this.language=s,this.model=t,this.router=o,this.actionconfig={}}return Object.defineProperty(GlobalNavigationMenuItemRoute.prototype,"actionicon",{get:function(){return this.actionconfig.icon?this.actionconfig.icon:"chevronright"},enumerable:!0,configurable:!0}),Object.defineProperty(GlobalNavigationMenuItemRoute.prototype,"actionlabel",{get:function(){if(this.actionconfig.label&&-1<this.actionconfig.label.indexOf(":")){var e=this.actionconfig.label.split(":");return this.language.getLabel(e[0],e[1])}return this.language.getLabel(this.actionconfig.label)},enumerable:!0,configurable:!0}),GlobalNavigationMenuItemRoute.prototype.exceuteItem=function(){this.router.navigate([this.actionconfig.route])},GlobalNavigationMenuItemRoute=__decorate([core_1.Component({selector:"global-navigation-menu-item-route",template:'<li class="slds-dropdown__item" role="presentation" (click)="exceuteItem()"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate"><global-nevigation-menu-item-icon [icon]="actionicon"></global-nevigation-menu-item-icon>{{actionlabel}}</span></a></li>'}),__metadata("design:paramtypes",[services_12.metadata,services_4.language,services_9.model,router_1.Router])],GlobalNavigationMenuItemRoute)}();exports.GlobalNavigationMenuItemRoute=GlobalNavigationMenuItemRoute;var GlobalNavigationMenuItemIcon=function(){function e(){this.icon=""}return e.prototype.getSvgHRef=function(){return"./sldassets/icons/utility-sprite/svg/symbols.svg#"+this.icon},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"icon",void 0),e=__decorate([core_1.Component({selector:"global-nevigation-menu-item-icon",template:'<svg aria-hidden="true" class="slds-icon slds-icon--x-small slds-icon-text-default slds-m-right--x-small"><use [attr.xlink:href]="getSvgHRef()"></use></svg>'})],e)}();exports.GlobalNavigationMenuItemIcon=GlobalNavigationMenuItemIcon;var GlobalNavigationMenuMore=function(){function GlobalNavigationMenuMore(e,s,t,o){this.language=e,this.router=s,this.elementRef=t,this.broadcast=o,this.moreMenuItems=[]}return GlobalNavigationMenuMore.prototype.navigateTo=function(e){this.router.navigate(["/module/"+e])},GlobalNavigationMenuMore.prototype.ngAfterViewInit=function(){this.broadcast.broadcastMessage("navigation.moreadded",{module:"more",width:this.elementRef.nativeElement.offsetWidth})},GlobalNavigationMenuMore=__decorate([core_1.Component({selector:"global-navigation-menu-more",template:'<li class="slds-context-bar__dropdown-trigger slds-dropdown-trigger slds-dropdown-trigger--hover" aria-haspopup="true"><a href="javascript:void(0);" class="slds-context-bar__label-action"><span class="slds-truncate">{{language.getLabel(\'LBL_MORE\')}}</span></a><div class="slds-context-bar__icon-action slds-p-left--none"><button class="slds-button slds-button--icon slds-context-bar__button"><system-button-icon [icon]="\'down\'"></system-button-icon></button></div><div class="slds-dropdown slds-dropdown--right"><ul class="slds-dropdown__list" role="menu"><li *ngFor="let item of moreMenuItems" class="slds-dropdown__item" role="presentation" (click)="navigateTo(item)"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getModuleName(item)}}</span></a></li></ul></div></li>',host:{"[class.slds-context-bar__item]":"true"}}),__metadata("design:paramtypes",[services_4.language,router_1.Router,core_1.ElementRef,services_7.broadcast])],GlobalNavigationMenuMore)}();exports.GlobalNavigationMenuMore=GlobalNavigationMenuMore;var GlobalNavigationCompact=function(){function e(e,s,t,o,i,a,l,n,r,d,c,u,m){var p=this;this.menuService=e,this.metadata=s,this.language=t,this.loginService=o,this.navigation=i,this.favorite=a,this.model=l,this.recent=n,this.session=r,this.modal=d,this.cdr=c,this.broadcast=u,this.router=m,this.showmenu=!1,this.menuitems=[],this.activeItem="",this.activeItemMenu=[],this.activeItemMenucomponents=[],this.subscriptions=new rxjs_1.Subscription,this.buildMenuItems();var h=this.navigation.activeModule$.subscribe(function(e){return p.buildModuleMenuItems()});this.subscriptions.add(h);var g=this.broadcast.message$.subscribe(function(e){p.handleMessage(e)});this.subscriptions.add(g)}return Object.defineProperty(e.prototype,"activeItemIsModule",{get:function(){return!!this.metadata.getModuleDefs(this.activeItem)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentlanguage",{get:function(){return this.language.currentlanguage},set:function(e){this.language.currentlanguage=e,this.language.loadLanguage()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menuItems",{get:function(){var s=this;return this.menuitems.filter(function(e){return e!=s.activeItem})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeRoleName",{get:function(){var e=this.metadata.getActiveRole();return e.label&&""!=e.label?this.language.getLabel(e.label):this.metadata.getActiveRole().name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"containerMiddleStyle",{get:function(){return{height:"calc(100vh - "+(this.containermiddle.element.nativeElement.offsetTop+this.containerbottom.element.nativeElement.offsetHeight)+"px)"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menuStyle",{get:function(){return{left:this.showmenu?"0px":"-250px","box-shadow":this.showmenu?"5px 0 15px #888":"none"}},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.buildModuleMenuItems(),this.cdr.detectChanges()},e.prototype.handleMessage=function(e){switch(e.messagetype){case"applauncher.setrole":case"loader.reloaded":this.buildMenuItems()}},e.prototype.navigateTo=function(e){this.router.navigate(["/module/"+e]),this.showmenu=!1},e.prototype.buildMenuItems=function(){this.menuitems=[];for(var e=0,s=this.metadata.getRoleModules(!0);e<s.length;e++){var t=s[e];this.menuitems.push(t)}},e.prototype.buildModuleMenuItems=function(){this.activeItem=this.navigation.activeModule,this.destroyActiveItemMenu(),this.activeItemMenu=[],this.activeItemIsModule&&this.menucontainer&&(this.model.module=this.activeItem,this.activeItemMenu=this.metadata.getModuleMenu(this.activeItem),this.buildActiveItemMenu())},e.prototype.showAppLauncher=function(){this.showmenu=!1,this.modal.openModal("GlobalAppLauncherDialog")},e.prototype.getAvialableLanguages=function(){return this.language.getAvialableLanguages(!0)},e.prototype.toggleMenu=function(){this.showmenu=!this.showmenu},e.prototype.closeMenu=function(){this.showmenu=!1},e.prototype.logout=function(){this.loginService.logout()},e.prototype.trackByFn=function(e,s){return s.id},e.prototype.buildActiveItemMenu=function(){for(var t=this,e=function(s){switch(s.action){case"NEW":o.metadata.checkModuleAcl(o.activeItem,"create")&&o.metadata.addComponent("GlobalNavigationMenuItemNew",o.menucontainer).pipe(operators_1.take(1)).subscribe(function(e){t.activeItemMenucomponents.push(e)});break;case"ROUTE":o.metadata.addComponent("GlobalNavigationMenuItemRoute",o.menucontainer).pipe(operators_1.take(1)).subscribe(function(e){e.instance.actionconfig=s.actionconfig,t.activeItemMenucomponents.push(e)})}},o=this,s=0,i=this.activeItemMenu;s<i.length;s++){e(i[s])}},e.prototype.destroyActiveItemMenu=function(){for(var e=0,s=this.activeItemMenucomponents;e<s.length;e++){s[e].destroy()}},e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe(),this.destroyActiveItemMenu(),this.cdr.detach()},__decorate([core_1.ViewChild("containermiddle",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"containermiddle",void 0),__decorate([core_1.ViewChild("containerbottom",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"containerbottom",void 0),__decorate([core_1.ViewChild("menucontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"menucontainer",void 0),e=__decorate([core_1.Component({selector:"global-navigation-compact",template:'<button class="slds-button slds-button--icon" (click)="toggleMenu()"><system-utility-icon icon="rows" size="small"></system-utility-icon></button><div class="slds-is-absolute slds-theme--shade" style="width: 250px; top: 0; z-index: 998; height: 100vh; transition: left 1s" [ngStyle]="menuStyle"><div class="slds-grid slds-grid--align-spread slds-grid--vertical-align-start slds-p-around--x-small"><div class="slds-grid slds-grid--vertical-align-center"><div style="transform:scale(0.8);" (click)="showAppLauncher()"><a href="javascript:void(0);" class="slds-icon-waffle_container"><div class="slds-icon-waffle"><div class="slds-r1"></div><div class="slds-r2"></div><div class="slds-r3"></div><div class="slds-r4"></div><div class="slds-r5"></div><div class="slds-r6"></div><div class="slds-r7"></div><div class="slds-r8"></div><div class="slds-r9"></div></div></a></div><div class="slds-truncate slds-p-left--xx-small slds-text-heading_small">{{activeRoleName}}</div></div><button class="slds-button slds-button--icon" (click)="closeMenu()"><system-button-icon icon="close"></system-button-icon></button></div><div *ngIf="activeItemIsModule" class="slds-theme--default slds-p-vertical--x-small"><div class="slds-grid slds-grid--vertical-align-center slds-p-left--small slds-p-vertical--xx-small"><system-icon [module]="activeItem" size="x-small" divClass></system-icon><a href="javascript:void(0);" class="slds-p-left--small slds-text-heading_small"><span class="slds-truncate" style="font-weight: bold;">{{language.getModuleName(activeItem)}}</span></a></div><ul role="menu" (click)="closeMenu()"><ng-container #menucontainer></ng-container></ul></div><div #containermiddle [ngStyle]="containerMiddleStyle" class="slds-grid"><div class="slds-has-divider--bottom-space slds-scrollable--y spicecrm-scrollbar" style="width: 100%;"><div *ngFor="let item of menuItems; trackBy: trackByFn" (click)="navigateTo(item)" class="slds-grid slds-grid--vertical-align-center slds-p-vertical--x-small slds-p-left--small"><system-icon [module]="item" size="x-small" divClass></system-icon><a href="javascript:void(0);" class="slds-p-left--small slds-text-heading_small"><span class="slds-truncate">{{language.getModuleName(item)}}</span></a></div></div></div><div #containerbottom class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small"><div class="slds-form-element slds-grow"><div class="slds-form-element__control"><div class="slds-select_container"><select [disabled]="getAvialableLanguages().length <= 1" class="slds-select" [(ngModel)]="currentlanguage"><option *ngFor="let language of getAvialableLanguages()" [value]="language.language">{{language.text}}</option></select></div></div></div><div class="slds-grid slds-grid--align-end slds-p-horizontal--small slds-col--bump-left"><system-utility-icon icon="logout" size="x-small" [title]="language.getLabel(\'LBL_LOGOFF\')" (click)="logout()"></system-utility-icon></div></div></div>',providers:[MenuService,services_9.model]}),__metadata("design:paramtypes",[MenuService,services_12.metadata,services_4.language,services_1.loginService,services_13.navigation,services_11.favorite,services_9.model,services_10.recent,services_2.session,services_19.modal,core_1.ChangeDetectorRef,services_7.broadcast,router_1.Router])],e)}();exports.GlobalNavigationCompact=GlobalNavigationCompact;var GlobalDockedComposerContainer=function(){function e(e){this.dockedComposer=e}return Object.defineProperty(e.prototype,"isVisible",{get:function(){return 0<this.dockedComposer.composers.length||0<this.dockedComposer.calls.length},enumerable:!0,configurable:!0}),e.prototype.closeComposer=function(){},e.prototype.getComposerStyle=function(e){if(e>=this.dockedComposer.maxComposers-this.dockedComposer.calls.length)return{display:"none"}},Object.defineProperty(e.prototype,"displayOverflow",{get:function(){return this.dockedComposer.composers.length+this.dockedComposer.calls.length>this.dockedComposer.maxComposers},enumerable:!0,configurable:!0}),e=__decorate([core_1.Component({selector:"global-docked-composer-container",template:'<global-docked-composer-overflow *ngIf="displayOverflow"></global-docked-composer-overflow><global-docked-composer *ngFor="let composer of dockedComposer.composers; let i = index;" [composerindex]="i" [composerdata]="composer" [ngStyle]="getComposerStyle(i)"></global-docked-composer><global-docked-composer-call *ngFor="let call of dockedComposer.calls" [calldata]="call"></global-docked-composer-call>',host:{"[class.slds-docked_container]":"isVisible",style:"z-index: 9999"}}),__metadata("design:paramtypes",[services_14.dockedComposer])],e)}();exports.GlobalDockedComposerContainer=GlobalDockedComposerContainer;var GlobalDockedComposer=function(){function GlobalDockedComposer(e,s,t,o,i,a,l){this.metadata=e,this.dockedComposer=s,this.language=t,this.model=o,this.view=i,this.modal=a,this.ViewContainerRef=l,this.composerdata={},this.isClosed=!1,this.view.isEditable=!0,this.view.setEditMode()}return GlobalDockedComposer.prototype.ngOnInit=function(){this.model.module=this.composerdata.module,this.model.id=this.composerdata.id,this.composerdata.model.data?this.model.data=this.composerdata.model.data:this.model.initializeModel(),this.dockedComposer.composers[this.composerindex].model=this.model;var s=this.metadata.getComponentConfig("GlobalDockedComposer",this.model.module);if(s.componentset)for(var e=this.metadata.getComponentSetObjects(s.componentset),t=function(s){o.metadata.addComponent("ObjectRecordFieldset",o.containercontent).subscribe(function(e){e.instance.componentconfig=s.componentconfig})},o=this,i=0,a=e;i<a.length;i++){t(a[i])}else s.fieldset&&this.metadata.addComponent("ObjectRecordFieldset",this.containercontent).subscribe(function(e){e.instance.direction="vertical",e.instance.fieldset=s.fieldset})},Object.defineProperty(GlobalDockedComposer.prototype,"displayLabel",{get:function(){return this.model.data.name?this.model.data.name:this.language.getModuleName(this.model.module,!0)},enumerable:!0,configurable:!0}),GlobalDockedComposer.prototype.toggleClosed=function(){this.isClosed=!this.isClosed},Object.defineProperty(GlobalDockedComposer.prototype,"toggleIcon",{get:function(){return this.isClosed?"erect_window":"minimize_window"},enumerable:!0,configurable:!0}),GlobalDockedComposer.prototype.expand=function(){this.modal.openModal("GlobalDockedComposerModal",!0,this.ViewContainerRef.injector)},GlobalDockedComposer.prototype.closeComposer=function(){for(var e=0;e<this.dockedComposer.composers.length;e++)this.dockedComposer.composers[e].id===this.composerdata.id&&this.dockedComposer.composers.splice(e,1)},GlobalDockedComposer.prototype.saveComposer=function(t){var o=this;void 0===t&&(t=!1),this.model.save().subscribe(function(e){t&&o.model.goDetail();for(var s=0;s<o.dockedComposer.composers.length;s++)o.dockedComposer.composers[s].id===o.composerdata.id&&o.dockedComposer.composers.splice(s,1)})},__decorate([core_1.ViewChild("containercontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalDockedComposer.prototype,"containercontent",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],GlobalDockedComposer.prototype,"composerdata",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],GlobalDockedComposer.prototype,"composerindex",void 0),GlobalDockedComposer=__decorate([core_1.Component({selector:"global-docked-composer",template:'<section class="slds-docked-composer slds-grid slds-grid_vertical slds-m-horizontal--x-small" [ngClass]="{\'slds-is-closed\': isClosed, \'slds-is-open\': !isClosed}" role="dialog"><header class="slds-docked-composer__header slds-grid slds-shrink-none" aria-live="assertive"><div class="slds-media slds-media_center slds-no-space"><div class="slds-media__figure slds-m-right_x-small"><span class="slds-icon_container"><system-icon [module]="model.module" [size]="\'small\'"></system-icon></span></div><div class="slds-media__body"><h2 class="slds-truncate">{{displayLabel}}</h2></div></div><div class="slds-col_bump-left slds-shrink-none"><button class="slds-button slds-button_icon slds-button_icon" (click)="toggleClosed()"><system-button-icon [icon]="toggleIcon"></system-button-icon></button> <button class="slds-button slds-button_icon slds-button_icon" (click)="expand()"><system-button-icon [icon]="\'expand_alt\'"></system-button-icon></button> <button class="slds-button slds-button_icon slds-button_icon" (click)="closeComposer()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></div></header><div class="slds-docked-composer__body slds-theme--default slds-scrollable" style="height: 380px;"><div #containercontent></div></div><footer class="slds-docked-composer__footer slds-shrink-none"><div class="slds-col_bump-left slds-text-align_right"><button class="slds-button slds-button--neutral" (click)="closeComposer()">{{language.getLabel(\'LBL_CANCEL\')}}</button> <button class="slds-button slds-button--brand" (click)="saveComposer()">{{language.getLabel(\'LBL_SAVE\')}}</button> <button class="slds-button slds-button--brand" (click)="saveComposer(true)">{{language.getLabel(\'LBL_SAVE_AND_GO_TO_RECORD\')}}</button></div></footer></section>',providers:[services_9.model,services_15.view]}),__metadata("design:paramtypes",[services_12.metadata,services_14.dockedComposer,services_4.language,services_9.model,services_15.view,services_19.modal,core_1.ViewContainerRef])],GlobalDockedComposer)}();exports.GlobalDockedComposer=GlobalDockedComposer;var GlobalDockedComposerCall=function(){function e(e,s,t,o){this.backend=e,this.dockedComposer=s,this.language=t,this.ViewContainerRef=o,this.calldata={},this.searching=!0,this.contact={},this.isClosed=!1}return Object.defineProperty(e.prototype,"callicon",{get:function(){if("END"==this.calldata.callevent)return"end_call";switch(this.calldata.direction){case"INBOUND":return"incoming_call";case"OUTBOUND":return"outbound_call"}return"call"},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var s=this;this.backend.postRequest("search",{},{modules:"Contacts",searchterm:this.calldata.callnumber}).subscribe(function(e){try{s.contact=e.Contacts.hits[0]._source,s.searching=!1}catch(e){s.searching=!1}})},e.prototype.closeComposer=function(){var s=this,t=0;this.dockedComposer.calls.some(function(e){if(e.callid==s.calldata.callid)return s.dockedComposer.calls.splice(t,1),!0;t++})},__decorate([core_1.ViewChild("containercontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"containercontent",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"calldata",void 0),e=__decorate([core_1.Component({selector:"global-docked-composer-call",template:'<section class="slds-docked-composer slds-grid slds-grid_vertical slds-m-horizontal--x-small" [ngClass]="{\'slds-is-closed\': isClosed, \'slds-is-open\': !isClosed}" role="dialog"><header class="slds-docked-composer__header slds-grid slds-shrink-none" aria-live="assertive"><div class="slds-media slds-media_center slds-no-space"><div class="slds-media__figure slds-m-right_x-small"><span class="slds-icon_container"><system-icon [icon]="callicon" sprite="utility" size="x-small"></system-icon></span></div><div class="slds-media__body"><h2 class="slds-truncate">{{calldata.direction}} Call {{calldata.callevent}}</h2></div></div><div class="slds-col_bump-left slds-shrink-none"><button class="slds-button slds-button_icon slds-button_icon" (click)="toggleClosed()"><system-button-icon [icon]="toggleIcon"></system-button-icon></button> <button class="slds-button slds-button_icon slds-button_icon" (click)="expand()"><system-button-icon [icon]="\'expand_alt\'"></system-button-icon></button> <button class="slds-button slds-button_icon slds-button_icon" (click)="closeComposer()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></div></header><div class="slds-align_absolute-center slds-size_1-of-1"><div class="slds-text-align_center slds-align-middle"><ng-container *ngIf="!searching"><span class="slds-avatar slds-avatar_large"><img [src]="contact.salutation == \'Mr.\' ? \'sldassets/images/avatar1.jpg\' : \'sldassets/images/avatar2.jpg\'"></span><h3 class="slds-text-heading_large">{{contact.summary_text}}</h3><ul class="slds-list_horizontal slds-has-dividers_right slds-text-body_small"><li class="slds-item">{{contact.account_name}}</li></ul></ng-container><div *ngIf="searching" class="slds-p-around--small slds-align--absolute-center"><system-spinner></system-spinner></div><p class="slds-text-heading_medium slds-m-top_medium">{{calldata.callnumber}}</p><p>{{callid}}</p></div></div><footer class="slds-docked-composer__footer slds-shrink-none"><button class="slds-button slds-button--brand slds-col_bump-left" (click)="closeComposer()">{{language.getLabel(\'LBL_CLOSE\')}}</button></footer></section>'}),__metadata("design:paramtypes",[services_3.backend,services_14.dockedComposer,services_4.language,core_1.ViewContainerRef])],e)}();exports.GlobalDockedComposerCall=GlobalDockedComposerCall;var GlobalDockedComposerModal=function(){function GlobalDockedComposerModal(e,s,t,o,i){this.metadata=e,this.dockedComposer=s,this.language=t,this.model=o,this.view=i,this.self={},this.isClosed=!1,this.view.isEditable=!0,this.view.setEditMode()}return GlobalDockedComposerModal.prototype.ngOnInit=function(){var s=this.metadata.getComponentConfig("GlobalDockedComposerModal",this.model.module);if(s.fieldset||s.componentset||(s=this.metadata.getComponentConfig("GlobalDockedComposer",this.model.module)),s.componentset)for(var e=this.metadata.getComponentSetObjects(s.componentset),t=function(s){o.metadata.addComponent(s.component,o.containercontent).subscribe(function(e){e.instance.componentconfig=s.componentconfig})},o=this,i=0,a=e;i<a.length;i++){t(a[i])}else s.fieldset&&this.metadata.addComponent("ObjectRecordFieldset",this.containercontent).subscribe(function(e){e.instance.direction="vertical",e.instance.fieldset=s.fieldset})},Object.defineProperty(GlobalDockedComposerModal.prototype,"displayLabel",{get:function(){return this.model.data.name?this.model.data.name:this.language.getModuleName(this.model.module,!0)},enumerable:!0,configurable:!0}),GlobalDockedComposerModal.prototype.minimize=function(){this.self.destroy()},GlobalDockedComposerModal.prototype.closeComposer=function(){for(var e=0;e<this.dockedComposer.composers.length;e++)this.dockedComposer.composers[e].id===this.model.id&&this.dockedComposer.composers.splice(e,1);this.self.destroy()},GlobalDockedComposerModal.prototype.saveComposer=function(){var t=this;this.model.save().subscribe(function(e){for(var s=0;s<t.dockedComposer.composers.length;s++)t.dockedComposer.composers[s].id===t.model.id&&t.dockedComposer.composers.splice(s,1);t.self.destroy()})},__decorate([core_1.ViewChild("containercontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],GlobalDockedComposerModal.prototype,"containercontent",void 0),GlobalDockedComposerModal=__decorate([core_1.Component({selector:"global-docked-composer-modal",template:'<system-modal size="medium"><system-modal-header [module]="model.module" (close)="minimize()">{{displayLabel}}</system-modal-header><system-modal-content><div #containercontent></div></system-modal-content><system-modal-footer><div class="slds-col_bump-left slds-text-align_right"><button class="slds-button slds-button--neutral" (click)="closeComposer()">{{language.getLabel(\'LBL_CANCEL\')}}</button> <button class="slds-button slds-button--brand" (click)="saveComposer()">{{language.getLabel(\'LBL_SAVE\')}}</button></div></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_12.metadata,services_14.dockedComposer,services_4.language,services_9.model,services_15.view])],GlobalDockedComposerModal)}();exports.GlobalDockedComposerModal=GlobalDockedComposerModal;var GlobalDockedComposerOverflow=function(){function e(e,s,t,o){this.renderer=e,this.elementRef=s,this.dockedComposer=t,this.language=o,this.showHiddenComposers=!1}return e.prototype.ngOnDestroy=function(){this.clickListener&&this.clickListener()},Object.defineProperty(e.prototype,"hiddenCount",{get:function(){return this.dockedComposer.composers.length+this.dockedComposer.calls.length-this.dockedComposer.maxComposers},enumerable:!0,configurable:!0}),e.prototype.toggleHiddenComoposers=function(){var s=this;this.showHiddenComposers=!this.showHiddenComposers,this.showHiddenComposers?this.clickListener=this.renderer.listen("document","click",function(e){return s.onClick(e)}):this.clickListener&&this.clickListener()},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.showHiddenComposers=!1,this.clickListener())},Object.defineProperty(e.prototype,"overflowComposers",{get:function(){return this.dockedComposer.composers.slice(this.dockedComposer.maxComposers-this.dockedComposer.calls.length)},enumerable:!0,configurable:!0}),e.prototype.displayLabel=function(e){return e.model.data.name?e.model.data.name:this.language.getModuleName(e.model.module,!0)},e.prototype.focusComposer=function(e){this.dockedComposer.focusComposer(e),this.showHiddenComposers=!1},e=__decorate([core_1.Component({selector:"global-docked-composer-overflow",template:'<div class="slds-docked-composer slds-docked-composer_overflow slds-m-horizontal--x-small"><button class="slds-button slds-button_icon slds-docked-composer_overflow__button" (click)="toggleHiddenComoposers()"><system-button-icon [icon]="\'standard_objects\'"></system-button-icon><span class="slds-text-body_small slds-m-left_xx-small">{{hiddenCount}}</span></button><div class="slds-dropdown slds-dropdown_left slds-dropdown_bottom slds-dropdown_medium slds-nubbin_bottom-left" *ngIf="showHiddenComposers"><ul class="slds-dropdown__list slds-dropdown_length-with-icon-7" role="menu"><li class="slds-dropdown__item" role="presentation" *ngFor="let overflowComposer of overflowComposers"><a href="javascript:void(0);" role="menuitem" (click)="focusComposer(overflowComposer.id)"><div class="slds-media slds-media_center slds-no-space"><div class="slds-media__figure slds-m-right_x-small"><span class="slds-icon_container"><system-icon [module]="overflowComposer.module" [size]="\'small\'"></system-icon></span></div><div class="slds-media__body"><h2 class="slds-truncate">{{displayLabel(overflowComposer)}}</h2></div></div></a></li></ul></div></div>'}),__metadata("design:paramtypes",[core_1.Renderer2,core_1.ElementRef,services_14.dockedComposer,services_4.language])],e)}();exports.GlobalDockedComposerOverflow=GlobalDockedComposerOverflow;var GlobalComposeButton=function(){function e(e){this.dockedComposer=e,this.module=""}return e.prototype.showComposer=function(){this.dockedComposer.addComposer(this.module)},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),e=__decorate([core_1.Component({selector:"global-compose-button",template:'<div class="slds-no-flex"><button class="slds-button slds-button--neutral" (click)="showComposer()">New</button></div>'}),__metadata("design:paramtypes",[services_14.dockedComposer])],e)}();exports.GlobalComposeButton=GlobalComposeButton;var GlobalAppLauncher=function(){function e(e,s,t,o,i){this.metadata=e,this.modal=s,this.language=t,this.router=o,this.broadcast=i}return e.prototype.getRoleName=function(){var e=this.metadata.getActiveRole();return e.label&&""!=e.label?this.language.getLabel(e.label):this.metadata.getActiveRole().name},e.prototype.showAppLauncher=function(){this.modal.openModal("GlobalAppLauncherDialog")},e=__decorate([core_1.Component({selector:"global-app-launcher",template:'<div class="slds-context-bar__item slds-context-bar__dropdown-trigger slds-dropdown-trigger slds-dropdown-trigger--click slds-no-hover"><div class="slds-context-bar__icon-action slds-m-top_small" (click)="showAppLauncher()"><a href="javascript:void(0);" class="slds-icon-waffle_container slds-context-bar__button"><div class="slds-icon-waffle"><div class="slds-r1"></div><div class="slds-r2"></div><div class="slds-r3"></div><div class="slds-r4"></div><div class="slds-r5"></div><div class="slds-r6"></div><div class="slds-r7"></div><div class="slds-r8"></div><div class="slds-r9"></div></div></a></div><span class="slds-context-bar__label-action slds-context-bar__app-name"><span class="slds-truncate">{{getRoleName()}}</span></span></div>',host:{class:"slds-context-bar__primary slds-context-bar__item--divider-right"}}),__metadata("design:paramtypes",[services_12.metadata,services_19.modal,services_4.language,router_1.Router,services_7.broadcast])],e)}();exports.GlobalAppLauncher=GlobalAppLauncher;var GlobalAppLauncherDialog=function(){function GlobalAppLauncherDialog(e,s,t,o){this.metadata=e,this.language=s,this.router=t,this.broadcast=o,this.searchTerm="",this.self=void 0}return Object.defineProperty(GlobalAppLauncherDialog.prototype,"showRoles",{get:function(){return 1<this.metadata.getRoles().length},enumerable:!0,configurable:!0}),GlobalAppLauncherDialog.prototype.close=function(){this.self.destroy()},GlobalAppLauncherDialog.prototype.getRoleName=function(){return this.metadata.getActiveRole().name},GlobalAppLauncherDialog.prototype.getRoles=function(){return this.metadata.getRoles()},GlobalAppLauncherDialog.prototype.setRole=function(e){this.metadata.setActiveRole(e),this.broadcast.broadcastMessage("applauncher.setrole",e),this.close()},GlobalAppLauncherDialog.prototype.getModules=function(){for(var t=this,e=[],s=0,o=this.metadata.getModules();s<o.length;s++){var i=o[s];this.metadata.getModuleDefs(i).visible&&this.metadata.checkModuleAcl(i,"list")&&(""===this.searchTerm||""!==this.searchTerm&&this.language.getModuleName(i)&&0<=this.language.getModuleName(i).toLowerCase().indexOf(this.searchTerm.toLowerCase()))&&e.push(i)}return e.sort(function(e,s){return t.language.getModuleName(e)>t.language.getModuleName(s)?1:-1}),e},GlobalAppLauncherDialog.prototype.gotoModule=function(e){this.router.navigate(["/module/"+e]),this.close()},GlobalAppLauncherDialog=__decorate([core_1.Component({selector:"global-app-launcher-dialog",template:'<section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large slds-app-launcher__content" aria-modal="true"><div class="slds-modal__container"><header class="slds-modal__header slds-theme--shade"><button class="slds-button slds-button_icon slds-modal__close slds-button--icon-inverse" (click)="close()"><system-button-icon [icon]="\'close\'" [size]="\'large\'"></system-button-icon><span class="slds-assistive-text">{{language.getLabel(\'LBL_CLOSE\')}}</span></button><div class="slds-grid slds-grid--align-spread slds-grid--vertical-align-center"><h2 class="slds-text-heading--medium slds-show--medium">{{language.getLabel(\'LBL_APP_LAUNCHER\')}}</h2><div class="slds-app-launcher__header-search"><div class="slds-form-element"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--left"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon slds-input__icon--left\'"></system-utility-icon><input type="search" class="slds-input" [(ngModel)]="searchTerm" [placeholder]="language.getLabel(\'LBL_FIND_CONFMODULE\')" autofocus></div></div></div><button class="slds-button slds-button--neutral slds-show--medium" disabled>App Store</button></div></header><system-modal-content margin="small" [grow]="true"><system-section titlelabel="LBL_ROLES" *ngIf="showRoles"><ul class="slds-grid slds-grid--pull-padded slds-wrap"><li *ngFor="let role of getRoles()" class="slds-p-horizontal--small slds-size--1-of-1 slds-medium-size--1-of-3" (click)="setRole(role.id)"><global-app-launcher-dialog-role-tile [role]="role"></global-app-launcher-dialog-role-tile></li></ul></system-section><system-section titlelabel="LBL_MODULES"><ul class="slds-grid slds-grid--pull-padded slds-wrap"><li *ngFor="let module of getModules()" class="slds-p-around--small slds-size--xx-small" (click)="gotoModule(module)"><div class="slds-app-launcher__tile-figure slds-app-launcher__tile-figure--small slds-text-link_reset"><system-icon [module]="module" [size]="\'large\'"></system-icon></div><div class="slds-align_absolute-center slds-p-top--xx-small"><p class="slds-truncate slds-text-link_reset" [title]="language.getModuleName(module)">{{language.getModuleName(module)}}</p></div></li></ul></system-section></system-modal-content></div></section>'}),__metadata("design:paramtypes",[services_12.metadata,services_4.language,router_1.Router,services_7.broadcast])],GlobalAppLauncherDialog)}();exports.GlobalAppLauncherDialog=GlobalAppLauncherDialog;var GlobalAppLauncherDialogRoleTile=function(){function e(e,s){this.language=e,this.metadata=s}return e.prototype.ngOnInit=function(){this.buildRoleLabels()},e.prototype.buildRoleLabels=function(){var s=this;this.metadata.getRoles().some(function(e){if(e.id==s.role.id)return s.identifier=s.language.getAppLanglabel(e.label,"short"),s.name=s.language.getAppLanglabel(e.label),s.description=s.language.getAppLanglabel(e.label,"long"),s.description&&75<s.description.length&&(s.descriptionfull=s.description,s.description=s.description.substr(0,75)+"..."),!0})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"role",void 0),e=__decorate([core_1.Component({selector:"global-app-launcher-dialog-role-tile",template:'<div class="slds-app-launcher__tile slds-text-link_reset slds-is-relative"><div class="slds-app-launcher__tile-figure"><span class="slds-avatar slds-avatar--large slds-align--absolute-center {{role.icon}}">{{identifier}}</span></div><div class="slds-app-launcher__tile-body"><a href="javascript:void(0);">{{name}}</a><p>{{description}} <button #morebutton class="slds-button slds-button_reset slds-text-link" [ngClass]="{\'slds-hide\': !descriptionfull}" [title]="descriptionfull">{{language.getLabel(\'LBL_MORE\')}}</button></p><div class="slds-popover slds-popover_tooltip slds-nubbin_top slds-hide" *ngIf="descriptionfull" role="tooltip" style="position:absolute;top:100px;left:165px"><div class="slds-popover__body">{{descriptionfull}}</div></div></div></div>'}),__metadata("design:paramtypes",[services_4.language,services_12.metadata])],e)}();exports.GlobalAppLauncherDialogRoleTile=GlobalAppLauncherDialogRoleTile;var GlobalUser=function(){function e(e,s,t,o,i,a){var l=this;this.loginService=e,this.router=s,this.elementRef=t,this.renderer=o,this.popup=i,this.session=a,this.hideUserDetails=!0,i.closePopup$.subscribe(function(e){l.hideUserDetails=!0})}return e.prototype.toggleUserDetails=function(){var s=this;this.hideUserDetails=!this.hideUserDetails,this.hideUserDetails?this.clickListener&&this.clickListener():this.clickListener=this.renderer.listen("document","click",function(e){return s.onClick(e)})},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.hideUserDetails=!0,this.clickListener())},Object.defineProperty(e.prototype,"userimage",{get:function(){return this.session.authData.userimage},enumerable:!0,configurable:!0}),e=__decorate([core_1.Component({selector:"global-user",template:'<button class="slds-button" style="min-width: 32px;" aria-haspopup="true" (click)="toggleUserDetails()"><span *ngIf="!userimage" class="slds-icon_container slds-icon-standard-empty slds-icon_container--circle"><system-utility-icon [icon]="\'user\'" [size]="\'x-small\'" [addclasses]="\'slds-icon\'" [colorclass]="\'\'"></system-utility-icon></span> <img style="height: 32px; width: 32px" *ngIf="userimage" [src]="userimage"></button><global-user-panel *ngIf="!hideUserDetails"></global-user-panel>',providers:[services_6.popup]}),__metadata("design:paramtypes",[services_1.loginService,router_1.Router,core_1.ElementRef,core_1.Renderer2,services_6.popup,services_2.session])],e)}();exports.GlobalUser=GlobalUser;var GlobaUserPanel=function(){function e(e,s,t,o,i,a,l,n,r,d,c){this.rendered=e,this.loginService=s,this.session=t,this.router=o,this.popup=i,this.language=a,this.metadata=l,this.backend=n,this.config=r,this.modalservice=d,this.cookie=c}return e.prototype.logoff=function(){this.loginService.logout()},e.prototype.changeImage=function(){var o=this;this.modalservice.openModal("SystemUploadImage").subscribe(function(e){e.instance.cropheight=150,e.instance.cropwidth=150,e.instance.imagedata.subscribe(function(s){if(!1!==s){var t=o.session.authData.userimage;o.session.authData.userimage="",o.backend.postRequest("module/Users/"+o.session.authData.userId+"/image",{},{imagedata:s}).subscribe(function(e){o.session.authData.userimage=s},function(e){o.session.authData.userimage=t})}})})},e.prototype.getAvialableLanguages=function(){return this.language.getAvialableLanguages(!0)},Object.defineProperty(e.prototype,"displayName",{get:function(){return this.session.authData.display_name?this.session.authData.display_name:this.session.authData.userName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userName",{get:function(){return this.session.authData.userName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentlanguage",{get:function(){return this.language.currentlanguage},set:function(e){this.popup.close(),this.language.currentlanguage=e,this.language.loadLanguage()},enumerable:!0,configurable:!0}),e.prototype.goDetails=function(){this.popup.close(),this.router.navigate(["/module/Users/"+this.session.authData.userId])},e.prototype.changePassword=function(){this.modalservice.openModal("UserChangePasswordModal")},Object.defineProperty(e.prototype,"userimage",{get:function(){return this.session.authData.userimage},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("imgupload",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"imgupload",void 0),e=__decorate([core_1.Component({selector:"global-user-panel",template:'<div class="userProfilePanel"><div class="slds-grid slds-p-around--small slds-grid--vertical-align-center"><global-user-panel-icon></global-user-panel-icon><div class="slds-m-left--small"><h1 class="slds-text-heading--medium" [title]="userName">{{displayName}}</h1></div></div><div class="slds-theme--shade slds-p-around--small slds-border--top slds-border--bottom"><ul class="slds-list--horizontal slds-has-dividers--left"><li class="slds-item"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="goDetails()">{{language.getLabel(\'LBL_DETAILS\')}}</a></li><li class="slds-item"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="changePassword()">{{language.getLabel(\'LBL_CHANGE_PASSWORD\')}}</a></li></ul></div><div class="slds-p-around--small slds-form--stacked"><div class="slds-form-element"><label class="slds-form-element__label">{{language.getLabel(\'LBL_SELECT_LANGUAGE\')}}</label><div class="slds-form-element__control"><div class="slds-select_container"><select [disabled]="getAvialableLanguages().length <= 1" class="slds-select" [(ngModel)]="currentlanguage"><option *ngFor="let language of getAvialableLanguages()" [value]="language.language">{{language.text}}</option></select></div></div></div></div><div class="slds-theme--shade slds-p-around--x-small slds-grid"><div>{{language.getLabel(\'LBL_LOGGED_ON_SYSTEM\')}}: {{config.data.display}}</div><div class="slds-col--bump-left"><system-utility-icon icon="logout" size="x-small" [title]="language.getLabel(\'LBL_LOGOFF\')" (click)="logoff()"></system-utility-icon></div></div></div>'}),__metadata("design:paramtypes",[core_1.Renderer,services_1.loginService,services_2.session,router_1.Router,services_6.popup,services_4.language,services_12.metadata,services_3.backend,services_5.configurationService,services_19.modal,services_18.cookie])],e)}();exports.GlobaUserPanel=GlobaUserPanel;var GlobaUserPanelIcon=function(){function e(e,s,t){this.session=e,this.modalservice=s,this.backend=t,this.showEdit=!1}return e.prototype.changeImage=function(){var o=this;this.modalservice.openModal("SystemUploadImage").subscribe(function(e){e.instance.cropheight=150,e.instance.cropwidth=150,e.instance.imagedata.subscribe(function(s){if(!1!==s){var t=o.session.authData.userimage;o.session.authData.userimage="",o.backend.postRequest("module/Users/"+o.session.authData.userId+"/image",{},{imagedata:s}).subscribe(function(e){o.session.authData.userimage=s},function(e){o.session.authData.userimage=t})}})})},Object.defineProperty(e.prototype,"editstyle",{get:function(){return{opacity:this.showEdit?1:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userimage",{get:function(){return this.session.authData.userimage},enumerable:!0,configurable:!0}),e.prototype.onMouseEnter=function(){this.showEdit=!0},e.prototype.onMouseLeave=function(){this.showEdit=!1},e=__decorate([core_1.Component({selector:"global-user-panel-icon",template:'<div class="slds-is-relative" (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()"><div><span *ngIf="!userimage" class="slds-icon_container slds-icon-standard-empty slds-icon_container--circle" style="width:40px;height:40px;"><system-icon [sprite]="\'action\'" [icon]="\'user\'" [size]="\'small\'"></system-icon></span> <img style="height: 40px; width: 40px" *ngIf="userimage" [src]="userimage"></div><div [ngStyle]="editstyle" class="slds-is-absolute__top slds-align--absolute-center" style="transition: .5s; height: 40px; width: 40px;" (click)="changeImage()"><div class="slds-is-absolute__top" style="background: white;height: 40px; width: 40px; opacity: .7;"></div><system-utility-icon icon="edit" size="x-small" style="z-index: 1;"></system-utility-icon></div></div>'}),__metadata("design:paramtypes",[services_2.session,services_19.modal,services_3.backend])],e)}();exports.GlobaUserPanelIcon=GlobaUserPanelIcon;var GlobalRecentItems=function(){function e(e,s,t,o){this.language=e,this.router=t,this.recent=o,s.setActiveModule("recent",this.language.getLabel("LBL_RECENTLYVIEWED"))}return e.prototype.goRecent=function(e,s){this.router.navigate(["/module/"+e+"/"+s])},e=__decorate([core_1.Component({selector:"global-recent-items",template:'<div class="slds-page-header"><div class="slds-page-header__row"><div class="slds-page-header__col-title"><div class="slds-media"><div class="slds-media__body"><div class="slds-page-header__name"><div class="slds-page-header__name-title"><h1><span class="slds-page-header__title slds-truncate">{{language.getLabel(\'LBL_RECENT_ITEMS\')}}</span></h1></div></div><p class="slds-page-header__name-meta">{{recent.items.length}} {{language.getLabel(\'LBL_ITEMS\')}}</p></div></div></div></div></div><table class="slds-table slds-table--bordered slds-table--fixed-layout" role="grid"><thead><tr class="slds-text-title--caps"><th class="slds-cell-shrink" scope="col"></th><th class="slds-is-sortable slds-is-resizable" scope="col"><span class="slds-truncate">{{language.getLabel(\'LBL_NAME\')}}</span></th><th class="slds-is-sortable slds-is-resizable" scope="col"><span class="slds-truncate">{{language.getLabel(\'LBL_MODULE\')}}</span></th></tr></thead><tbody><tr *ngFor="let recentItem of recent.items" class="slds-hint-parent"><td role="gridcell" class="slds-cell-shrink"><system-icon [module]="recentItem.module_name" size="small" divClass></system-icon></td><td scope="row"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="goRecent(recentItem.module_name, recentItem.item_id)"><div class="slds-truncate" modelPopOver [module]="recentItem.module_name" [id]="recentItem.item_id">{{recentItem.item_summary}}</div></a></td><td scope="row"><div class="slds-truncate">{{language.getModuleName(recentItem.module_name, true)}}</div></td></tr></tbody></table>'}),__metadata("design:paramtypes",[services_4.language,services_13.navigation,router_1.Router,services_10.recent])],e)}();exports.GlobalRecentItems=GlobalRecentItems;var GlobalSearch=function(){function e(e,s,t,o,i,a){var l=this;this.elementref=s,this.activatedRoute=o,this.fts=i,this.language=a,this.searchScope="*",this.searchTimeOut=void 0,this.searchTerm="",this.routeSubscription=this.activatedRoute.params.subscribe(function(s){if(s.searchterm){try{l.searchTerm=atob(decodeURIComponent(s.searchterm))}catch(e){l.searchTerm=s.searchterm}l.doSearch(),e.setActiveModule("search","search: "+l.searchTerm)}})}return e.prototype.ngOnDestroy=function(){this.routeSubscription.unsubscribe()},e.prototype.search=function(e){var s=this;switch(e.key){case"Enter":this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.fts.searchTerm=this.searchTerm,this.doSearch();break;default:this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout(function(){return s.doSearch()},1e3)}},Object.defineProperty(e.prototype,"totalcount",{get:function(){for(var e=0,s=0,t=this.fts.moduleSearchresults;s<t.length;s++){e+=t[s].data.total}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalmodules",{get:function(){for(var e=0,s=0,t=this.fts.moduleSearchresults;s<t.length;s++){0<t[s].data.total&&e++}return e},enumerable:!0,configurable:!0}),e.prototype.doSearch=function(){"*"===this.searchScope?this.fts.searchByModules(this.searchTerm):this.fts.searchByModules(this.searchTerm,[this.searchScope],50)},e.prototype.getScopeClass=function(e){if(e===this.searchScope)return"slds-is-active"},e.prototype.setSearchScope=function(e){e!==this.searchScope&&(this.searchScope=e,this.doSearch())},e.prototype.infiniteScroll=function(){return"*"!==this.searchScope},e=__decorate([core_1.Component({selector:"global-search",template:'<div class="slds-grid"><div tobottom class="slds-show--large slds-size--1-of-5 slds-grid slds-grid--vertical slds-navigation-list--vertical slds-navigation-list--vertical-inverse"><h2 class="slds-text-title--caps slds-p-around--medium">{{language.getLabel(\'LBL_SEARCHRESULTS\')}}</h2><ul><li [ngClass]="getScopeClass(\'*\')"><a href="javascript:void(0);" class="slds-navigation-list--vertical__action slds-text-link--reset" (click)="setSearchScope(\'*\')">{{language.getLabel(\'LBL_TOPRESULTS\')}}</a></li><li *ngFor="let module of fts.searchModules" [ngClass]="getScopeClass(module)"><a href="javascript:void(0);" class="slds-navigation-list--vertical__action slds-text-link--reset" (click)="setSearchScope(module)">{{language.getModuleName(module)}}</a></li></ul></div><div class="slds-size--1-of-1 slds-large-size--4-of-5 slds-border--left"><div class="slds-p-around--medium slds-theme--shade"><div class="slds-page-header__row"><div class="slds-page-header__col-title"><div class="slds-media"><div class="slds-media__figure"><system-icon icon="search" (click)="setSearchScope(\'*\')"></system-icon></div><div class="slds-media__body"><h1 class="slds-grid slds-grid--vertical-align-center"><div class="slds-form-element slds-size--1-of-1"><div class="slds-form-element__control"><input class="slds-input" type="text" [(ngModel)]="searchTerm" (keyup)="search($event)" spellcheck="false"></div></div></h1></div></div></div></div></div><div *ngIf="searchScope == \'*\'" tobottom><table *ngIf="fts.runningmodulesearch" class="slds-table slds-table--bordered slds-table--fixed-layout" role="grid"><tbody system-table-stencils [columns]="7" [select]="false" [tools]="false" [rows]="15"></tbody></table><global-search-module class="slds-m-bottom--medium" *ngFor="let result of fts.moduleSearchresults" [module]="result.module" (scope)="setSearchScope($event)"></global-search-module><div *ngIf="!fts.runningmodulesearch && totalcount == 0" class="slds-align--absolute-center slds-height_full"><system-illustration-no-records>{{language.getLabel(\'MSG_NO_RECORDS_FOUND\')}}</system-illustration-no-records></div></div><div *ngIf="searchScope != \'*\'"><global-search-module-only [module]="searchScope"></global-search-module-only></div></div></div>',providers:[services_8.fts]}),__metadata("design:paramtypes",[services_13.navigation,core_1.ElementRef,router_1.Router,router_1.ActivatedRoute,services_8.fts,services_4.language])],e)}();exports.GlobalSearch=GlobalSearch;var GlobalSearchModule=function(){function e(e,s,t,o,i,a){this.metadata=e,this.elementref=s,this.fts=o,this.language=i,this.layout=a,this.module="",this.scope=new core_1.EventEmitter,this.listfields=[]}return Object.defineProperty(e.prototype,"issmall",{get:function(){return"small"==this.layout.screenwidth},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.listfields=[];var e=this.metadata.getComponentConfig("GlobalSearchModule",this.module);_.isEmpty(e)&&(e=this.metadata.getModuleDefaultComponentConfigByUsage(this.module,"list"));for(var s=0,t=this.metadata.getFieldSetFields(e.fieldset);s<t.length;s++){var o=t[s];!1!==o.fieldconfig.default&&this.listfields.push(o)}},e.prototype.getCount=function(){var s=this,t={};return this.fts.moduleSearchresults.some(function(e){if(e.module===s.module)return t={total:e.data.total,hits:e.data.hits.length},!0}),t},Object.defineProperty(e.prototype,"hidepanel",{get:function(){return!(!this.fts.runningmodulesearch&&0<this.getCount().total)},enumerable:!0,configurable:!0}),e.prototype.canViewMore=function(){return 5<this.getCount().total},e.prototype.getItems=function(){var s=this,t=[];return this.fts.moduleSearchresults.some(function(e){if(e.module===s.module)return t=e.data.hits,!0}),t},e.prototype.setSearchScope=function(){this.scope.emit(this.module)},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"scope",void 0),e=__decorate([core_1.Component({selector:"global-search-module",template:'<div [ngClass]="{\'slds-hide\': hidepanel}"><div class="slds-grid slds-grid--vertical-align-center"><div class="slds-p-left--small slds-show--medium"><system-icon [module]="module" divClass></system-icon></div><div class="slds-p-around--small slds-theme--default slds-border--top slds-grow"><div class="slds-grid"><div class="slds-col slds-has-flexi-truncate"><h1 class="slds-page-header__title slds-truncate">{{language.getModuleName(module)}}</h1></div></div><div class="slds-grid"><div class="slds-col slds-align-bottom"><ul class="slds-list--horizontal slds-has-dividers--left"><li class="slds-item">{{getCount().hits}} {{language.getLabel(\'LBL_OF\')}} {{getCount().total}} {{language.getLabel(\'LBL_ITEMS\')}}</li><li *ngIf="canViewMore()" class="slds-item slds-text-link--reset" (click)="setSearchScope()">{{language.getLabel(\'LBL_VIEWALL\')}}</li></ul></div></div></div></div><div><table class="slds-table slds-table--fixed-layout slds-max-medium-table--stacked-horizontal" [ngClass]="{\'slds-table--bordered\':!issmall}" role="grid"><thead class="slds-show--medium"><tr class="slds-text-title--caps"><th *ngFor="let item of listfields" scope="col"><div class="slds-truncate slds-p-around--x-small">{{language.getFieldDisplayName(module, item.field)}}</div></th></tr></thead><tbody><tr global-search-module-item *ngFor="let item of getItems()" [module]="module" [listfields]="listfields" [listitem]="item"></tr></tbody></table><system-spinner *ngIf="fts.runningmodulesearch"></system-spinner></div></div>'}),__metadata("design:paramtypes",[services_12.metadata,core_1.ElementRef,router_1.Router,services_8.fts,services_4.language,services_20.layout])],e)}();exports.GlobalSearchModule=GlobalSearchModule;var GlobalSearchModuleOnly=function(){function e(e,s,t,o,i,a,l){this.broadcast=e,this.metadata=s,this.elementref=t,this.fts=i,this.language=a,this.layout=l,this.module="",this.listfields=[]}return Object.defineProperty(e.prototype,"issmall",{get:function(){return"small"==this.layout.screenwidth},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(){this.listfields=[];var e=this.metadata.getComponentConfig("GlobalSearchModule",this.module);_.isEmpty(e)&&(e=this.metadata.getModuleDefaultComponentConfigByUsage(this.module,"list"));for(var s=0,t=this.metadata.getFieldSetFields(e.fieldset);s<t.length;s++){var o=t[s];!1!==o.fieldconfig.default&&this.listfields.push(o)}},e.prototype.getCount=function(){var s=this,t={};return this.fts.moduleSearchresults.some(function(e){if(e.module===s.module)return t={total:e.data.total,hits:e.data.hits.length},!0}),t},e.prototype.getItems=function(){var s=this,t=[];return this.fts.moduleSearchresults.some(function(e){if(e.module===s.module)return t=e.data.hits,!0}),t},e.prototype.onScroll=function(e){var s=this.tablecontent.element.nativeElement;s.scrollTop+s.clientHeight+50>s.scrollHeight&&this.fts.loadMore()},__decorate([core_1.ViewChild("tablecontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"tablecontent",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),e=__decorate([core_1.Component({selector:"global-search-module-only",template:'<div class="slds-theme--default slds-border--top slds-grid slds-grid--vertical-align-center"><div class="slds-p-left--small slds-show--medium"><system-icon [module]="module" divClass></system-icon></div><div class="slds-p-around--small"><div class="slds-grid"><div class="slds-col slds-has-flexi-truncate"><h1 class="slds-page-header__title slds-truncate">{{language.getModuleName(module)}}</h1></div></div><div class="slds-grid"><div class="slds-col slds-align-bottom"><ul class="slds-list--horizontal slds-has-dividers--left"><li class="slds-item">{{getCount().hits}} {{language.getLabel(\'LBL_OF\')}} {{getCount().total}} {{language.getLabel(\'LBL_ITEMS\')}}</li></ul></div></div></div></div><div><table class="slds-show--medium slds-table slds-table--bordered slds-table--fixed-layout" role="grid"><thead><tr class="slds-text-title--caps"><th *ngFor="let item of listfields" scope="col"><div class="slds-truncate slds-p-around--x-small">{{language.getFieldDisplayName(module, item.field)}}</div></th></tr></thead></table><div tobottom (scroll)="onScroll($event)"><table #tablecontent class="slds-table slds-table--fixed-layout slds-max-medium-table--stacked-horizontal" [ngClass]="{\'slds-table--bordered\':!issmall}" role="grid"><tbody><tr global-search-module-item *ngFor="let item of getItems()" [module]="module" [listfields]="listfields" [listitem]="item"></tr></tbody><tbody system-table-stencils [columns]="listfields?.length" [select]="false" [tools]="false" [rows]="5" *ngIf="fts.runningmodulesearch"></tbody></table><div *ngIf="!fts.runningmodulesearch && getCount().total == 0" class="slds-align--absolute-center slds-height_full"><system-illustration-no-records>{{language.getLabel(\'MSG_NO_RECORDS_FOUND\')}}</system-illustration-no-records></div></div></div>'}),__metadata("design:paramtypes",[services_7.broadcast,services_12.metadata,core_1.ElementRef,router_1.Router,services_8.fts,services_4.language,services_20.layout])],e)}();exports.GlobalSearchModuleOnly=GlobalSearchModuleOnly;var GlobalSearchModuleItem=function(){function e(e,s,t,o,i,a){this.elementref=e,this.router=s,this.view=t,this.model=o,this.language=i,this.layout=a,this.module="",this.listfields="",this.listitem={},this.expanded=!1,this.view.isEditable=!1}return e.prototype.ngOnInit=function(){this.model.module=this.listitem._type,this.model.id=this.listitem._id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.listitem._source),this.model.data.acl=this.listitem.acl,this.model.data.acl_fieldcontrol=this.listitem.acl_fieldcontrol,this.model.data.acl=this.listitem.acl},e.prototype.navigateDetail=function(e){e.stopPropagation(),this.model.data.acl.detail&&this.model.goDetail()},e.prototype.toggleexpanded=function(){this.expanded=!this.expanded},Object.defineProperty(e.prototype,"isexpanded",{get:function(){return"small"!=this.layout.screenwidth||this.expanded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandicon",{get:function(){return this.expanded?"chevronup":"chevrondown"},enumerable:!0,configurable:!0}),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"listfields",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"listitem",void 0),e=__decorate([core_1.Component({selector:"[global-search-module-item]",template:'<td class="slds-hide--medium"><div class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small"><system-icon [module]="model.module" size="xx-small" divClass="slds-p-right--xx-small"></system-icon><div class="slds-text-align--left slds-truncate slds-grow" (click)="navigateDetail($event)">{{model.data.summary_text}}</div><system-utility-icon [icon]="expandicon" size="xx-small" (click)="toggleexpanded()"></system-utility-icon></div></td><ng-container *ngIf="isexpanded"><td *ngFor="let item of listfields" scope="row" (click)="navigateDetail($event)" [attr.data-label]="language.getFieldDisplayName(module, item.field)"><field-container [field]="item.field" [fieldconfig]="item.fieldconfig" [fielddisplayclass]="\'slds-truncate\'"></field-container></td></ng-container>',providers:[services_15.view,services_9.model]}),__metadata("design:paramtypes",[core_1.ElementRef,router_1.Router,services_15.view,services_9.model,services_4.language,services_20.layout])],e)}();exports.GlobalSearchModuleItem=GlobalSearchModuleItem;var GlobalNewsFeed=function(){function e(e){var s=this;this.http=e,this.news=[],this.isLoading=!0;var t=btoa("https://www.spicecrm.io/wp-json/wp/v2/posts");this.http.get("proxy?useurl="+t).subscribe(function(e){s.news=e,s.isLoading=!1})}return e.prototype.getContainerClass=function(){return this.isLoading?"slds-align--absolute-center":""},e=__decorate([core_1.Component({selector:"global-newsfeed",template:'<div style="height: 100%;" class="slds-p-around--medium" [ngClass]="getContainerClass()"><system-spinner *ngIf="isLoading"></system-spinner><global-newsfeed-item *ngFor="let newsitem of news" [item]="newsitem"></global-newsfeed-item></div>'}),__metadata("design:paramtypes",[http_1.HttpClient])],e)}();exports.GlobalNewsFeed=GlobalNewsFeed;var GlobalNewsFeedItem=function(){function e(){this.item={}}return e.prototype.getDate=function(){return moment(this.item.date).fromNow()},e.prototype.getExcerpt=function(){return this.item.excerpt.rendered.replace("<a",'<a target="_blank"')},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),e=__decorate([core_1.Component({selector:"global-newsfeed-item",template:'<article class="slds-card slds-m-bottom--medium"><div class="slds-card__header"><div class="slds-grid slds-grid_vertical-align-center"><system-custom-icon icon="wordpress" size="small"></system-custom-icon><h2 class="slds-text-heading--medium slds-truncate"><a target="_blank" [attr.href]="item.link" [innerHTML]="item.title.rendered"></a></h2></div></div><div class="slds-card__body slds-p-vertical--xx-small slds-p-horizontal--small"><div class="slds-card__body--inner slds-grid slds-wrap slds-grid--pull-padded" style="text-align: justify" [innerHTML]="getExcerpt()"></div></div><div class="slds-card__footer">{{getDate()}}</div></article>'})],e)}();exports.GlobalNewsFeedItem=GlobalNewsFeedItem;var services_21=require("../services/services"),GlobalLoginGoogle=function(){function e(e,s,t,o,i){var a=this;this.backend=e,this.configuration=s,this.http=t,this.loginService=o,this.session=i,this.clientId="",this.visible=!1,this.scope=["profile","email","https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/contacts.readonly","https://www.googleapis.com/auth/admin.directory.user.readonly","https://www.googleapis.com/auth/calendar","https://www.googleapis.com/auth/tasks"].join(" "),this.configuration.loaded$.subscribe(function(e){a.googleInit()})}return e.prototype.googleInit=function(){var s=this;this.configuration.data.backendextensions.hasOwnProperty("google_oauth")&&null!=this.configuration.data.backendextensions.google_oauth.config&&gapi.load("auth2",function(){var e=JSON.parse(s.configuration.data.backendextensions.google_oauth.config.calendarconfig);s.clientId=e.web.client_id,s.auth2=gapi.auth2.init({client_id:s.clientId,cookiepolicy:"single_host_origin",scope:s.scope}),s.visible=!0})},e.prototype.signInClick=function(){var o=this;Promise.resolve(this.auth2.signIn()).then(function(e){var s=e.getAuthResponse().id_token,t=e.getAuthResponse().access_token;o.loginService.oauthToken=s,o.loginService.accessToken=t,o.loginService.authData.userName="",o.loginService.authData.password="",o.loginService.login().subscribe(function(e){o.synchronize()},function(e){console.log(e)})}).catch(function(e){console.log(JSON.stringify(e,void 0,2))})},e.prototype.synchronize=function(){this.backend.getRequest("/google/calendar/sync").subscribe(function(e){console.log("Successfully Synchronized")},function(e){console.log("Synchronization Error")})},e=__decorate([core_1.Component({selector:"global-login-google",template:'<button class="slds-button slds-button_neutral slds-m-vertical--x-small" (click)="signInClick()" style="width:100%" *ngIf="visible"><div class="slds-align--absolute-center slds-grid slds-grid--vertical-align-center"><img style="height: 18px;width:18px;margin-right: 24px;" src="https://developers.google.com/identity/images/g-logo.png"><div>Sign in with Google</div></div></button>'}),__metadata("design:paramtypes",[services_3.backend,services_5.configurationService,http_1.HttpClient,services_1.loginService,services_2.session])],e)}();exports.GlobalLoginGoogle=GlobalLoginGoogle;var GlobalComponents=function(){function GlobalComponents(e,s){this.metadata=e,this.vms=s,this.version="1.0",this.build_date="2019-02-23",this.vms.registerModule(this)}return GlobalComponents=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,directives_1.DirectivesModule,systemcomponents_1.SystemComponents,router_1.RouterModule.forRoot([{path:"login",component:GlobalLogin},{path:"setup",component:GlobalSetup},{path:"recent",component:GlobalRecentItems,canActivate:[services_1.loginCheck]},{path:"search",component:GlobalSearch,canActivate:[services_1.loginCheck]},{path:"search/:searchterm",component:GlobalSearch,canActivate:[services_1.loginCheck]}])],declarations:[GlobalNewsFeed,GlobalNewsFeedItem,GlobalHeader,GlobalHeaderTop,GlobalHeaderSearch,GlobalHeaderSearchResultsItems,GlobalHeaderSearchResultsItem,GlobalHeaderSearchRecentItems,GlobalHeaderSearchRecentItem,GlobalHeaderTools,GlobalHeaderActions,GlobalHeaderActionItem,GlobalHeaderFavorite,GlobalHeaderWorkbench,GlobalFooter,GlobalNavigation,GlobalNavigationMenu,GlobalNavigationMenuItem,GlobalNavigationMenuItemNew,GlobalNavigationMenuItemRoute,GlobalNavigationMenuItemIcon,GlobalNavigationMenuMore,GlobalNavigationCompact,GlobalLogin,GlobalSetup,GlobalLoginForgotPassword,GlobalLoginResetPassword,GlobalUser,GlobaUserPanel,GlobaUserPanelIcon,GlobalAppLauncher,GlobalAppLauncherDialog,GlobalAppLauncherDialogRoleTile,GlobalDockedComposerContainer,GlobalDockedComposer,GlobalDockedComposerCall,GlobalDockedComposerModal,GlobalDockedComposerOverflow,GlobalComposeButton,GlobalRecentItems,GlobalSearch,GlobalSearchModule,GlobalSearchModuleOnly,GlobalSearchModuleItem,GlobalLoginGoogle],entryComponents:[GlobalHeader,GlobalNavigationMenuItem,GlobalNavigationMenuItemNew,GlobalNavigationMenuMore,GlobalHeaderTop,GlobalHeaderSearch,GlobalHeaderSearchResultsItems,GlobalHeaderSearchResultsItem,GlobalHeaderSearchRecentItems,GlobalHeaderSearchRecentItem,GlobalDockedComposerContainer,GlobalDockedComposer,GlobalDockedComposerContainer],exports:[GlobalNewsFeed,GlobalHeader,GlobalFooter,GlobalDockedComposerContainer,GlobalDockedComposer,GlobalDockedComposerOverflow,GlobalComposeButton]}),__metadata("design:paramtypes",[services_12.metadata,services_21.VersionManagerService])],GlobalComponents)}();exports.GlobalComponents=GlobalComponents;