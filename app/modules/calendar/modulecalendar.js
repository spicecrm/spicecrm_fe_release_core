/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2020. All Rights reserved)*/
"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,s,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,n);else for(var o=e.length-1;0<=o;o--)(r=e[o])&&(i=(a<3?r(i):3<a?r(t,s,i):r(t,s))||i);return 3<a&&i&&Object.defineProperty(t,s,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<s;t++)for(var a=arguments[t],i=0,o=a.length;i<o;i++,r++)n[r]=a[i];return n};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),drag_drop_1=require("@angular/cdk/drag-drop"),services_1=require("../../services/services"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),directives_1=require("../../directives/directives"),rxjs_1=require("rxjs"),operators_1=require("rxjs/operators"),calendar=function(){function e(e,t,s,n,r,a,i,o){this.backend=e,this.session=t,this.broadcast=s,this.modal=n,this.language=r,this.modelutilities=a,this.cdr=i,this.userPreferences=o,this.usersCalendarsLoad$=new core_1.EventEmitter,this.userCalendarChange$=new core_1.EventEmitter,this.addingEvent$=new core_1.EventEmitter,this.pickerDate$=new core_1.EventEmitter,this.otherCalendarsColor$=new core_1.EventEmitter,this.modules=[],this.usersCalendars=[],this.otherCalendars=[],this.calendardate=moment(),this.calendars={},this.currentStart={},this.currentEnd={},this.sidebarwidth=360,this.sheetTimeWidth=50,this.sheetHourHeight=80,this.weekstartday=0,this.weekDaysCount=7,this.startHour=0,this.endHour=23,this.todayColor="#eb7092",this.absenceColor="#727272",this.eventColor="#039be5",this.googleColor="#db4437",this.loggedByGoogle=!1,this.asPicker=!1,this.isMobileView=!1,this.isDashlet=!1,this.isLoading=!1,this.usersCalendarsLoaded=!1,this.sheettype="Week",this.duration={Day:"d",Three_Days:"d",Week:"w",Month:"M",Schedule:"M"},this.colorPalette=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"],this.subscriptions=new rxjs_1.Subscription,this.loadCalendarModules(),this.loadPreferences(),this.subscribeToLanguage(),this.getCalendarPreferences(),this.broadcastSubscriber()}return Object.defineProperty(e.prototype,"sheetType",{get:function(){return this.sheettype},set:function(e){this.sheettype=e,this.session.setSessionData("sheetType",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calendarDate",{get:function(){return this.calendardate},set:function(e){this.calendardate=new moment(e).locale(this.language.currentlanguage.substring(0,2)),this.session.setSessionData("calendarDate",this.calendardate)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sidebarWidth",{get:function(){return this.isMobileView||this.isDashlet?0:this.sidebarwidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiEventHeight",{get:function(){return this.isMobileView?20:25},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.session.authData.userId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerName",{get:function(){return this.session.authData.userName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekStartDay",{get:function(){return this.weekstartday},set:function(e){this.weekstartday=e},enumerable:!0,configurable:!0}),e.prototype.refresh=function(e){this.currentStart={},this.currentEnd={},this.triggerSheetReload(e)},e.prototype.shiftPlus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this.calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this.calendarDate=new moment(this.calendarDate.add(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.add(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.shiftMinus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this.calendarDate.day()==this.weekStartDay&&(this.calendarDate=new moment(this.calendarDate.subtract(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.subtract(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.doReload=function(e,t,s){var n=!this.calendars[s]||this.calendars[s]&&0==this.calendars[s].length,r=!(this.currentStart[s]&&this.currentEnd[s]&&this.currentStart[s].isSame(e)&&this.currentEnd[s].isSame(t));return n||r},e.prototype.loadUserEvents=function(e,t,s){var n=this;return this.loadEvents(e,t,this.owner,[s],!0).pipe(operators_1.map(function(e){return e.map(function(e){return e.otherColor=n.usersCalendars.find(function(e){return e.id==s}).color,e})}))},e.prototype.loadUsersEvents=function(e,t){var s=this.usersCalendars.filter(function(e){return!!e.visible}),n=s.map(function(e){return e.id}),r=_.object(n,s);return this.loadEvents(e,t,this.owner,n).pipe(operators_1.map(function(e){return e.map(function(e){return e.otherColor=r[e.data.assigned_user_id].color,e})}))},e.prototype.loadEvents=function(r,e,t,s,n){var a=this;void 0===t&&(t=this.owner),void 0===s&&(s=[]);var i=0<s.length?"users":t;if(n||this.doReload(r,e,i)){this.isLoading=!0,this.cdr.detectChanges();var o=new rxjs_1.Subject,l="YYYY-MM-DD HH:mm:ss",d={start:r.tz("utc").format(l),end:e.tz("utc").format(l),users:s},c=0<s.length?"calendar/users/":"calendar/";return this.currentEnd[i]=e,this.currentStart[i]=r,this.backend.getRequest(c+t,d).subscribe(function(e){a.calendars[i]=[],a.isLoading=!1;for(var t=function(t){if(a.otherCalendars.some(function(e){return e.name==t.module&&!e.visible}))return"continue";switch(t.type){case"event":t.start=moment.utc(t.start).tz(a.timeZone),t.end=moment.utc(t.end).tz(a.timeZone),t.isMulti=0<+t.end.diff(t.start,"days"),t.color=a.eventColor;break;case"absence":t.start=moment(t.start).second(1),t.end=moment(t.end).second(1),t.isMulti=!0,t.color=a.absenceColor;break;case"other":t.start=moment(t.start).year(r.year()).second(1),t.end=moment(t.end).year(r.year()).second(1),t.isMulti=!0}if("UserAbsences"==t.module&&("other"==t.type&&(t.data.summary_text=t.data.user_name,t.id=t.id+"-other",t.data.id=t.data.id+"-other"),a.absenceExists(t)))return"continue";a.calendars[i].push(t)},s=0,n=e;s<n.length;s++){t(n[s])}o.next(a.calendars[i]),o.complete()}),o.asObservable()}for(var h=[],u=function(t){if(p.otherCalendars.some(function(e){return e.name==t.module&&!e.visible}))return"continue";t.start<e&&t.end>r&&(t.start=moment(t.start).tz(p.timeZone),t.end=moment(t.end).tz(p.timeZone),h.push(t))},p=this,g=0,v=this.calendars[i];g<v.length;g++){u(v[g])}return rxjs_1.of(h)},e.prototype.loadGoogleEvents=function(e,t){var r=this;if(!this.loggedByGoogle)return rxjs_1.of([]);if(this.doReload(e,t,"google")){this.isLoading=!0,this.cdr.detectChanges();var a=new rxjs_1.Subject,s="YYYY-MM-DD HH:mm:ss",n={startdate:e.format(s),enddate:t.format(s)};return this.calendars.google=[],this.currentEnd.google=t,this.currentStart.google=e,this.backend.getRequest("google/calendar/getgoogleevents",n).subscribe(function(e){if(e.events&&0<e.events.length){r.isLoading=!1;for(var t=0,s=e.events;t<s.length;t++){var n=s[t];n.start=moment(n.start.dateTime).format("YYYY-MM-DD HH:mm:ss"),n.end=moment(n.end.dateTime).format("YYYY-MM-DD HH:mm:ss"),n.start=moment(n.start),n.end=moment(n.end),n.isMulti=0<+n.end.diff(n.start,"days"),n.data={},n.data.summary_text=n.summary,n.data.assigned_user_id=null,n.color=r.googleColor,r.calendars.google.push(n)}}a.next(r.calendars.google),a.complete()}),a.asObservable()}for(var i=[],o=0,l=this.calendars.google;o<l.length;o++){var d=l[o];d.start<t&&d.end>e&&i.push(d)}return rxjs_1.of(i)},e.prototype.getEvents=function(e){return void 0===e&&(e=this.owner),this.calendars[e]?this.calendars[e]:[]},e.prototype.setOtherCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.otherCalendars=e,t&&(this.userPreferences.setPreference("Other",this.otherCalendars,!0,"Calendar"),this.triggerSheetReload()))},e.prototype.addUserCalendar=function(e,t){if(!this.isMobileView&&!this.isDashlet){var s=this.usersCalendars,n={id:e,name:t,visible:!0,color:"#"+this.colorPalette[Math.floor(this.colorPalette.length*Math.random())]};s.push(n),this.userCalendarChange$.emit(n),this.setUserCalendars(s.slice())}},e.prototype.removeUserCalendar=function(t){if(!this.isMobileView&&!this.isDashlet){var e=this.usersCalendars.find(function(e){return e.id==t});e.visible=!1,this.userCalendarChange$.emit(e);var s=this.usersCalendars.filter(function(e){return e.id!=t});this.setUserCalendars(s)}},e.prototype.toggleUserCalendarVisibility=function(t){var s=this;this.usersCalendars.some(function(e){if(e.id==t)return e.visible=!e.visible,s.userCalendarChange$.emit(e),s.setUserCalendars(s.usersCalendars.slice()),!0})},e.prototype.setUserCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.usersCalendars=e,t&&this.userPreferences.setPreference("Users",this.usersCalendars,!0,"Calendar"))},e.prototype.setUserColor=function(t,s){var n=this;this.usersCalendars.some(function(e){if(e.id==t)return e.color=s,n.setUserCalendars(n.usersCalendars),n.otherCalendarsColor$.emit({id:t,color:s}),!0})},e.prototype.arrangeEvents=function(e){(e=e.map(function(e){return e.start=moment(e.start).second(0),e.end=moment(e.end).second(0),e})).sort(function(e,t){return e.start<t.start?-1:e.start===t.start&&e.end>t.end?-1:1});for(var t={},s=0,n=e;s<n.length;s++){for(var r=n[s],a=[],i=0,o=e;i<o.length;i++){var l=o[i];r.id!==l.id&&l.start<r.end&&l.end>r.start&&a.push({id:l.id,start:l.start,end:l.end})}var d=0;if(0<a.length){for(var c=0,h=a;c<h.length;c++){for(var u=h[c],p=0,g=0,v=a;g<v.length;g++){var m=v[g];m.start<u.end&&m.end>u.start&&p++}d<p&&(d=p)}d++}t[r.id]={maxOverlay:d,elementsOverlaid:a}}for(var y=[],f=0,b=e;f<b.length;f++){r=b[f];for(var _=0,C=[],D=0,E=e;D<E.length;D++){l=E[D];if(-1!==y.indexOf(l.id)&&l.start<r.end&&l.end>r.start)for(-1===C.indexOf(t[l.id].displayIndex)&&C.push(t[l.id].displayIndex);-1!==C.indexOf(_);)_++}t[r.id].displayIndex=_,y.push(r.id)}for(var w in t)for(var x=0,M=t[w].elementsOverlaid;x<M.length;x++){var k=M[x];t[w].maxOverlay<t[k.id].maxOverlay&&(t[w].maxOverlay=t[k.id].maxOverlay)}for(var S=0,O=e;S<O.length;S++){(r=O[S]).displayIndex=t[r.id].displayIndex,r.maxOverlay=t[r.id].maxOverlay}return e},e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},e.prototype.onEventDrop=function(n,e){e.some(function(e){var t=e.elementRef.nativeElement.getBoundingClientRect(),s=n.source.element.nativeElement.getBoundingClientRect();if(s.top>=t.top&&s.top<=t.bottom&&s.left>=t.left&&s.left<=t.right)return n.source.data.onDrop({day:e.day,hour:e.hour,minutes:e.minutes}),!0}),n.source.reset()},e.prototype.isValid=function(e){return e&&"object"==typeof e&&e.isValid()},e.prototype.loadCalendarModules=function(){var t=this;this.backend.getRequest("calendar/modules").subscribe(function(e){e&&(t.modules=e)})},e.prototype.absenceExists=function(t){var e=!1;for(var s in this.calendars)if(this.calendars.hasOwnProperty(s)&&this.calendars[s].some(function(e){return e.id==t.id&&e.type==t.type})){e=!0;break}return!!e},e.prototype.broadcastSubscriber=function(){var i=this,e=this.broadcast.message$.subscribe(function(e){var t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if("timezone.changed"==e.messagetype&&(i.timeZone=e.messagedata,i.triggerSheetReload()),i.modules.some(function(e){return e.name==s}))switch(e.messagetype){case"model.save":var r=n.assigned_user_id,a=i.calendars.users&&i.calendars.users.some(function(e){return e.id==r});if(!i.calendars[r]&&!a)return;a&&(r="users"),i.modifyEvent(t,s,n,r)||i.isValid(n.date_end)&&i.isValid(n.date_start)&&(i.calendars[r].push({id:t,module:s,type:"event",start:n.date_start,end:n.date_end,isMulti:0<+n.date_end.diff(n.date_start,"days"),data:n}),i.triggerSheetReload());break;case"model.delete":if(!i.calendars[i.owner])return;i.deleteEvent(t,s)}});this.subscriptions.add(e)},e.prototype.modifyEvent=function(t,e,s,n){if(!this.isValid(s.date_start)||!this.isValid(s.date_end))return!0;if(s.date_start>this.currentEnd&&s.date_end<this.currentStart)return this.deleteEvent(t,e),!0;var r=this.calendars[n].find(function(e){return e.id==t});return!!r&&(r.start=s.date_start,r.end=s.date_end,r.isMulti=0<+s.date_end.diff(s.date_start,"days"),!0)},e.prototype.deleteEvent=function(e,s){var n=this;this.calendars[this.owner].some(function(t){if(t.id==e&&s==t.module)return n.calendars[n.owner]=n.calendars[n.owner].filter(function(e){return e.id!=t.id}),n.triggerSheetReload(),!0})},e.prototype.loadPreferences=function(){this.timeZone=this.session.getSessionData("timezone")||moment.tz.guess();var e=this.userPreferences.toUse;this.weekStartDay="Monday"==e.week_day_start?1:this.weekStartDay,this.weekDaysCount=+e.week_days_count||this.weekDaysCount,this.startHour=+e.calendar_day_start_hour||this.startHour,this.endHour=+e.calendar_day_end_hour||this.endHour;var t=this.session.getSessionData("calendarDate",!1),s=this.session.getSessionData("sheetType",!1);s&&(this.sheettype=s),t&&(this.calendardate=new moment(t)),this.triggerSheetReload()},e.prototype.getCalendarPreferences=function(){var t=this;this.isMobileView||this.isDashlet||(this.userPreferences.loadPreferences("Calendar").pipe(operators_1.take(1)).subscribe(function(e){t.setUserCalendars(e.Users,!1),t.setOtherCalendars(e.Other,!1),e.Users&&0<e.Users.length&&(t.usersCalendarsLoaded=!0,t.usersCalendarsLoad$.emit())}),this.session.authData.googleToken&&(this.loggedByGoogle=!0))},e.prototype.subscribeToLanguage=function(){var e=this,t=this.language.currentlanguage$.subscribe(function(){return e.triggerSheetReload()});this.subscriptions.add(t)},e.prototype.triggerSheetReload=function(e){this.calendarDate=moment(e||this.calendardate)},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.session,services_1.broadcast,services_1.modal,services_1.language,services_1.modelutilities,core_1.ChangeDetectorRef,services_1.userpreferences])],e)}();exports.calendar=calendar;var CalendarHeader=function(){function e(e,t,s,n,r,a){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modelUtils=r,this.calendar=a,this.openPicker=!1,this.scheduleUntilDate={},this.showTypeSelector=!1,this.datePicked=new core_1.EventEmitter,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}return Object.defineProperty(e.prototype,"modules",{get:function(){return this.calendar.modules},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetType",{get:function(){return this.calendar.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMobileView",{get:function(){return this.calendar.isMobileView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekStartDay",{get:function(){return this.calendar.weekStartDay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekDaysCount",{get:function(){return this.calendar.weekDaysCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asPicker",{get:function(){return this.calendar.asPicker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickerClass",{get:function(){return this.openPicker&&this.isMobileView?"":"slds-hidden"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleClass",{get:function(){return this.isMobileView?"slds-m-bottom--xx-small":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headerClass",{get:function(){return this.isMobileView?"slds-p-around--x-small":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeDropdownClass",{get:function(){return this.showTypeSelector?"slds-is-open":""},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this.clickListener&&this.clickListener()},e.prototype.toggleClosed=function(){this.openPicker=!1,this.clickListener&&this.clickListener()},e.prototype.handleDatePicked=function(e){this.datePicked.emit(e)},e.prototype.shiftPlus=function(){this.calendar.shiftPlus()},e.prototype.shiftMinus=function(){this.calendar.shiftMinus()},e.prototype.getCalendarHeader=function(){var e=new moment(this.calendarDate);switch(this.calendar.sheetType){case"Week":return this.getFirstDayOfWeek()+" - "+this.getLastDayOfWeek();case"Month":return e.format("MMMM YYYY");case"Day":return e.format("MMMM D");case"Schedule":return e.format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY");case"Three_Days":return e.format("MMM D")+" - "+moment(e.add(2,"d")).format("MMM D")}},e.prototype.getCompactCalendarHeader=function(){return new moment(this.calendarDate).format("MMM, YYYY")},e.prototype.getWeekNumberDisplay=function(){var e=new moment(this.calendarDate);return this.language.getLabel("LBL_WEEK")+" "+e.format("w")},e.prototype.getFirstDayOfWeek=function(){var e=new moment(this.calendarDate);return e.day(this.weekStartDay),e.format("MMM D")},e.prototype.getLastDayOfWeek=function(){var e=new moment(this.calendarDate);return e.day(this.weekDaysCount),e.format("MMM D")},e.prototype.toggleTypeSelector=function(){this.showTypeSelector=!this.showTypeSelector},e.prototype.setType=function(e){this.calendar.sheetType=e,this.calendar.refresh(),this.showTypeSelector=!1},e.prototype.goToday=function(){this.calendar.calendarDate=new moment},e.prototype.zoomin=function(){this.calendar.sheetHourHeight+=10},e.prototype.zoomout=function(){this.calendar.sheetHourHeight-=10},e.prototype.resetzoom=function(){this.calendar.sheetHourHeight=80},e.prototype.toggleOpen=function(t,s){var n=this;this.openPicker=!this.openPicker,this.openPicker&&(this.clickListener=this.renderer.listen("document","click",function(e){return n.onDocumentClick(e,t,s)}))},e.prototype.onDocumentClick=function(e,t,s){!this.openPicker||t.contains(e.target)||s.contains(e.target)||(this.openPicker=!1,this.clickListener())},e.prototype.toggleVisibleModules=function(t){var s=this;this.calendar.otherCalendars.some(function(e){if(e.name==t)return e.visible=!e.visible,s.calendar.setOtherCalendars(s.calendar.otherCalendars.slice()),!0})||(this.calendar.otherCalendars.push({id:this.modelUtils.generateGuid(),name:t,visible:!1}),this.calendar.setOtherCalendars(this.calendar.otherCalendars.slice()))},e.prototype.getIconStyle=function(t){return this.calendar.otherCalendars.some(function(e){return t==e.name&&!e.visible})?{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"}:{}},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"datePicked",void 0),e=__decorate([core_1.Component({selector:"calendar-header",template:'<div class="slds-page-header" style="border-bottom-left-radius: 0; border-bottom-right-radius: 0;" [ngClass]="headerClass"><div class="slds-grid"><div *ngIf="!isMobileView" class="slds-col" [ngClass]="titleClass"><div class="slds-media slds-no-space slds-grow"><system-icon [module]="\'Calendar\'"></system-icon><div class="slds-media__body"><p class="slds-text-title--caps slds-line-height--reset">{{language.getModuleName(\'Calendar\')}}</p><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate">{{getCalendarHeader()}} <span *ngIf="calendar.sheetType == \'Week\'" class="slds-p-horizontal--x-small slds-p-vertical--xx-small slds-pill slds-text-body--small">{{getWeekNumberDisplay()}}</span></h1></div></div></div><div *ngIf="isMobileView" class="slds-col slds-grid"><button #pickerbuttoncontainer class="slds-button slds-button--icon-border" (click)="toggleOpen(pickerontainer, pickerbuttoncontainer)"><system-utility-icon icon="event" size="x-small"></system-utility-icon></button><div class="slds-page-header__title slds-m-horizontal--x-small slds-align-middle slds-truncate">{{getCompactCalendarHeader()}}</div></div><div class="slds-align-top slds-col slds-grid slds-no-flex slds-col--bump-left"><div class="slds-m-right--medium slds-grid"><system-icon *ngFor="let module of modules" [module]="module.name" [ngStyle]="getIconStyle(module.name)" (click)="toggleVisibleModules(module.name)" size="medium" divClass="slds-m-right--xx-small" style="cursor: pointer"></system-icon></div><div *ngIf="!isMobileView || asPicker" class="slds-button-group" role="group"><button class="slds-button slds-button--icon-border" (click)="shiftMinus()"><system-button-icon [icon]="\'chevronleft\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="shiftPlus()"><system-button-icon [icon]="\'chevronright\'"></system-button-icon></button></div><ng-container *ngIf="!isMobileView && !asPicker"><button class="slds-button slds-button--icon-border" (click)="calendar.refresh()"><system-button-icon [icon]="\'refresh\'"></system-button-icon></button><div class="slds-button-group slds-m-left--x-small" role="group"><button class="slds-button slds-button--icon-border" (click)="zoomout()" [disabled]="calendar.sheetHourHeight <=30 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomout\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="resetzoom()" [disabled]="calendar.sheetHourHeight ==80 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'undo\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="zoomin()" [disabled]="calendar.sheetHourHeight >=140 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomin\'"></system-button-icon></button></div><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="goToday()">{{language.getLabel(\'LBL_TODAY\')}}</button></ng-container><div *ngIf="!asPicker" class="slds-dropdown-trigger slds-dropdown-trigger--click slds-m-left--xx-small" [ngClass]="typeDropdownClass"><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="toggleTypeSelector()">{{language.getLabel(\'LBL_\'+ sheetType | uppercase )}}<system-button-icon [icon]="\'down\'"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown--x-small"><ul class="slds-dropdown__list" role="menu"><li class="slds-dropdown__item" role="presentation"><a href="javascript:void(0);" role="menuitem" (click)="setType(\'Day\')"><span class="slds-truncate">{{language.getLabel(\'LBL_DAY\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Three_Days\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_THREE_DAYS\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Week\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_WEEK\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Month\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_MONTH\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Schedule\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_SCHEDULE\')}}</span></a></li></ul></div></div></div></div></div><div #pickerontainer [ngClass]="pickerClass" aria-hidden="false" class="slds-datepicker slds-dropdown slds-dropdown_left" role="dialog"><system-input-date-picker *ngIf="openPicker" [setDate]="calendarDate" [weekStartDay]="weekStartDay" (datePicked)="handleDatePicked($event)"></system-input-date-picker></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,services_1.modelutilities,calendar])],e)}();exports.CalendarHeader=CalendarHeader;var CalendarSheetDropTarget=function(){function e(e,t,s){this.calendar=e,this.cdr=t,this.elementRef=s,this.hour=0,this.minutes=0}return Object.defineProperty(e.prototype,"date",{get:function(){return this.day?moment(this.day.date):this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hourPart",{set:function(e){this.minutes=e?15*e:0},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.cdr.detach()},e.prototype.addEvent=function(){var e=moment(this.date);e.hour(this.hour).minute(this.minutes).second(0),this.calendar.asPicker?this.calendar.pickerDate$.emit(e):this.calendar.addingEvent$.emit(e)},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"day",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],e.prototype,"hour",void 0),__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],e.prototype,"hourPart",null),e=__decorate([core_1.Component({selector:"calendar-sheet-drop-target",template:'<div *ngIf="!calendar.isDashlet" (click)="addEvent()">{{hour}}:{{minutes == 0 ? \'00\' : minutes}}</div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[calendar,core_1.ChangeDetectorRef,core_1.ElementRef])],e)}();exports.CalendarSheetDropTarget=CalendarSheetDropTarget;var Calendar=function(){function Calendar(e,t,s,n,r,a,i,o,l,d){var c=this;this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.modal=r,this.cdr=a,this.model=i,this.metadata=o,this.injector=l,this.calendar=d,this.otherCalendars=[],this.componentconfig={},this.googleIsVisible=!0,this.subscriptions=new rxjs_1.Subscription,this.xDown=null,this.yDown=null,this.self={},this.navigation.setActiveModule("Calendar");var h=this.calendar.addingEvent$.subscribe(function(e){return c.addEvent(e)});this.subscriptions.add(h),this.resizeListener=this.renderer.listen("window","resize",function(){c.calendar.isMobileView=c.calendarContainer.element.nativeElement.getBoundingClientRect().width<768}),this.touchStartListener=this.renderer.listen("document","touchstart",function(e){return c.handleTouchStart(e)})}return Object.defineProperty(Calendar.prototype,"pickerDualMode",{get:function(){return this.componentconfig.pickerDualMode},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"isMobileView",{get:function(){return this.calendar.isMobileView},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sheetType",{get:function(){return this.calendar.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sidebarWidth",{get:function(){return this.calendar.sidebarWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"weekStartDay",{get:function(){return this.calendar.weekStartDay},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"asPicker",{get:function(){return this.calendar.asPicker},set:function(e){e?(this.calendar.sheetType="Three_Days",this.calendar.asPicker=e):this.closeModal()},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sidebarStyle",{get:function(){return{width:this.calendar.sidebarwidth+"px","z-index":1}},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"mainContainerClass",{get:function(){return this.asPicker?"slds-modal slds-fade-in-open slds-modal_large":"slds-theme--default"},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sheetStyle",{get:function(){return{width:"calc(100% - "+this.sidebarWidth+"px)",height:"100%"}},enumerable:!0,configurable:!0}),Calendar.prototype.ngAfterViewInit=function(){this.calendar.isMobileView=this.calendarContainer.element.nativeElement.getBoundingClientRect().width<768,this.cdr.detectChanges()},Calendar.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe(),this.resizeListener&&this.resizeListener(),this.touchStartListener&&this.touchStartListener()},Calendar.prototype.handleUntilDate=function(e){this.calendarHeader.scheduleUntilDate=e},Calendar.prototype.setDateChanged=function(e){this.calendarHeader.toggleClosed(),this.calendar.refresh(e)},Calendar.prototype.handleGoogleIsVisible=function(e){this.googleIsVisible=e},Calendar.prototype.gotToDayView=function(e){this.calendar.refresh(e),this.calendar.sheetType="Day"},Calendar.prototype.closeModal=function(){this.self.destroy()},Calendar.prototype.handleTouchStart=function(e){var t=this,s=e.touches||e.originalEvent.touches;this.xDown=s[0].clientX,this.yDown=s[0].clientY,this.touchMoveListener=this.renderer.listen("document","touchmove",function(e){return t.handleTouchMove(e)})},Calendar.prototype.handleTouchMove=function(e){if(this.touchMoveListener(),this.xDown&&this.yDown){var t=this.xDown-e.touches[0].clientX;Math.abs(t)>Math.abs(this.yDown-e.touches[0].clientY)&&(t<0?this.calendar.shiftMinus():this.calendar.shiftPlus()),this.xDown=null,this.yDown=null}},Calendar.prototype.addEvent=function(n){var r=this;this.model.reset(),this.modal.openModal("CalendarAddModulesModal",!0,this.injector).subscribe(function(e){e.instance.module$.pipe(operators_1.take(1)).subscribe(function(e){var t;if(e){r.model.module=e.name;var s=((t={})[e.dateStartFieldName]=n,t);"UserAbsences"==e.name&&(s.user_id=r.calendar.owner,s.user_name=r.calendar.ownerName),r.model.addModel("",null,s)}})})},__decorate([core_1.ViewChild("calendarcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],Calendar.prototype,"calendarContainer",void 0),__decorate([core_1.ViewChild(CalendarHeader,{static:!0}),__metadata("design:type",CalendarHeader)],Calendar.prototype,"calendarHeader",void 0),Calendar=__decorate([core_1.Component({selector:"calendar",template:'<div #calendarcontainer [ngClass]="mainContainerClass" [class.slds-text-body--small]="isMobileView" [attr.role]="!asPicker ? \'none\' : \'dialog\'" [tobottomnoscroll]="!asPicker" style="height: 100%"><div [class.slds-modal__container]="asPicker" style="height: inherit"><div class="slds-grid slds-grid--vertical" style="height: inherit"><calendar-header (datePicked)="setDateChanged($event)" style="display: block"></calendar-header><div class="slds-grid slds-theme_default slds-border--right slds-grow" style="min-height: 100px"><div *ngIf="!isMobileView" [ngStyle]="sidebarStyle" class="slds-border--right slds-p-around--xx-small slds-scrollable--y slds-size--1-of-1 slds-theme--default" style="height: 100%"><system-input-date-picker [setDate]="calendarDate" [dual]="pickerDualMode" [showTodayButton]="false" [weekStartDay]="weekStartDay" (datePicked)="setDateChanged($event)"></system-input-date-picker><calendar_other_calendars_monitor (googleIsVisible$)="handleGoogleIsVisible($event)" [othercalendars]="otherCalendars"></calendar_other_calendars_monitor></div><div [ngStyle]="sheetStyle" [ngSwitch]="sheetType" [overlayLoadingSpinner]="calendar.isLoading"><calendar-sheet-day *ngSwitchCase="\'Day\'" [googleisvisible]="googleIsVisible" [setdate]="calendarDate" style="display: block; height: inherit"></calendar-sheet-day><calendar-sheet-three-days *ngSwitchCase="\'Three_Days\'" [googleisvisible]="googleIsVisible" [setdate]="calendarDate" (navigateday)="gotToDayView($event)" style="display: block; height: inherit"></calendar-sheet-three-days><calendar-sheet-week *ngSwitchCase="\'Week\'" [googleisvisible]="googleIsVisible" [setdate]="calendarDate" (navigateday)="gotToDayView($event)" style="display: block; height: inherit"></calendar-sheet-week><calendar-sheet-month *ngSwitchCase="\'Month\'" [googleisvisible]="googleIsVisible" [setdate]="calendarDate" (navigateday)="gotToDayView($event)" style="display: block; height: inherit"></calendar-sheet-month><calendar-sheet-schedule *ngSwitchCase="\'Schedule\'" [googleisvisible]="googleIsVisible" [setdate]="calendarDate" (navigateday)="gotToDayView($event)" (untildate$)="handleUntilDate($event)" style="display: block; height: inherit"></calendar-sheet-schedule></div></div><div><footer *ngIf="asPicker" class="slds-modal__footer"><button class="slds-button slds-button--neutral" (click)="closeModal()">{{language.getLabel(\'LBL_CLOSE\')}}</button></footer></div></div></div></div>',providers:[calendar,services_1.model]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,services_1.modal,core_1.ChangeDetectorRef,services_1.model,services_1.metadata,core_1.Injector,calendar])],Calendar)}();exports.Calendar=Calendar;var CalendarSheetDay=function(){function e(e,t){var s=this;this.language=e,this.calendar=t,this.setdate={},this.usersCalendars=[],this.googleIsVisible=!0,this.navigateweek=new core_1.EventEmitter,this.sheetDay={},this.sheetHours=[],this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.subscription=new rxjs_1.Subscription,this.buildHours(),this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){s.getUserEvents(e)})),this.subscription.add(this.calendar.usersCalendarsLoad$.subscribe(function(){s.getUsersEvents()}))}return Object.defineProperty(e.prototype,"multiEventStyle",{get:function(){return{height:this.calendar.multiEventHeight+"px",width:"100%",position:"initial",display:"block"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hourHeightStyle",{get:function(){return{height:this.calendar.sheetHourHeight+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDashlet",{get:function(){return this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(this.calendar.timeZone).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(this.calendar.endHour-this.calendar.startHour,"h")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextContainerClass",{get:function(){return this.isDashlet?"slds-grid slds-grid--vertical-align-center":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextDayClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-body--regular"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTextDateClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-heading--large"},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.setdate&&(this.sheetDay={date:e.setdate.currentValue},this.getEvents(),this.calendar.usersCalendarsLoaded&&this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},Object.defineProperty(e.prototype,"timeColStyle",{get:function(){return{width:this.sheetTimeWidth+"px",height:"100%"}},enumerable:!0,configurable:!0}),e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.trackByIndexFn=function(e,t){return e},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}))})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}))})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.userMultiEvents=this.userMultiEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.isMulti?s.userMultiEvents.push(e):s.userEvents.push(e)}))})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.userMultiEvents=[],this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),(e=t.filterEvents(e)).forEach(function(e){e.isMulti?t.userMultiEvents.push(e):t.userEvents.push(e)}))})},e.prototype.filterEvents=function(e){var t=this;return e.filter(function(e){return e.end.hour()>t.calendar.startHour||e.start.hour()<t.calendar.endHour||"absence"==e.type})},e.prototype.displayDate=function(e){switch(e){case"day":return this.setdate.format("ddd");case"date":return this.setdate.format(this.isDashlet?"D, MMMM":"D")}},e.prototype.getEventStyle=function(e){var t=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),s=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),n=(this.calendarsheet.element.nativeElement.clientWidth-this.sheetTimeWidth)/(0<e.maxOverlay?e.maxOverlay:1);return{left:this.sheetTimeWidth+n*e.displayIndex+"px",width:n+"px",top:this.calendar.sheetHourHeight/60*t-1+"px",height:this.calendar.sheetHourHeight/60*(s-t)+"px"}},e.prototype.getDayColStyle=function(){return{width:"calc(100% - "+this.sheetTimeWidth+"px)"}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.isTodayStyle=function(){var e=new moment;return{color:e.year()===this.setdate.year()&&e.month()===this.setdate.month()&&e.date()==this.setdate.date()?this.calendar.todayColor:"inherit"}},e.prototype.onEventDrop=function(e){this.calendar.onEventDrop(e,this.dropTargets)},__decorate([core_1.ViewChildren(CalendarSheetDropTarget),__metadata("design:type",core_1.QueryList)],e.prototype,"dropTargets",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),__decorate([core_1.Input("calendarcontent"),__metadata("design:type",Object)],e.prototype,"calendarContentContainer",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateweek",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-day",template:'<div class="slds-grid slds-grid--vertical" style="height: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [ngStyle]="timeColStyle">{{offset}}</div><div class="slds-size--1-of-1 slds-border--left slds-p-top--xx-small" [ngStyle]="getDayColStyle()"><div class="slds-p-bottom--xx-small" [ngClass]="dayTextContainerClass"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextDayClass" [ngStyle]="isTodayStyle()">{{displayDate(\'day\')}}</div><h1 class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextDateClass" [ngStyle]="isTodayStyle()">{{displayDate(\'date\')}}</h1></div><div [style.min-height.px]="calendar.multiEventHeight" class="slds-text-align--center slds-border--top slds-p-around--xxx-small slds-text-body--small"><ng-container *ngFor="let event of allMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="multiEventStyle" [event]="event" class="spice-calendar-event"></calendar-sheet-event></ng-container></div></div></div><div #calendarsheet class="slds-scrollable--y slds-is-relative slds-grow calendar-event-drag-boundary"><ng-container><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [ngStyle]="timeColStyle"><div class="slds-text-align--center slds-border--bottom" [ngStyle]="hourHeightStyle">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow" [ngStyle]="hourHeightStyle"><div style="height: 50%" class="slds-grid slds-grid--vertical"><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div><ng-container *ngFor="let event of allEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" (eventDrop)="onEventDrop($event)" [event]="event" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container></div></div>'}),__metadata("design:paramtypes",[services_1.language,calendar])],e)}();exports.CalendarSheetDay=CalendarSheetDay;var CalendarSheetThreeDays=function(){function e(e,t){var s=this;this.language=e,this.calendar=t,this.sheetDays=[],this.sheetHours=[],this.setdate={},this.usersCalendars=[],this.googleIsVisible=!0,this.navigateday=new core_1.EventEmitter,this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.subscription=new rxjs_1.Subscription,this.buildHours(),this.sheetDays=this.buildSheetDays(),this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){s.getUserEvents(e)})),this.subscription.add(this.calendar.usersCalendarsLoad$.subscribe(function(){s.getUsersEvents()}))}return Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(this.calendar.timeZone).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDashlet",{get:function(){return this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(2,"d")).hour(this.calendar.endHour)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextContainerClass",{get:function(){return this.isDashlet?"slds-grid slds-grid--vertical-align-center":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-body--regular"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTextClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-heading--large"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeColStyle",{get:function(){return{width:this.sheetTimeWidth+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hourHeightStyle",{get:function(){return{height:this.calendar.sheetHourHeight+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayWidthStyle",{get:function(){return{width:"calc(100% / "+this.calendar.weekDaysCount+")"}},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.sheetDays=this.buildSheetDays(),e.setdate&&(this.getEvents(),this.calendar.usersCalendarsLoaded&&this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.trackByIndexFn=function(e,t){return e},e.prototype.arrangeMultiEvents=function(){var e=this;this.sheetDays.forEach(function(e){return e.events=[]});for(var t=function(t){for(var e=0,s=a.sheetDays;e<s.length;e++)for(var n=s[e],r=moment(t.start);r.diff(t.end)<=0;r.add(1,"days"))r.date()!=n.date.date()||n.events.some(function(e){return e.id==t.id})||n.events.push(t)},a=this,s=0,n=this.allMultiEvents;s<n.length;s++){t(n[s])}this.sheetDays.forEach(function(e){e.events=e.events.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),e.events.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}),this.allMultiEvents.forEach(function(n){var r=null;e.sheetDays.forEach(function(s){s.events.forEach(function(e,t){e.id==n.id&&(null!=r&&0<n.end.diff(n.start,"days")?(s.events.splice(t,1),s.events.splice(r,0,n)):r=t)})})})},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.arrangeMultiEvents(),this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.arrangeMultiEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.userMultiEvents=this.userMultiEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.arrangeMultiEvents(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.isMulti?(s.userMultiEvents.push(e),s.arrangeMultiEvents()):s.userEvents.push(e)}))})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.userMultiEvents=[],this.arrangeMultiEvents(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),(e=t.filterEvents(e)).forEach(function(e){e.isMulti?(t.userMultiEvents.push(e),t.arrangeMultiEvents()):t.userEvents.push(e)}))})},e.prototype.filterEvents=function(e,t){var s=this;return e.filter(function(e){return e.end.hour()>s.calendar.startHour||e.start.hour()<s.calendar.endHour||"absence"==e.type})},e.prototype.buildSheetDays=function(){for(var e=[],t=0;t<3;){var s=new moment(this.setdate);s=s.add(t,"days"),e.push({index:t,date:moment(s),day:moment(s).day(),items:[]}),t++}return e},e.prototype.isTodayStyle=function(e){var t=new moment;return{color:t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()?this.calendar.todayColor:"inherit"}},e.prototype.getEventStyle=function(t){var e=this.buildSheetDays().find(function(e){return e.day==t.start.day()})||0,s=60*(t.start.hour()-this.calendar.startHour)+t.start.minute(),n=60*(t.end.hour()-this.calendar.startHour)+t.end.minute(),r=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,a=this.sheetContainer.element.nativeElement.clientWidth-r,i=(a-this.sheetTimeWidth)/3/(0<t.maxOverlay?t.maxOverlay:1);return{left:this.sheetTimeWidth+(a-this.sheetTimeWidth)/3*e.index+i*t.displayIndex+"px",width:i+"px",top:this.calendar.sheetHourHeight/60*s+"px",height:this.calendar.sheetHourHeight/60*(n-s)+"px"}},e.prototype.getMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth)/3,r=new moment(this.setdate).hour(0).minute(0).second(0),a=new moment(r).add(moment.duration(3,"d")),i=0<+t.start.diff(r,"days")?+t.start.diff(r,"days"):0,o=i*n,l=(3-(i+(0<+t.end.diff(a,"days")?0:Math.abs(+t.end.diff(a,"days")))))*n;return this.sheetDays.some(function(e){if(-1<e.events.indexOf(t))return s=e.events.indexOf(t),!0}),{width:l+"px",left:o+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.getMultiEventsContainerStyle=function(){for(var e=1,t=0,s=this.sheetDays;t<s.length;t++){var n=s[t];e=n.events.length>e?n.events.length:e}return{height:this.calendar.multiEventHeight*e+"px"}},e.prototype.displayDate=function(e,t){switch(e){case"day":return t.format("ddd");case"date":return t.format(this.isDashlet?"D, MMM":"D")}},e.prototype.getDaysContainerStyle=function(){var e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width;return{width:this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth+"px"}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.gotoDay=function(e){if(!this.calendar.asPicker){var t=moment(e);this.navigateday.emit(t)}},e.prototype.onEventDrop=function(e){this.calendar.onEventDrop(e,this.dropTargets)},__decorate([core_1.ViewChildren(CalendarSheetDropTarget),__metadata("design:type",core_1.QueryList)],e.prototype,"dropTargets",void 0),__decorate([core_1.ViewChild("sheetContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"sheetContainer",void 0),__decorate([core_1.ViewChild("scrollcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"scrollContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-three-days",template:'<div #sheetContainer class="slds-grid slds-grid--vertical" style="height: 100%; width: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [ngStyle]="timeColStyle">{{offset}}</div><div class="slds-border--right" [ngStyle]="getDaysContainerStyle()"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--left" style="width: calc(100% / 3)"><div class="slds-p-vertical--xx-small slds-border--bottom" [ngClass]="dayTextContainerClass"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextClass" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'day\', sheetDay.date)}}</div><div class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextClass"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.date)" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'date\',sheetDay.date)}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of allMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="getMultiEventStyle(event)" [event]="event" class="spice-calendar-event"></calendar-sheet-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" style="width: calc(100% / 3)" [style.min-height]="calendar.multiEventHeight + \'px\'" class="slds-border--left"><div *ngFor="let event of sheetDay.events; trackBy: trackByItemFn" [style.height]="calendar.multiEventHeight + \'px\'"></div></div></div></div><div #scrollcontainer aria-hidden="true" class="spicecrm-scrollbar" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div class="slds-scrollable spicecrm-scrollbar slds-is-relative slds-grow calendar-event-drag-boundary" style="overflow-y: scroll;"><ng-container><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [ngStyle]="timeColStyle"><div class="slds-text-align--center slds-border--bottom" [ngStyle]="hourHeightStyle">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow slds-grid" [ngStyle]="hourHeightStyle"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--right" style="width: calc(100% / 3)"><div style="height: 50%" class="slds-grid slds-grid--vertical"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div></div><ng-container *ngFor="let event of allEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" [event]="event" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container></div></div>'}),__metadata("design:paramtypes",[services_1.language,calendar])],e)}();exports.CalendarSheetThreeDays=CalendarSheetThreeDays;var CalendarSheetWeek=function(){function e(e,t){var s=this;this.language=e,this.calendar=t,this.sheetDays=[],this.sheetHours=[],this.setdate={},this.usersCalendars=[],this.googleIsVisible=!0,this.navigateday=new core_1.EventEmitter,this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.subscription=new rxjs_1.Subscription,this.buildHours(),this.sheetDays=this.buildSheetDays(),this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){s.getUserEvents(e)})),this.subscription.add(this.calendar.usersCalendarsLoad$.subscribe(function(){s.getUsersEvents()}))}return Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(this.calendar.timeZone).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).day(this.calendar.weekStartDay).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(this.calendar.weekDaysCount-1,"d")).hour(this.calendar.endHour)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayWidthStyle",{get:function(){return{width:"calc(100% / "+this.calendar.weekDaysCount+")"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"daysContainerWidthStyle",{get:function(){var e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width;return this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth+"px"},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.sheetDays=this.buildSheetDays(),e.setdate&&(this.getEvents(),this.calendar.usersCalendarsLoaded&&this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.trackByItemFn=function(e,t){return t.id},e.prototype.trackByIndexFn=function(e,t){return e},e.prototype.arrangeMultiEvents=function(){var e=this;this.sheetDays.forEach(function(e){return e.events=[]});for(var t=function(t){for(var e=0,s=a.sheetDays;e<s.length;e++)for(var n=s[e],r=moment(t.start);r.diff(t.end)<=0;r.add(1,"days"))r.date()!=n.date.date()||n.events.some(function(e){return e.id==t.id})||n.events.push(t)},a=this,s=0,n=this.allMultiEvents;s<n.length;s++){t(n[s])}this.sheetDays.forEach(function(e){e.events=e.events.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),e.events.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}),this.allMultiEvents.forEach(function(n){var r=null;e.sheetDays.forEach(function(s){s.events.forEach(function(e,t){e.id==n.id&&(null!=r&&0<n.end.diff(n.start,"days")?(s.events.splice(t,1),s.events.splice(r,0,n)):r=t)})})})},e.prototype.correctHours=function(e){var n=this;return e.map(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.arrangeMultiEvents(),this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.arrangeMultiEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.userMultiEvents=this.userMultiEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.arrangeMultiEvents(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.isMulti?(s.userMultiEvents.push(e),s.arrangeMultiEvents()):s.userEvents.push(e)}))})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.userMultiEvents=[],this.arrangeMultiEvents(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),(e=t.filterEvents(e)).forEach(function(e){e.isMulti?(t.userMultiEvents.push(e),t.arrangeMultiEvents()):t.userEvents.push(e)}))})},e.prototype.filterEvents=function(e){var t=this;return e.filter(function(e){return e.end.hour()>t.calendar.startHour||e.start.hour()<t.calendar.endHour||"absence"==e.type})},e.prototype.buildSheetDays=function(){for(var e=[],t=0,s=this.calendar.weekStartDay;t<this.calendar.weekDaysCount;){var n=new moment(this.setdate);n.day(s),e.push({index:t,date:moment(n),day:s,items:[]}),t++,s++}return e},e.prototype.isTodayStyle=function(e){var t=new moment;return t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()?this.calendar.todayColor:"inherit"},e.prototype.getEventStyle=function(e){var t=1==this.calendar.weekStartDay&&0==e.start.day()?6:e.start.day()-this.calendar.weekStartDay,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),r=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,a=this.sheetContainer.element.nativeElement.clientWidth-r,i=(a-this.sheetTimeWidth)/this.calendar.weekDaysCount/(0<e.maxOverlay?e.maxOverlay:1);return{left:this.sheetTimeWidth+(a-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+i*e.displayIndex+"px",width:i+"px",top:this.calendar.sheetHourHeight/60*s+"px",height:this.calendar.sheetHourHeight/60*(n-s)+"px"}},e.prototype.getMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.sheetContainer.element.nativeElement.clientWidth-e-this.sheetTimeWidth)/this.calendar.weekDaysCount,r=new moment(this.setdate).day(this.calendar.weekStartDay).hour(0).minute(0).second(0),a=new moment(r).add(moment.duration(this.calendar.weekDaysCount,"d")),i=0<+t.start.diff(r,"days")?+t.start.diff(r,"days"):0,o=0<+t.end.diff(a,"days")?0:Math.abs(+t.end.diff(a,"days")),l=i*n,d=(this.calendar.weekDaysCount-(i+o))*n;return this.sheetDays.some(function(e){if(-1<e.events.indexOf(t))return s=e.events.indexOf(t),!0}),{width:d+"px",left:l+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.displayDate=function(e,t){return t.format(e)},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.gotoDay=function(e){this.navigateday.emit(moment(this.setdate).day(e))},e.prototype.onEventDrop=function(e){this.calendar.onEventDrop(e,this.dropTargets)},__decorate([core_1.ViewChildren(CalendarSheetDropTarget),__metadata("design:type",core_1.QueryList)],e.prototype,"dropTargets",void 0),__decorate([core_1.ViewChild("sheetContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"sheetContainer",void 0),__decorate([core_1.ViewChild("scrollcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"scrollContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-week",template:'<div #sheetContainer class="slds-grid slds-grid--vertical" style="height: 100%; width: 100%"><div class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [style.width]="sheetTimeWidth + \'px\'">{{offset}}</div><div class="slds-border--right" [style.width]="daysContainerWidthStyle"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--left" [ngStyle]="dayWidthStyle"><div class="slds-p-top--xx-small" [style.color]="isTodayStyle(sheetDay.date)"><div class="slds-text-body--regular slds-p-left--x-small">{{displayDate(\'ddd\', sheetDay.date)}}</div><div class="slds-p-left--x-small slds-p-bottom--xx-small slds-border--bottom slds-text-heading--large"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.day)">{{displayDate(\'D\',sheetDay.date)}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of allMultiEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="getMultiEventStyle(event)" [event]="event" class="spice-calendar-event"></calendar-sheet-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" [ngStyle]="dayWidthStyle" [style.min-height]="calendar.multiEventHeight + \'px\'" class="slds-border--left"><div *ngFor="let event of sheetDay.events; trackBy: trackByItemFn" [style.height]="calendar.multiEventHeight + \'px\'"></div></div></div></div><div #scrollcontainer class="slds-scrollable--y" aria-hidden="true" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div class="slds-scrollable--y slds-is-relative slds-grow calendar-event-drag-boundary" style="overflow-y: scroll;"><ng-container><div *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByIndexFn" class="slds-grid"><div [style.width]="sheetTimeWidth + \'px\'"><div class="slds-text-align--center slds-border--bottom" [style.height]="calendar.sheetHourHeight + \'px\'">{{sheetHour}}:00</div></div><div class="slds-border--left slds-border--bottom slds-grow slds-grid" [style.height]="calendar.sheetHourHeight + \'px\'"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByIndexFn" class="slds-border--right" [ngStyle]="dayWidthStyle"><div style="height: 50%" class="slds-grid slds-grid--vertical"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="0" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="1" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div><div class="slds-border--top slds-grid slds-grid--vertical" style="height: 50%"><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="2" class="spice-calendar-drop-target"></calendar-sheet-drop-target><calendar-sheet-drop-target [day]="sheetDay" [hour]="sheetHour" [hourPart]="3" class="spice-calendar-drop-target"></calendar-sheet-drop-target></div></div></div></div><ng-container *ngFor="let event of allEvents; trackBy: trackByItemFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" [event]="event" (eventDrop)="onEventDrop($event)" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container></div></div>'}),__metadata("design:paramtypes",[services_1.language,calendar])],e)}();exports.CalendarSheetWeek=CalendarSheetWeek;var CalendarSheetMonth=function(){function e(e,t,s,n,r,a,i,o){var l=this;this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=r,this.renderer=a,this.cdr=i,this.calendar=o,this.navigateday=new core_1.EventEmitter,this.setdate={},this.googleIsVisible=!0,this.currentGrid=[],this.offsetHeight=20,this.ownerEvents=[],this.userEvents=[],this.googleEvents=[],this.subscription=new rxjs_1.Subscription,this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){l.getUserEvents(e)})),this.subscription.add(this.calendar.usersCalendarsLoad$.subscribe(function(){l.getUsersEvents()}))}return Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.ownerEvents.concat(this.userEvents,this.googleEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventHeight",{get:function(){return this.calendar.isMobileView?20:25},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEventsPerBox",{get:function(){var e=this.calendarsheet?this.calendarsheet.element.nativeElement.clientHeight/this.currentGrid.length:void 0;return e?Math.floor((e-2*this.offsetHeight)/this.eventHeight):1},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.cdr.detectChanges()},e.prototype.ngOnChanges=function(e){this.buildGrid(),e.setdate&&(this.getEvents(),this.calendar.usersCalendarsLoaded&&this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.cdr.detach(),this.subscription.unsubscribe()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.startDate=function(){return new moment(this.setdate).date(1).hour(0).minute(0).second(0)},e.prototype.endDate=function(){return new moment(this.startDate()).endOf("month")},e.prototype.getSheetDays=function(){for(var e=[],t=0,s=this.calendar.weekStartDay,n=moment.weekdaysShort();t<this.calendar.weekDaysCount;)e.push({index:t,text:n[s]}),t++,6<++s&&(s=0);return e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.arrangeEvents(),this.calendar.loadEvents(this.startDate(),this.endDate()).subscribe(function(e){0<e.length&&(t.ownerEvents=e,t.arrangeEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.arrangeEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate(),this.endDate()).subscribe(function(e){0<e.length&&(t.googleEvents=e,t.arrangeEvents())})},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.arrangeEvents(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate(),this.endDate(),t.id).subscribe(function(e){0<e.length&&(s.userEvents=__spreadArrays(s.userEvents,e),s.arrangeEvents())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.arrangeEvents(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate(),this.endDate()).subscribe(function(e){0<e.length&&(t.userEvents=__spreadArrays(t.userEvents,e),t.arrangeEvents())})},e.prototype.arrangeEvents=function(){for(var i=this,e=function(a){r.currentGrid[a].forEach(function(e){return e.events=[]});for(var e=function(t){t.hasOwnProperty("weeksI")||(t.weeksI=[]);for(var e=0;e<r.currentGrid[a].length;e++){for(var s=r.currentGrid[a][e],n=moment(t.start);n.diff(t.end)<=0;n.add(1,"days"))n.date()==s.day&&s.month==n.month()&&(s.events.some(function(e){return e.id==t.id})||s.events.push(t),-1==t.weeksI.indexOf(a)&&t.weeksI.push(a));s.events=s.events.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),s.events.sort(function(e,t){return e.start.isSame(t.start,"day")&&(e.start.isAfter(t.start,"hour")||e.start.isSame(t.start,"hour")&&e.start.isAfter(t.start,"minute"))?1:-1})}},t=0,s=r.allEvents;t<s.length;t++){e(s[t])}r.allEvents.forEach(function(n){var r=null;i.currentGrid[a].forEach(function(s){s.events.forEach(function(e,t){e.id==n.id&&(null!=r&&0<n.end.diff(n.start,"days")?(s.events.splice(t,1),s.events.splice(r,0,n)):r=t)})})})},r=this,t=0;t<this.currentGrid.length;t++)e(t);return this.allEvents},e.prototype.gotoDay=function(e){var t=moment(this.setdate);t.month(e.month).date(e.day),this.navigateday.emit(t)},e.prototype.getDayColStyle=function(e){var t=new moment,s=t.format("ddd"),n=this.calendar.calendarDate,r=n.year()==t.year()&&n.month()==t.month()&&s==e;return{width:"calc(100% / "+this.calendar.weekDaysCount+")",color:r?this.calendar.todayColor:"inherit","font-weight":r?"600":"inherit"}},e.prototype.getDayDividerStyle=function(e){return{left:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount*e+"px",top:"0px",height:"100%"}},e.prototype.buildGrid=function(){this.currentGrid=[];var e=new moment(this.setdate);e.date(1),e.day(this.calendar.weekStartDay);for(var t=0;t<6;){var s=0,n=[];if(e.year()<this.setdate.year()||e.month()<=this.setdate.month()){for(;s<this.calendar.weekDaysCount;){n.push({day:e.date(),month:e.month(),items:[]});var r=7-this.calendar.weekDaysCount;s==this.calendar.weekDaysCount-1&&this.calendar.weekDaysCount<7&&e.add(r,"d"),e.add(1,"d"),s++}this.currentGrid.push(n)}t++}},e.prototype.notLastWeek=function(e){return e<this.currentGrid.length},e.prototype.notThisMonth=function(e){return e!==this.setdate.month()},e.prototype.getWeekDividerStyle=function(e){return{top:"calc((100% / "+this.currentGrid.length+") * "+e+" )"}},e.prototype.getBoxStyle=function(e,t,s){return{left:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount*t+"px",top:"calc((100% / "+this.currentGrid.length+") * "+e+" )",color:this.notThisMonth(s)?"#9faab5":"inherit","background-color":this.notThisMonth(s)?"#f4f6f9":"transparent",width:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount+"px",height:"calc(100% / "+this.currentGrid.length+")"}},e.prototype.getEventStyle=function(s,e){var n=this,r=null,a=null,i=0,o="block",t=this.calendarsheet.element.nativeElement;return this.currentGrid[e].forEach(function(e,t){-1<e.events.indexOf(s)&&(i++,r=null==r?t:r,t,a=a||e.events.indexOf(s),o=a>=n.maxEventsPerBox?"none":o)}),{left:t.clientWidth/this.calendar.weekDaysCount*r+"px",width:t.clientWidth/this.calendar.weekDaysCount*i+"px",top:this.offsetHeight+t.clientHeight/this.currentGrid.length*e+this.eventHeight*a+"px",height:this.eventHeight+"px",display:o}},e.prototype.isTodayStyle=function(e,t){var s=this.calendar.calendarDate.year(),n=new moment,r=s===n.year()&&n.month()===t&&n.date()==e;return{"border-radius":"50%","line-height":"1rem","text-align":"center",width:"1.1rem",height:"1.1rem",display:"block",color:r?"#fff":"inherit","background-color":r?this.calendar.todayColor:"inherit"}},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-month",template:'<div class="slds-grid slds-grid_vertical" style="height: 100%"><div class="slds-border--bottom"><div class="slds-grid"><div class="slds-text-align--center slds-p-vertical--small slds-border--left" *ngFor="let sheetDay of getSheetDays(); trackBy: trackByFnDate" [ngStyle]="getDayColStyle(sheetDay.text)">{{sheetDay.text}}</div></div></div><div #calendarsheet class="slds-scrollable slds-p-vertical--medium slds-is-relative slds-grow"><ng-container><ng-container *ngFor="let sheetWeek of currentGrid; let i = index; trackBy: trackByFnDate"><div *ngFor="let sheetDay of sheetWeek; let j = index; trackBy: trackByFnDate" class="slds-is-absolute slds-truncate" [ngStyle]="getBoxStyle(i, j, sheetDay.month)"><div class="slds-p-around--xx-small" [style.height]="offsetHeight + \'px\'"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay)" [ngStyle]="isTodayStyle(sheetDay.day, sheetDay.month)">{{sheetDay.day}}</a></div><div class="slds-grid slds-grid--align-center slds-is-absolute" style="bottom: 0;width: 100%" [style.height]="offsetHeight + \'px\'"><calendar-more-button *ngIf="sheetDay.events.length > 0 && sheetDay.events.length > maxEventsPerBox" [sheetday]="sheetDay" [moreevents]="sheetDay.events" [ismobileview]="calendar.isMobileView"></calendar-more-button></div></div><div *ngIf="notLastWeek(i)" class="slds-is-absolute slds-border--bottom slds-size--1-of-1" [ngStyle]="getWeekDividerStyle(i)"></div></ng-container><ng-container *ngFor="let sheetDay of getSheetDays(); trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle(sheetDay.index)"></div></ng-container><ng-container *ngFor="let event of allEvents; trackBy: trackByFn"><ng-container *ngFor="let week of event.weeksI; trackBy: trackByFnDate"><calendar-sheet-event [event]="event" style="padding: 1px 0" [ngStyle]="getEventStyle(event, week)" class="spice-calendar-event"></calendar-sheet-event></ng-container></ng-container></ng-container></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.backend,core_1.Renderer2,core_1.ChangeDetectorRef,calendar])],e)}();exports.CalendarSheetMonth=CalendarSheetMonth;var CalendarSheetSchedule=function(){function e(e,t,s,n,r,a,i){var o=this;this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=r,this.session=a,this.calendar=i,this.navigateday=new core_1.EventEmitter,this.untildate$=new core_1.EventEmitter,this.setdate={},this.usersCalendars=[],this.googleIsVisible=!0,this.allevents=[],this.ownerEvents=[],this.userEvents=[],this.googleEvents=[],this.untilDate={},this.subscription=new rxjs_1.Subscription,this.untilDate=(new moment).hour(0).minute(0).second(0).add(1,"M"),this.subscription.add(this.calendar.userCalendarChange$.subscribe(function(e){o.getUserEvents(e)})),this.subscription.add(this.calendar.usersCalendarsLoad$.subscribe(function(){o.getUsersEvents()}))}return Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.allevents},set:function(e){var t=this.groupByDay(this.ownerEvents.concat(this.userEvents,this.googleEvents));t.sort(function(e,t){return e.date-t.date}),this.allevents=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showNoneMsg",{get:function(){return 0==this.allEvents.length&&this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(0).minute(0).second(0)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.setdate&&(this.setUntilDate(),this.getEvents(),this.calendar.usersCalendarsLoaded&&this.getUsersEvents()),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.setUntilDate=function(){this.untilDate=moment(this.setdate).add(1,"M"),this.untildate$.emit(this.untilDate)},e.prototype.getUntilDate=function(){return this.untilDate.format("MMM D, Y")},e.prototype.groupByDay=function(e){for(var r=[],a=new moment(this.setdate).hour(0).minute(0).second(0),t=0,s=e;t<s.length;t++)for(var i=s[t],n=new moment(i.start).hour(0).minute(0).second(0),o=new moment(i.end).hour(0).minute(0).second(0),l=function(s){var e=a.year()==s.year()&&a.month()==s.month()&&a.date()==s.date();if(s.isAfter(a)||e){var t={year:s.year(),month:s.month(),day:s.date(),date:moment(s),events:[i]},n=-1;r.some(function(e,t){if(e.year==s.year()&&e.month==s.month()&&e.day==s.date())return n=t,!0}),0<r.length&&-1<n?r[n].events.push(i):r.push(t)}},d=moment(n);d.diff(o,"days")<=0;d.add(1,"days"))l(d);return r},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.allEvents=this.allevents.slice(),this.calendar.loadEvents(this.startDate,this.untilDate).subscribe(function(e){0<e.length&&(t.ownerEvents=e),t.allEvents=t.allevents.slice()})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleIsVisible&&!this.calendar.isMobileView?this.calendar.loadGoogleEvents(this.startDate,this.untilDate).subscribe(function(e){t.googleEvents=e,t.allEvents=t.allevents.slice()}):this.allEvents=this.allevents.slice()},e.prototype.getUserEvents=function(t){var s=this;this.userEvents=this.userEvents.filter(function(e){return e.data.assigned_user_id!=t.id}),this.allEvents=this.allevents.slice(),!this.calendar.isMobileView&&t.visible&&this.calendar.loadUserEvents(this.startDate,this.untilDate,t.id).subscribe(function(e){0<e.length&&(s.userEvents=__spreadArrays(s.userEvents,e),s.allEvents=s.allevents.slice())})},e.prototype.getUsersEvents=function(){var t=this;this.userEvents=[],this.allEvents=this.allevents.slice(),this.calendar.isMobileView||this.calendar.loadUsersEvents(this.startDate,this.untilDate).subscribe(function(e){0<e.length&&(t.userEvents=e,t.allEvents=t.allevents.slice())})},e.prototype.getShortDay=function(e){return new moment(e).format("ddd")},e.prototype.getMonthDayYear=function(e){return new moment(e).format("MMM D, YYYY")},e.prototype.goToDay=function(e){this.navigateday.emit(e)},e.prototype.getTime=function(e,t,s){return s?"All Day":e.format("HH:mm")+" - "+t.format("HH:mm")+" "},e.prototype.loadMore=function(){this.untilDate=moment(this.untilDate).add(1,"M"),this.untildate$.emit(this.untilDate),this.getEvents(),this.getGoogleEvents(),this.getUsersEvents()},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"untildate$",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-schedule",template:'<div style="height: 100%" class="slds-scrollable--y"><div *ngFor="let day of allEvents; trackBy: trackByFnDate" class="slds-grid slds-border--bottom"><div class="slds-border--right slds-p-around--xx-small slds-size--1-of-4"><div>{{getShortDay(day.date)}}</div><div><a style="cursor: pointer" class="slds-text-link" (click)="goToDay(day.date)">{{getMonthDayYear(day.date)}}</a></div></div><div class="slds-size--3-of-4"><div *ngFor="let event of day.events; trackBy: trackByFn; let last = last" [class.slds-border--bottom]="!last" class="slds-grid slds-p-horizontal--xx-small"><div class="slds-button slds-button--icon slds-m-right--x-small slds-p-top--xxx-small" style="height: 100%" [style.color]="event.color"><system-button-icon icon="user" size="small"></system-button-icon></div><div class="slds-truncate slds-size--1-of-4" style="height: 100%;" [title]="getTime(event.start, event.end, event.isMulti)">{{getTime(event.start, event.end, event.isMulti)}}</div><div class="slds-size--3-of-4"><calendar-sheet-event [event]="event" style="position: initial" class="spice-calendar-event"></calendar-sheet-event></div></div></div></div><div *ngIf="!showNoneMsg" class="slds-grid slds-p-around--small">{{language.getLabel(\'MSG_SHOWING_EVENTS_UNTIL\')}} {{getUntilDate()}} <a style="cursor: pointer" class="slds-text-link slds-m-left--xx-small" (click)="loadMore()">{{language.getLabel(\'LBL_MORE\')}}</a></div><div *ngIf="showNoneMsg" class="slds-align_absolute-center slds-m-top--medium">{{language.getLabel(\'MSG_NO_RECORDS_FOUND\')}}</div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.backend,services_1.session,calendar])],e)}();exports.CalendarSheetSchedule=CalendarSheetSchedule;var CalendarSheetEvent=function(){function CalendarSheetEvent(e,t,s,n,r,a,i,o,l,d,c){this.language=e,this.configuration=t,this.calendar=s,this.model=n,this.view=r,this.broadcast=a,this.cdr=i,this.userpreferences=o,this.metadata=l,this.elementRef=d,this.renderer=c,this.rearrange=new core_1.EventEmitter,this.eventDrop=new core_1.EventEmitter,this.fields=[],this.event={},this.lastMoveTimeSpan=0,this.color="",this.hasDarkColor=!0,this.subscriptions=new rxjs_1.Subscription,this.subscribeToColorChange(),this.subscribeToModelSave(),this.view.displayLabels=!1}return Object.defineProperty(CalendarSheetEvent.prototype,"startHour",{get:function(){return this.model.data.date_start?moment(this.model.data.date_start).tz(this.calendar.timeZone).format(this.userpreferences.getTimeFormat()):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"textClass",{get:function(){return"Schedule"!=this.calendar.sheetType&&this.hasDarkColor?"spice-calendar-event-has-dark-color":""},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"isAbsence",{get:function(){return"absence"==this.event.type||"UserAbsences"==this.event.module},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"isDraggable",{get:function(){return this.canEdit&&!this.event.isMulti&&"Month"!=this.calendar.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"canEdit",{get:function(){return this.model.data.acl&&this.model.checkAccess("edit")&&"Schedule"!=this.calendar.sheetType&&("event"==this.event.type||"absence"==this.event.type)&&!this.calendar.asPicker&&!this.calendar.isMobileView&&!this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"owner",{get:function(){return this.calendar.owner},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarSheetEvent.prototype,"lockAxis",{get:function(){return"Day"==this.calendar.sheetType?"y":void 0},enumerable:!0,configurable:!0}),CalendarSheetEvent.prototype.ngOnInit=function(){this.setModelDataFromEvent(),this.loadFieldset(),this.setEventColor()},CalendarSheetEvent.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},CalendarSheetEvent.prototype.onClick=function(){this.cdr.detectChanges()},CalendarSheetEvent.prototype.onDragStart=function(){this.elementRef.nativeElement.style.zIndex=9999},CalendarSheetEvent.prototype.onDrop=function(e){var t=this;e.day&&(this.event.start=moment(e.day.date)),this.event.start.hour(e.hour).minute(e.minutes).seconds(0),this.event.end=moment(this.event.start.format()).add(this.event.data.duration_minutes+60*this.event.data.duration_hours,"m");var s=this.calendar.modules.find(function(e){return e.name==t.event.module})||{},n=s.dateStartName||"date_start",r=s.dateEndName||"date_end";this.event.data[n]=moment(this.event.start.format()),this.event.data[r]=new moment(this.event.end.format()),this.model.data=__assign({},this.event.data),this.model.save(!1)},CalendarSheetEvent.prototype.isDarkColor=function(e){var t=-1<e.indexOf("#")?e.substring(1):e,s=parseInt(t,16);return.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(s>>0&255)<120},CalendarSheetEvent.prototype.emitDrop=function(e){this.elementRef.nativeElement.style.zIndex="initial",this.eventDrop.emit(e)},CalendarSheetEvent.prototype.loadFieldset=function(){var e=this.metadata.getComponentConfig("CalendarSheetEvent",this.model.module);e&&e.header_fieldset&&(this.headerFieldset=e.header_fieldset),e&&e.sub_fieldset&&(this.subFieldset=e.sub_fieldset)},CalendarSheetEvent.prototype.subscribeToColorChange=function(){var t=this;this.subscriptions.add(this.calendar.otherCalendarsColor$.subscribe(function(e){t.event.data.assigned_user_id&&e.id==t.event.data.assigned_user_id&&(t.event.otherColor=e.color,t.cdr.detectChanges())}))},CalendarSheetEvent.prototype.subscribeToModelSave=function(){var r=this;this.subscriptions.add(this.broadcast.message$.subscribe(function(e){var t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if(s==r.model.module)switch(e.messagetype){case"model.save":t==r.model.id&&(r.model.data=r.model.utils.backendModel2spice(r.model.module,n),r.setEventColor()),r.cdr.detectChanges()}}))},CalendarSheetEvent.prototype.setModelDataFromEvent=function(){this.model.module=this.event.module,this.model.id=this.event.id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.event.data)},CalendarSheetEvent.prototype.onMouseDown=function(e){var t=this;this.canEdit&&(this.cdr.detach(),this.previewsPageY=e.pageY,this.currentPageY=e.pageY,this.event.resizing=!0,this.mouseUpListener=this.renderer.listen("document","mouseup",function(){return t.onMouseUp()}),this.mouseMoveListener=this.renderer.listen("document","mousemove",function(e){return t.onMouseMove(e)}),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1)},CalendarSheetEvent.prototype.onMouseMove=function(e){this.currentPageY=e.pageY;var t=this.currentPageY-this.previewsPageY,s=Math.floor(t/15);if(this.lastMoveTimeSpan!==s){this.lastMoveTimeSpan=s;var n=new moment(this.event.start).add(60*this.event.data.duration_hours+this.event.data.duration_minutes+15*this.lastMoveTimeSpan,"m");this.event.start.hours()===n.hours()&&this.event.start.minutes()===n.minutes()||n.hours()<this.event.start.hours()?(this.event.end=new moment(this.event.start).add(15,"m"),this.lastMoveTimeSpan=this.lastMoveTimeSpan-(60*this.event.data.duration_hours+this.event.data.duration_minutes+15*this.lastMoveTimeSpan)/15+1):this.event.end=n}},CalendarSheetEvent.prototype.onMouseUp=function(){var e=this;if(this.cdr.reattach(),this.mouseUpListener(),this.mouseMoveListener(),this.currentPageY!=this.previewsPageY){var t=60*+this.event.data.duration_hours+ +this.event.data.duration_minutes+15*this.lastMoveTimeSpan;this.event.data.duration_hours=Math.floor(t/60),this.event.data.duration_minutes=t-60*this.event.data.duration_hours,this.model.data.duration_minutes=this.event.data.duration_minutes,this.model.data.duration_hours=this.event.data.duration_hours,this.event.saving=!0,this.model.save().subscribe(function(){e.event.saving=!1,e.cdr.detectChanges()}),this.rearrange.emit()}this.previewsPageY=void 0,this.currentPageY=void 0,this.event.resizing=!1,this.lastMoveTimeSpan=0},CalendarSheetEvent.prototype.setEventColor=function(){var t=this;if("Schedule"==this.calendar.sheetType)return this.color="transparent";this.color=this.event.hasOwnProperty("color")?this.event.color:this.calendar.eventColor;var e=this.configuration.getData("calendarcolorconditions");if(e)for(var s=0,n=e=e.filter(function(e){return e.module==t.model.module}).sort(function(e,t){return+e.priority<+t.priority?1:-1});s<n.length;s++){var r=n[s];if(!(null!=r.module_filter&&0<r.module_filter.length)){this.color=-1<r.color_hex_code.indexOf("#")?r.color_hex_code:"#"+r.color_hex_code,this.hasDarkColor=this.isDarkColor(r.color_hex_code);break}if(this.model.checkModuleFilterMatch(r.module_filter)){this.color=-1<r.color_hex_code.indexOf("#")?r.color_hex_code:"#"+r.color_hex_code,this.hasDarkColor=this.isDarkColor(r.color_hex_code);break}}},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],CalendarSheetEvent.prototype,"rearrange",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],CalendarSheetEvent.prototype,"eventDrop",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CalendarSheetEvent.prototype,"event",void 0),CalendarSheetEvent=__decorate([core_1.Component({selector:"calendar-sheet-event",template:'<div (click)="onClick()" cdkDrag [cdkDragData]="this" [cdkDragLockAxis]="lockAxis" (cdkDragEnded)="emitDrop($event)" (cdkDragStarted)="onDragStart()" [cdkDragDisabled]="!isDraggable" [class.slds-p-vertical--xx-small]="event.saving" [style.background-color]="this.color" cdkDragBoundary=".calendar-event-drag-boundary" class="slds-grid slds-m-around--xxx-small spice-free-drag-preview" style="height: 100%;border-radius: 2px;"><abbr *ngIf="event.otherColor" [style.background-color]="event.otherColor" [title]="event.data.assigned_user_name" style="height: calc(100% - 2px); width: 8px; border-radius: 2px; margin: 1px; box-shadow: #4b4b4b 1px 0 1px 0;"></abbr><div [style.width]="event.otherColor ? \'calc(100% - 8px)\' : \'100%\'"><ng-container *ngIf="!event.saving; else saving"><div class="slds-grid slds-grid--align-spread slds-p-horizontal--xx-small" style="height: 100%;"><div class="slds-truncate" style="height: inherit; width: 100%"><object-record-fieldset-horizontal-list *ngIf="headerFieldset; else summaryContainer" [ngClass]="textClass" [fieldset]="headerFieldset"></object-record-fieldset-horizontal-list><ng-template #summaryContainer><span modelPopOver class="slds-text-link--reset" [ngClass]="textClass">{{model.data.summary_text}}</span> <span *ngIf="event.isMulti && startHour && !isAbsence" [ngClass]="textClass">, {{startHour}}</span></ng-template><object-record-fieldset-horizontal-list *ngIf="subFieldset && !event.isMulti" [ngClass]="textClass" [fieldset]="subFieldset"></object-record-fieldset-horizontal-list></div><object-action-menu [buttonsize]="\'xx-small\'"></object-action-menu></div><div *ngIf="!event.isMulti && calendar.sheetType != \'Month\'&& canEdit" draggable="false" class="slds-is-absolute" style="bottom: 0; left: calc(50% - 8px);cursor: ns-resize;" (mousedown)="onMouseDown($event)"><system-utility-icon colorclass="slds-icon-text-white" icon="threedots" size="x-small"></system-utility-icon></div></ng-container><ng-template #saving><system-spinner inverse="true" style="opacity: 0.5;"></system-spinner></ng-template></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.configurationService,calendar,services_1.model,services_1.view,services_1.broadcast,core_1.ChangeDetectorRef,services_1.userpreferences,services_1.metadata,core_1.ElementRef,core_1.Renderer2])],CalendarSheetEvent)}();exports.CalendarSheetEvent=CalendarSheetEvent;var CalendarMorePopover=function(){function CalendarMorePopover(e,t,s,n,r){this.metadata=e,this.calendar=t,this.language=s,this.renderer=n,this.cdr=r,this.events=[],this.popoverside="right",this.popoverpos="top",this.isMobileView=!1,this.sheetDay={},this.parentElementRef=null,this.self=null,this.hidePopoverTimeout={}}return Object.defineProperty(CalendarMorePopover.prototype,"eventStyle",{get:function(){return{height:this.calendar.multiEventHeight+"px",position:"initial",display:"block"}},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarMorePopover.prototype,"shortDate",{get:function(){return this.calendar.calendarDate.month(this.sheetDay.month).date(this.sheetDay.day).format("D MMM,")},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarMorePopover.prototype,"popoverStyle",{get:function(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};var e=this.parentElementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return e.left<t.width?this.popoverside="right":this.popoverside="left",e.top-30+t.height>window.innerHeight&&0<e.top-t.height+30?(this.popoverpos="bottom",{top:e.top-t.height+30+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-30+"px"}):(this.popoverpos="top",{top:e.top-30+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-30+"px"})},enumerable:!0,configurable:!0}),CalendarMorePopover.prototype.ngAfterViewInit=function(){this.cdr.detectChanges()},CalendarMorePopover.prototype.closePopover=function(e,t){var s=this;if(void 0===e&&(e=!1),e)if(t&&t.relatedTarget.classList.contains("slds-dropdown"))var n=this.renderer.listen(t.relatedTarget,"click",function(){n(),s.self.destroy()});else this.self.destroy();else this.hidePopoverTimeout=window.setTimeout(function(){return s.self.destroy()},500)},CalendarMorePopover.prototype.trackByFn=function(e,t){return t.id},CalendarMorePopover.prototype.onMouseOver=function(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)},CalendarMorePopover.prototype.onMouseOut=function(e){this.closePopover(!0,e)},CalendarMorePopover.prototype.getNubbinClass=function(){return("left"==this.popoverside?"slds-nubbin--right-":"slds-nubbin--left-")+this.popoverpos},__decorate([core_1.ViewChild("popover",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],CalendarMorePopover.prototype,"popover",void 0),CalendarMorePopover=__decorate([core_1.Component({template:'<div class="slds-popover slds-popover--panel slds-is-fixed" [ngStyle]="popoverStyle" [ngClass]="getNubbinClass()" role="dialog" (mouseenter)="onMouseOver()" (mouseleave)="onMouseOut($event)"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popover><div class="slds-popover__header" style="padding: .5rem"><header class="slds-text-heading--small slds-m-bottom--x-small">{{shortDate}} {{\'(\'+ events.length +\')\'}} {{language.getLabel(\'LBL_EVENTS\')}}</header><div class="slds-scrollable--y" style="height: 120px"><calendar-sheet-event *ngFor="let event of events; trackBy: trackByFn" [event]="event" [ngStyle]="eventStyle" class="spice-calendar-event"></calendar-sheet-event></div></div></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.metadata,calendar,services_1.language,core_1.Renderer2,core_1.ChangeDetectorRef])],CalendarMorePopover)}();exports.CalendarMorePopover=CalendarMorePopover;var CalendarMoreButton=function(){function e(e,t,s,n){this.elementRef=e,this.language=t,this.footer=s,this.metadata=n,this.events=[],this.isMobileView=!1,this.sheetDay={},this.popoverComponentRef=null,this.showPopoverTimeout={}}return e.prototype.ngOnDestroy=function(){this.popoverComponentRef&&this.popoverComponentRef.closePopover(!0)},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.renderPopover()},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverComponentRef&&this.popoverComponentRef.closePopover()},e.prototype.renderPopover=function(){var t=this;this.metadata.addComponent("CalendarMorePopover",this.footer.modalcontainer).subscribe(function(e){e.instance.events=t.events.slice().sort(function(e,t){return e.start.isAfter(t.start)?1:-1}),e.instance.isMobileView=t.isMobileView,e.instance.sheetDay=t.sheetDay,e.instance.parentElementRef=t.elementRef,t.popoverComponentRef=e.instance})},__decorate([core_1.Input("moreevents"),__metadata("design:type",Array)],e.prototype,"events",void 0),__decorate([core_1.Input("ismobileview"),__metadata("design:type",Boolean)],e.prototype,"isMobileView",void 0),__decorate([core_1.Input("sheetday"),__metadata("design:type",Object)],e.prototype,"sheetDay",void 0),__decorate([core_1.HostListener("mouseenter"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOver",null),__decorate([core_1.HostListener("mouseleave"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOut",null),e=__decorate([core_1.Component({selector:"calendar-more-button",template:"<span style=\"cursor: pointer\">{{language.getLabel('LBL_MORE')}}</span>"}),__metadata("design:paramtypes",[core_1.ElementRef,services_1.language,services_1.footer,services_1.metadata])],e)}();exports.CalendarMoreButton=CalendarMoreButton;var CalendarAddCalendar=function(){function CalendarAddCalendar(e,t){this.language=e,this.backend=t,this.calendars=[],this.addCalendar=new core_1.EventEmitter,this.self={}}return CalendarAddCalendar.prototype.getIcon=function(e){return e&&e.split(":")[1]?e.split(":")[1]:e},CalendarAddCalendar.prototype.getSprite=function(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"},CalendarAddCalendar.prototype.close=function(){this.addCalendar.emit(!1),this.self.destroy()},CalendarAddCalendar.prototype.save=function(e){this.addCalendar.emit(e),this.self.destroy()},CalendarAddCalendar.prototype.trackByFn=function(e,t){return t.id},CalendarAddCalendar=__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()">{{language.getLabel(\'LBL_ADD_CALENDAR\')}}</system-modal-header><system-modal-content><div class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let calendar of calendars; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="save(calendar)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [icon]="getIcon(calendar.icon)" [sprite]="getSprite(calendar.icon)" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate">{{language.getLabel(calendar.name)}}</h2></div></a></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()">{{language.getLabel(\'LBL_CANCEL\')}}</button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.backend])],CalendarAddCalendar)}();exports.CalendarAddCalendar=CalendarAddCalendar;var CalendarAddModulesModal=function(){function CalendarAddModulesModal(e,t){this.language=e,this.calendar=t,this.module$=new core_1.EventEmitter,this.self={}}return Object.defineProperty(CalendarAddModulesModal.prototype,"modules",{get:function(){return this.calendar.modules},enumerable:!0,configurable:!0}),CalendarAddModulesModal.prototype.close=function(){this.module$.emit(!1),this.self.destroy()},CalendarAddModulesModal.prototype.save=function(e){this.module$.emit(e),this.self.destroy()},CalendarAddModulesModal.prototype.trackByFn=function(e,t){return t.id},CalendarAddModulesModal=__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()">{{language.getLabel(\'LBL_MODULES\')}}</system-modal-header><system-modal-content><div class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let module of modules; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="save(module)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [module]="module.name" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate">{{language.getModuleName(module.name)}}</h2></div></a></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()">{{language.getLabel(\'LBL_CANCEL\')}}</button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,calendar])],CalendarAddModulesModal)}();exports.CalendarAddModulesModal=CalendarAddModulesModal;var CalendarOtherCalendarsMonitor=function(){function e(e,t,s,n){this.language=e,this.recent=t,this.calendar=s,this.fts=n,this.googleIsVisible$=new core_1.EventEmitter,this.searchterm="",this.searchopen=!1,this.resultsList=[],this.recentUsers=[],this.timeout=void 0,this.isLoading=!1,this.hovered="",this.otherCalendars=[],this.googleIsVisible=!0,this.getRecent()}return Object.defineProperty(e.prototype,"usersCalendars",{get:function(){return this.calendar.usersCalendars},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loggedByGoogle",{get:function(){return this.calendar.loggedByGoogle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.calendar.owner},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchOpen",{get:function(){return this.searchopen},set:function(e){(this.searchopen=e)&&this.getRecent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookupMenuStyle",{get:function(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchTerm",{get:function(){return this.searchterm},set:function(e){var t=this;clearTimeout(this.timeout),e&&0!=e.length&&(this.timeout=setTimeout(function(){t.searchterm=e,t.isLoading=!0,t.fts.searchByModules({searchterm:t.searchterm,modules:["Users"],size:5,sortparams:{sortfield:"full_name",sortdirection:"asc"}}).subscribe(function(e){t.filterResultsList(e.Users.hits.map(function(e){return e._source})),t.isLoading=!1},function(e){return t.isLoading=!1})},500))},enumerable:!0,configurable:!0}),e.prototype.getRecent=function(){var t=this;this.recent.getModuleRecent("Users").subscribe(function(e){return t.filterRecent(e)})},e.prototype.filterRecent=function(e){var t=this;this.recentUsers=e.filter(function(e){return e.item_id!=t.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.item_id})})},e.prototype.filterResultsList=function(e){var t=this;this.resultsList=e.filter(function(e){return e.id!=t.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.id})})},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.addUserCalendar=function(e,t){this.calendar.addUserCalendar(e,t),this.filterRecent(this.recentUsers),this.filterResultsList(this.resultsList)},e.prototype.removeUserCalendar=function(e){this.calendar.removeUserCalendar(e)},e.prototype.toggleVisible=function(e,t){switch(t){case"Users":this.calendar.toggleUserCalendarVisibility(e);break;case"Google":this.googleIsVisible=!this.googleIsVisible,this.googleIsVisible$.emit(this.googleIsVisible)}},e.prototype.setUserColor=function(e,t){this.calendar.setUserColor(e,t)},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"googleIsVisible$",void 0),__decorate([core_1.ViewChild("inputcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"inputContainer",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),e=__decorate([core_1.Component({selector:"calendar_other_calendars_monitor",template:'<div class="slds-border--bottom"><label class="slds-form-element__label slds-text-heading--small slds-p-horizontal--small">{{language.getLabel(\'LBL_OTHER_CALENDARS\')}}</label><div class="slds-p-vertical--xx-small"><div *ngIf="loggedByGoogle" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = \'google\'" (mouseleave)="hovered = \'\'" [ngClass]="hovered == \'google\' ? \'slds-theme--shade\' : \'\'"><div class="slds-grid" (click)="toggleVisible(null, \'Google\')" style="cursor: pointer"><img src="https://developers.google.com/identity/images/g-logo.png" style="height: 13px;width:13px;margin-right: 2px; margin-top: 2px" [ngStyle]="!googleIsVisible ? {\'-webkit-filter\': \'grayscale(1)\',\'filter\': \'grayscale(1)\'} : {}"> <a class="slds-text-body--regular slds-truncate" [style.color]="!googleIsVisible ? \'#dddbda\' : \'initial\'">{{language.getLabel(\'MY_GOOGLE_CALENDAR\')}}</a></div></div><div *ngFor="let usersCalendar of usersCalendars; trackBy: trackByFn" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = usersCalendar.id" (mouseleave)="hovered = \'\'" [class.slds-theme--shade]="hovered == usersCalendar.id"><div class="slds-grid" (click)="toggleVisible(usersCalendar.id, \'Users\')" style="cursor: pointer"><div class="slds-button slds-button--icon slds-m-right--xx-small slds-p-top--xxx-small" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'"><system-button-icon icon="user" size="small"></system-button-icon></div><a class="slds-text-body--regular slds-truncate" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'">{{usersCalendar.name}}</a></div><div><calendar-color-picker *ngIf="hovered == usersCalendar.id" (colorChange)="setUserColor(usersCalendar.id, $event)"></calendar-color-picker><button class="slds-button slds-button--icon" (click)="removeUserCalendar(usersCalendar.id)"><system-button-icon icon="clear" size="small"></system-button-icon></button></div></div></div></div><div class="slds-form-element__control slds-p-around--x-small slds-border--bottom slds-theme--default" style="height: 52px"><div #inputcontainer class="slds-form-element slds-lookup"><div class="slds-form-element__control slds-grid slds-box--border slds-m-vertical--xxx-small"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="searchTerm" (focus)="searchOpen = true" (blur)="searchOpen = false" [placeholder]="language.getLabel(\'LBL_ADD\') + \' \' + language.getLabel(\'LBL_USER\') + \' \' + language.getLabel(\'LBL_CALENDAR\')" role="combobox"></div></div></div><div *ngIf="searchOpen" class="slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none" [ngStyle]="lookupMenuStyle"><div *ngIf="searchTerm.length > 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom">{{resultsList.length}} {{language.getLabel(\'LBL_USERS\')}} {{language.getLabel(\'LBL_FOUND\')}}</div><div *ngIf="searchTerm.length == 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom">{{language.getLabel(\'LBL_RECENTLYVIEWED\')}}</div><ul class="slds-lookup__list" style="height: 175px" role="listbox"><ng-container *ngIf="searchTerm.length > 0"><li *ngFor="let user of resultsList; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.id, user.summary_text)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.summary_text}}</span></div></li></ng-container><ng-container *ngIf="searchTerm.length == 0"><li *ngFor="let user of recentUsers; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.item_id, user.item_summary)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.item_summary}}</span></div></li></ng-container></ul><system-spinner [size]="16" *ngIf="isLoading && resultsList.length == 0"></system-spinner></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.recent,calendar,services_1.fts])],e)}();exports.CalendarOtherCalendarsMonitor=CalendarOtherCalendarsMonitor;var CalendarColorPicker=function(){function e(e){this.language=e,this.colors=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"],this.colorChange=new core_1.EventEmitter,this.isOpen=!1}return e.prototype.pickColor=function(e){this.colorChange.emit("#"+e),this.isOpen=!1},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"colorChange",void 0),e=__decorate([core_1.Component({selector:"calendar-color-picker",template:'<div class="slds-dropdown-trigger slds-dropdown-trigger_click slds-m-right--x-small" [class.slds-is-open]="isOpen"><button class="slds-button slds-button--icon" aria-haspopup="true" (click)="isOpen = !isOpen"><system-button-icon icon="palette" size="small"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown_bottom"><div class="slds-color-picker slds-color-picker_swatches-only"><div class="slds-color-picker__selector"><ul class="slds-color-picker__swatches" role="menu"><li *ngFor="let color of colors" class="slds-color-picker__swatch" role="presentation"><a class="slds-color-picker__swatch-trigger slds-is-selected" role="menuitem" (click)="pickColor(color)"><span class="slds-swatch" [style.background-color]="\'#\' + color"><span class="slds-assistive-text">#{{color}}</span></span></a></li></ul></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.language])],e)}();exports.CalendarColorPicker=CalendarColorPicker;var CalendarScheduleDashlet=function(){function CalendarScheduleDashlet(e,t,s,n,r){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=r,this.scheduleUntilDate={},this.calendar.isDashlet=!0,this.calendar.sheetType="Schedule",this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}return Object.defineProperty(CalendarScheduleDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"contentStyle",{get:function(){return{height:this.headerContainer?"calc(100% - "+this.headerContainer.element.nativeElement.offsetHeight+"px)":"100px",width:"100%"}},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"title",{get:function(){return new moment(this.calendarDate).format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY")},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],CalendarScheduleDashlet.prototype,"headerContainer",void 0),CalendarScheduleDashlet=__decorate([core_1.Component({selector:"calendar-schedule-dashlet",template:'<div class="slds-height_full"><div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium slds-truncate">{{title}}</h2></div><div [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-schedule [setdate]="calendarDate" (untildate$)="scheduleUntilDate = $event"></calendar-sheet-schedule></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,calendar])],CalendarScheduleDashlet)}();exports.CalendarScheduleDashlet=CalendarScheduleDashlet;var CalendarDayDashlet=function(){function CalendarDayDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletLabel=null,this.calendar.isDashlet=!0,this.calendar.sheetType="Day",this.calendar.sheetHourHeight=50}return Object.defineProperty(CalendarDayDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarDayDashlet.prototype,"contentStyle",{get:function(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],CalendarDayDashlet.prototype,"calendarContent",void 0),CalendarDayDashlet=__decorate([core_1.Component({selector:"calendar-day-dashlet",template:'<div class="slds-height_full"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium">{{language.getLabel(dashletLabel)}}</h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-day [setdate]="calendarDate"></calendar-sheet-day></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,core_1.ElementRef,calendar])],CalendarDayDashlet)}();exports.CalendarDayDashlet=CalendarDayDashlet;var CalendarThreeDaysDashlet=function(){function CalendarThreeDaysDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.titleUntilDate={},this.dashletLabel=null,this.calendar.isDashlet=!0,this.calendar.sheetType="Three_Days",this.calendar.sheetHourHeight=50,this.titleUntilDate=moment(this.calendar.calendarDate).add(2,"d")}return Object.defineProperty(CalendarThreeDaysDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarThreeDaysDashlet.prototype,"contentStyle",{get:function(){return{height:(this.calendarContent?this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop:100)+"px"}},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],CalendarThreeDaysDashlet.prototype,"calendarContent",void 0),CalendarThreeDaysDashlet=__decorate([core_1.Component({selector:"calendar-three-days-dashlet",template:'<div class="slds-height_full"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium">{{language.getLabel(dashletLabel)}}</h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-three-days [setdate]="calendarDate"></calendar-sheet-three-days></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,core_1.ElementRef,calendar])],CalendarThreeDaysDashlet)}();exports.CalendarThreeDaysDashlet=CalendarThreeDaysDashlet;var ModuleCalendar=function(){function ModuleCalendar(e){this.vms=e,this.version="1.0",this.build_date="2020-03-03",this.vms.registerModule(this)}return ModuleCalendar=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule,drag_drop_1.DragDropModule],declarations:[Calendar,CalendarHeader,CalendarSheetDay,CalendarSheetThreeDays,CalendarSheetWeek,CalendarSheetMonth,CalendarSheetSchedule,CalendarSheetEvent,CalendarSheetDropTarget,CalendarMorePopover,CalendarMoreButton,CalendarAddCalendar,CalendarAddModulesModal,CalendarOtherCalendarsMonitor,CalendarColorPicker,CalendarScheduleDashlet,CalendarDayDashlet,CalendarThreeDaysDashlet],providers:[services_1.userpreferences]}),__metadata("design:paramtypes",[services_1.VersionManagerService])],ModuleCalendar)}();exports.ModuleCalendar=ModuleCalendar;