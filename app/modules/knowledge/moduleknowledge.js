/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.01.001
 * date: 2021-04-05 20:18:39
 * build: 2021.01.001.1617646719045
 **/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;0<=l;l--)(n=e[l])&&(a=(i<3?n(a):3<i?n(t,s,a):n(t,s))||a);return 3<i&&a&&Object.defineProperty(t,s,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=arguments[t].length;for(var o=Array(e),n=0,t=0;t<s;t++)for(var i=arguments[t],a=0,l=i.length;a<l;a++,n++)o[n]=i[a];return o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleKnowledge=exports.KnowledgeReleaseAllButton=exports.KnowledgeContainer=exports.KnowledgeManager=exports.KnowledgeManagerAddModal=exports.KnowledgeManagerDetails=exports.KnowledgeBrowser=exports.KnowledgeBrowserDetails=exports.KnowledgeBrowserDetailsContainerLeft=exports.KnowledgeBrowserDetailsContainerRight=exports.KnowledgeDocumentFavorites=exports.KnowledgeDocumentRelatedList=exports.KnowledgeDocumentsSearch=exports.KnowledgeBookSelector=exports.KnowledgeService=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),addcomponents_module_1=require("../../addcomponents/addcomponents.module"),services_1=require("../../services/services"),operators_1=require("rxjs/operators"),rxjs_1=require("rxjs"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),KnowledgeService=function(){function e(e,t,s,o,n,i,a,l,r,d,c,u){this.backend=e,this.language=t,this.broadcast=s,this.modelutilities=o,this.navigation=n,this.userPreferences=i,this.location=a,this.activatedRoute=l,this.toast=r,this.metadata=d,this.navigationtab=c,this.fts=u,this.selectedDoc="",this.isBookLoading=!1,this.isDocumentLoading=!1,this.books=[],this.searchterm="",this.moduleFilter="",this.resultsList=[],this.documentsList=[],this.subscriptions=new rxjs_1.Subscription,this.loadPreferences(),this.saveSubscriber(),this.routerSubscriber()}return Object.defineProperty(e.prototype,"documents",{get:function(){return this.sortDocuments(this.documentsList)},set:function(e){this.documentsList=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchTerm",{get:function(){return this.searchterm},set:function(e){var t,s=this;this.searchterm=e,this.resultsList=[],""!=e&&(t="KnowledgeDocuments",this.isDocumentLoading=!0,this.fts.searchByModules({searchterm:this.searchterm,modules:[t],size:5,sortparams:{sortfield:"name",sortdirection:"ASC"}}).subscribe(function(e){s.resultsList=e[t].hits.map(function(e){return e._source}).sort(function(e,t){return e.name-t.name}),s.isDocumentLoading=!1}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedBook",{get:function(){return this.selectedbook},set:function(e){this.selectedbook=e,this.getDocuments(e)},enumerable:!1,configurable:!0}),e.prototype.setActiveModule=function(e){this.navigation.setActiveModule(e)},e.prototype.setLastViewedBook=function(e){e=!(e=void 0===e?!1:e)&&this.selectedBook?this.selectedBook:null;this.userPreferences.setPreference("lastViewedBook",e,!0,"KnowledgeBooks")},e.prototype.replaceState=function(e){this.location.replaceState(e)},e.prototype.getBooks=function(){var t=this;this.isBookLoading=!0,this.backend.getList("KnowledgeBooks",[{sortfield:"name",sortdirection:"DESC"}],["name","id","html"],{limit:-1}).subscribe(function(e){t.books=e&&e.list?e.list:[],t.isBookLoading=!1})},e.prototype.getDocuments=function(e){var t,s=this;e&&e.id&&(this.isDocumentLoading=!0,!(this.documentsList=[])!==this.metadata.checkModuleAcl("KnowledgeDocuments","list")&&(t={limit:-1,modulefilter:this.moduleFilter,sort:{sortfield:"name",sortdirection:"ASC"}},this.backend.getRequest("module/KnowledgeBooks/"+e.id+"/related/knowledgedocuments",t).subscribe(function(e){s.documents=0<s.moduleFilter.length?_.toArray(e):_.toArray(e).map(function(e){return{id:e.id,parent_id:e.parent_id,parent_sequence:e.parent_sequence,name:e.name+" ("+e.status+")"}}),s.isDocumentLoading=!1})))},e.prototype.loadPreferences=function(){var t=this;this.userPreferences.loadPreferences("KnowledgeBooks").pipe(operators_1.take(1)).subscribe(function(e){e&&e.lastViewedBook&&!t.selectedBook&&(t.selectedBook=e.lastViewedBook)})},e.prototype.saveSubscriber=function(){var s=this,e=this.broadcast.message$.subscribe(function(t){if("model.save"==t.messagetype)switch(t.messagedata.module){case"KnowledgeBooks":var e=t.messagedata.data;s.books=__spreadArrays(s.books,[e]),s.selectedBook=e;break;case"KnowledgeDocuments":s.documents.some(function(e){if(e.id==t.messagedata.id)return e.parent_id=t.messagedata.data.parent_id,e.parent_sequence=t.messagedata.data.parent_sequence,e.name=0<s.moduleFilter.length?e.name:t.messagedata.data.name+" ("+t.messagedata.data.status+")",!0})?s.documents=s.documentsList.slice():(e={id:t.messagedata.data.id,parent_id:t.messagedata.data.parent_id,parent_sequence:t.messagedata.data.parent_sequence,name:0<s.moduleFilter.length?t.messagedata.data.name:t.messagedata.data.name+" ("+t.messagedata.data.status+")"},s.documents=__spreadArrays(s.documentsList,[e]))}"model.delete"==t.messagetype&&"KnowledgeDocuments"==t.messagedata.module&&(s.documents=s.documents.filter(function(e){return e.id!=t.messagedata.id}),s.selectedDoc="",s.replaceState("/module/KnowledgeDocuments"))});this.subscriptions.add(e)},e.prototype.sortDocuments=function(e){return e.sort(function(e,t){return+e.parent_sequence!=+t.parent_sequence?+e.parent_sequence>+t.parent_sequence?1:-1:e.name>t.name?1:-1})},e.prototype.routerSubscriber=function(){var s=this,e=this.navigationtab.activeRoute$.subscribe(function(e){var t=e.params;t.module&&t.id&&s.backend.get(t.module,t.id).subscribe(function(e){if(e)switch(t.module){case"KnowledgeBooks":s.selectedBook=e;break;case"KnowledgeDocuments":s.selectedDoc=e.id,s.selectedBook={id:e.knowledgebook_id,name:e.knowledgebook_name}}})});this.subscriptions.add(e)},__decorate([core_1.ViewChild("searchcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"searchContainer",void 0),__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.language,services_1.broadcast,services_1.modelutilities,services_1.navigation,services_1.userpreferences,common_1.Location,router_1.ActivatedRoute,services_1.toast,services_1.metadata,services_1.navigationtab,services_1.fts])],e)}();exports.KnowledgeService=KnowledgeService;var KnowledgeBookSelector=function(){function e(e,t,s,o,n,i,a){this.language=e,this.model=t,this.modal=s,this.metadata=o,this.knowledgeService=n,this.navigation=i,this.backend=a,this.searchTerm="",this.searchOpen=!1,this.editable=!0,this.model.module="KnowledgeBooks",this.knowledgeService.getBooks()}return Object.defineProperty(e.prototype,"placeHolder",{get:function(){return this.isLoading||0!=this.books.length?this.language.getLabel("MSG_SEARCH_BOOKS"):this.language.getLabel("LBL_NO_ENTRIES")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this.knowledgeService.isBookLoading},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"books",{get:function(){return this.knowledgeService.books},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchResults",{get:function(){for(var e=[],t=0,s=this.books;t<s.length;t++){var o=s[t];""!=this.searchTerm&&o.name.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.push(o)}return 0==e.length?this.books.slice():e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookupMenuStyle",{get:function(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}},enumerable:!1,configurable:!0}),e.prototype.editBook=function(e){this.model.id=e,this.model.edit(!0),this.searchOpen=!1},e.prototype.deleteBook=function(t){var s=this;this.model.id=t,this.modal.confirm(this.language.getLabel("MSG_DELETE_RECORD"),this.language.getLabel("LBL_DELETE")).subscribe(function(e){e&&s.model.delete().subscribe(function(e){s.deselectBook(),s.knowledgeService.books=s.knowledgeService.books.filter(function(e){return e.id!=t})})})},e.prototype.selectBook=function(e){this.knowledgeService.selectedBook=e,this.knowledgeService.setLastViewedBook(),this.searchOpen=!1},e.prototype.deselectBook=function(){this.knowledgeService.selectedBook=void 0,this.knowledgeService.selectedDoc="",this.knowledgeService.documents=[],this.knowledgeService.setLastViewedBook(!0)},e.prototype.trackByFn=function(e,t){return t.id},__decorate([core_1.ViewChild("inputcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"inputContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"editable",void 0),__decorate([core_1.Component({selector:"knowledge-book-selector",template:'<div class="slds-form-element__control slds-p-around--x-small slds-border--bottom" style="height: 52px"><div #inputcontainer class="slds-form-element slds-lookup"><div *ngIf="selectedBook" class="slds-form-element__control slds-p-around--xxx-small"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon module="KnowledgeBooks" [size]="\'small\'" [addclasses]="\'slds-p-around--xxx-small\'"></system-icon></span> <span class="slds-pill__label slds-p-left--xx-small">{{selectedBook.name}}</span> <span><button *ngIf="editable" class="slds-button slds-button--icon" (click)="editBook(selectedBook.id)"><system-button-icon icon="edit"></system-button-icon></button> <button *ngIf="editable" class="slds-button slds-button--icon" (click)="deleteBook(selectedBook.id)"><system-button-icon icon="delete"></system-button-icon></button> <button class="slds-button slds-button--icon slds-pill__remove" (click)="deselectBook()"><system-button-icon icon="close"></system-button-icon></button></span></span></div></div><div *ngIf="!selectedBook" class="slds-form-element__control slds-m-vertical--xxx-small"><div class="slds-input-has-icon slds-input-has-icon--right"><system-utility-icon *ngIf="!isLoading" icon="search" addclasses="slds-input__icon"></system-utility-icon><system-spinner *ngIf="isLoading" class="slds-input__icon" size="16"></system-spinner><input type="search" class="slds-lookup__search-input slds-input" [(ngModel)]="searchTerm" (focus)="searchOpen = true" (blur)="searchOpen = false" [placeholder]="placeHolder" role="combobox" [disabled]="isLoading || books.length == 0"></div></div></div><div *ngIf="searchOpen && searchResults.length > 0" class="slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none" [ngStyle]="lookupMenuStyle"><div class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-border--bottom">{{searchResults.length}} <system-label label="MSG_BOOKS_FOUND"></system-label></div><ul class="slds-lookup__list spice-scrollbar-thin" style="height: 175px" role="listbox"><li *ngFor="let book of searchResults; trackBy: trackByFn" role="presentation" (mousedown)="selectBook(book)"><div class="slds-lookup__item-action slds-media" role="option"><span class="slds-lookup__result-text">{{book.name}}</span></div></li></ul><system-spinner [size]="16" *ngIf="isLoading && !selectedBook"></system-spinner></div></div>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.metadata,KnowledgeService,services_1.navigation,services_1.backend])],e)}();exports.KnowledgeBookSelector=KnowledgeBookSelector;var KnowledgeDocumentsSearch=function(){function e(e,t,s,o,n,i){this.language=e,this.model=t,this.metadata=s,this.knowledgeService=o,this.navigation=n,this.backend=i,this.isLoading=!1,this.interval=void 0}return Object.defineProperty(e.prototype,"resultsList",{get:function(){return this.knowledgeService.resultsList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchTerm",{get:function(){return this.knowledgeService.searchterm},set:function(e){var t=this;clearTimeout(this.interval),this.interval=setTimeout(function(){return t.knowledgeService.searchTerm=e},500)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resultsMenuStyle",{get:function(){if(this.inputContainer)return{height:"calc(98vh - "+this.inputContainer.element.nativeElement.getBoundingClientRect().bottom+"px)"}},enumerable:!1,configurable:!0}),e.prototype.clearSearch=function(){this.knowledgeService.searchTerm="",this.knowledgeService.resultsList=[]},e.prototype.selectDocument=function(e){this.knowledgeService.selectedDoc=e.id,this.knowledgeService.selectedBook={id:e.knowledgebook_id,name:e.knowledgebook_name}},e.prototype.trackByFn=function(e,t){return t.id},__decorate([core_1.ViewChild("inputcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"inputContainer",void 0),__decorate([core_1.Component({selector:"knowledge-documents-search",template:'<div class="slds-form-element__control slds-border--bottom"><div #inputcontainer class="slds-form-element"><div class="slds-form-element__control slds-grid slds-p-around--x-small"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon *ngIf="searchTerm.length == 0" icon="search" [addclasses]="\'slds-input__icon\'"></system-utility-icon><button *ngIf="searchTerm.length > 0" class="slds-input__icon slds-input__icon--right slds-button slds-button--icon" (click)="clearSearch()"><system-button-icon [icon]="\'close\'"></system-button-icon></button> <input type="search" class="slds-input" [(ngModel)]="searchTerm" [placeholder]="language.getLabel(\'MSG_SEARCH_DOCUMENTS\')" role="combobox"></div></div></div><div class="slds-p-vertical--none slds-scrollable--y spice-scrollbar-thin" [ngStyle]="resultsMenuStyle"><div *ngIf="searchTerm != \'\'" class="slds-theme--shade slds-p-vertical--xx-small slds-p-horizontal--small slds-text-body--small slds-border--bottom">{{resultsList.length}} <system-label label="MSG_DOCUMENTS_FOUND"></system-label></div><table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table--fixed-layout"><thead><tr class="slds-line-height_reset"><th class="slds-text-title_caps" scope="col"><div class="slds-truncate" title="Account Name"><system-label label="LBL_NAME"></system-label></div></th><th class="slds-text-title_caps" scope="col"><div class="slds-truncate" title="Account Name"><system-label label="LBL_STATUS"></system-label></div></th></tr></thead><tbody><tr *ngFor="let document of resultsList; trackBy: trackByFn" class="slds-hint-parent"><td scope="row"><div class="slds-truncate" [title]="document.name"><a style="cursor: pointer" (click)="selectDocument(document)" tabindex="-1">{{document.name}}</a></div></td><td scope="row"><div class="slds-truncate" [title]="document.status"><a style="cursor: pointer" (click)="selectDocument(document)" tabindex="-1">{{document.status}}</a></div></td></tr></tbody></table><system-spinner *ngIf="isLoading"></system-spinner></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.metadata,KnowledgeService,services_1.navigation,services_1.backend])],e)}();exports.KnowledgeDocumentsSearch=KnowledgeDocumentsSearch;var KnowledgeDocumentRelatedList=function(){function KnowledgeDocumentRelatedList(e,t,s,o,n,i,a,l){var r=this;this.language=e,this.metadata=t,this.relatedmodels=s,this.knowledgeService=o,this.location=n,this.router=i,this.model=a,this.modal=l,this.componentconfig={},this.subscription=new rxjs_1.Subscription,this.relatedmodels.module="KnowledgeDocuments",this.relatedmodels.relatedModule="KnowledgeDocuments",this.subscription=this.model.data$.subscribe(function(e){e.id&&""!=e.id&&(r.relatedmodels.id=e.id,r.relatedmodels.sortfield="name")})}return Object.defineProperty(KnowledgeDocumentRelatedList.prototype,"panelTitle",{get:function(){return this.componentconfig.title||"Related Documents"},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeDocumentRelatedList.prototype,"canEdit",{get:function(){return 1==this.componentconfig.editable&&this.model.checkAccess("edit")},enumerable:!1,configurable:!0}),KnowledgeDocumentRelatedList.prototype.ngOnInit=function(){this.componentconfig.items&&(this.relatedmodels.loaditems=this.componentconfig.items),this.componentconfig.link&&(this.relatedmodels.linkName=this.componentconfig.link)},KnowledgeDocumentRelatedList.prototype.ngOnDestroy=function(){this.relatedmodels.stopSubscriptions(),this.subscription.unsubscribe()},KnowledgeDocumentRelatedList.prototype.openSelectModal=function(){var t=this;this.canEdit&&this.modal.openModal("ObjectModalModuleLookup").subscribe(function(e){e.instance.module=t.model.module,e.instance.multiselect=!0,e.instance.selectedItems.subscribe(function(e){return t.relatedmodels.addItems(e)})})},KnowledgeDocumentRelatedList.prototype.navigateTo=function(e){this.knowledgeService.selectedDoc=e,this.location.replaceState("/module/KnowledgeDocuments/"+e)},KnowledgeDocumentRelatedList.prototype.trackByFn=function(e,t){return t.id},__decorate([core_1.Component({selector:"Knowledge-document-related-list",template:'<system-collapsable-tab [title]="panelTitle"><div class="slds-grid slds-scrollable--y" style="max-height: 200px"><table class="slds-table slds-table--fixed-layout"><thead><tr><th><div class="slds-truncate"><system-label label="LBL_NAME"></system-label></div></th><th><div class="slds-truncate"><system-label label="LBL_STATUS"></system-label></div></th><th class="slds-cell-shrink"><div *ngIf="canEdit"><button class="slds-button slds-button--icon-border-filled slds-button--icon-x-small" [title]="language.getLabel(\'LBL_SELECT\')" (click)="openSelectModal()"><system-button-icon icon="add"></system-button-icon></button></div></th></tr></thead><tbody><tr *ngFor="let relateditem of relatedmodels.items; trackBy: trackByFn" (click)="navigateTo(relateditem.id)"><td [title]="relateditem.name"><div class="slds-text-link slds-truncate" style="cursor: pointer">{{relateditem.name}}</div></td><td [title]="relateditem.status"><div class="slds-text-link slds-truncate" style="cursor: pointer">{{relateditem.status}}</div></td><td class="slds-cell-shrink"></td></tr></tbody><tbody system-table-stencils *ngIf="relatedmodels.isloading" columns="3" rows="3"></tbody></table></div><div *ngIf="!relatedmodels.isloading && relatedmodels.items.length == 0" class="slds-align--absolute-center slds-text-body--regular slds-p-around--x-small"><system-label label="MSG_NO_RECORDS_FOUND"></system-label></div></system-collapsable-tab>',providers:[services_1.relatedmodels]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.relatedmodels,KnowledgeService,common_1.Location,router_1.Router,services_1.model,services_1.modal])],KnowledgeDocumentRelatedList)}();exports.KnowledgeDocumentRelatedList=KnowledgeDocumentRelatedList;var KnowledgeDocumentFavorites=function(){function KnowledgeDocumentFavorites(e,t,s,o,n){this.language=e,this.router=t,this.favorite=s,this.location=o,this.knowledgeService=n}return Object.defineProperty(KnowledgeDocumentFavorites.prototype,"favorites",{get:function(){return this.favorite.getFavorites("KnowledgeDocuments")},enumerable:!1,configurable:!0}),KnowledgeDocumentFavorites.prototype.navigateTo=function(e){this.knowledgeService.selectedDoc=e,this.location.replaceState("/module/KnowledgeDocuments/"+e)},KnowledgeDocumentFavorites.prototype.trackByFn=function(e,t){return t.item_id},__decorate([core_1.Component({selector:"Knowledge-document-favorites",template:'<system-collapsable-tab title="LBL_FAVORITES"><ul class="slds-scrollable--y spice-scrollbar" style="max-height: 200px"><li *ngFor="let favorite of favorites; trackBy: trackByFn" [title]="favorite.item_summary" class="slds-m-around--xx-small"><a style="cursor: pointer" (click)="navigateTo(favorite.item_id)">{{favorite.item_summary}}</a></li></ul><system-spinner *ngIf="favorites.isloading"></system-spinner><div *ngIf="favorites.length == 0" class="slds-align--absolute-center slds-text-body--regular slds-p-around--x-small"><system-label label="MSG_NO_RECORDS_FOUND"></system-label></div></system-collapsable-tab>'}),__metadata("design:paramtypes",[services_1.language,router_1.Router,services_1.favorite,common_1.Location,KnowledgeService])],KnowledgeDocumentFavorites)}();exports.KnowledgeDocumentFavorites=KnowledgeDocumentFavorites;var KnowledgeBrowserDetailsContainerRight=function(){function KnowledgeBrowserDetailsContainerRight(e,t){this.language=e,this.metadata=t,this.componentconfig={},this.docId="",this.renderedComponents=[]}return KnowledgeBrowserDetailsContainerRight.prototype.ngOnInit=function(){this.renderView()},KnowledgeBrowserDetailsContainerRight.prototype.ngOnDestroy=function(){this.resetView()},KnowledgeBrowserDetailsContainerRight.prototype.renderView=function(){var s=this,e=this.metadata.getComponentConfig("KnowledgeBrowserDetailsContainerRight","KnowledgeDocuments").componentset;if(e)for(var e=this.metadata.getComponentSetObjects(e),o=this,t=0,n=e;t<n.length;t++)!function(t){o.metadata.addComponent(t.component,o.itemsContainer).subscribe(function(e){s.renderedComponents.push(e),e.instance.componentconfig=t.componentconfig})}(n[t])},KnowledgeBrowserDetailsContainerRight.prototype.resetView=function(){this.renderedComponents.forEach(function(e){return e.destroy()}),this.renderedComponents=[]},__decorate([core_1.ViewChild("itemscontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeBrowserDetailsContainerRight.prototype,"itemsContainer",void 0),__decorate([core_1.Input("selectedDoc"),__metadata("design:type",String)],KnowledgeBrowserDetailsContainerRight.prototype,"docId",void 0),__decorate([core_1.Component({selector:"knowledge-browser-details-container-right",template:'<div class="slds-scrollable--y spice-scrollbar slds-height_full slds-p-around--small"><div #itemscontainer></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata])],KnowledgeBrowserDetailsContainerRight)}();exports.KnowledgeBrowserDetailsContainerRight=KnowledgeBrowserDetailsContainerRight;var KnowledgeBrowserDetailsContainerLeft=function(){function e(e,t,s,o,n,i){this.language=e,this.model=t,this.modal=s,this.sanitizer=o,this.viewContainerRef=n,this.knowledgeService=i,this.breadcrumbs=[],this.html="",this.height="100%"}return Object.defineProperty(e.prototype,"iframeContainerStyle",{get:function(){return this.headerContainer?{height:"calc(100vh - "+this.headerContainer.element.nativeElement.getBoundingClientRect().bottom+"px)",width:"100%"}:{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasContent",{get:function(){return this.model.data.description&&0<this.model.data.description.length},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(e){e.html&&this.html&&this.setHtmlValue()},e.prototype.setHtmlValue=function(){for(var e=/<code>[\s\S]*?<\/code>/g,t=e.exec(this.html);null!=t;)this.html=this.html.replace(t,this.encodeHtml(t)).replace("&lt;code&gt;","<code>").replace("&lt;/code&gt;","</code>"),t=e.exec(this.html);this.html=this.sanitizer.bypassSecurityTrustHtml(this.html)},e.prototype.encodeHtml=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.prototype.navigateTo=function(e){this.knowledgeService.selectedDoc=e},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.print=function(){this.modal.openModal("ObjectActionOutputBeanModal",!0,this.viewContainerRef.injector)},__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"headerContainer",void 0),__decorate([core_1.Input("breadcrumbs"),__metadata("design:type",Array)],e.prototype,"breadcrumbs",void 0),__decorate([core_1.Input("html"),__metadata("design:type",Object)],e.prototype,"html",void 0),__decorate([core_1.HostBinding("style"),__metadata("design:type",String)],e.prototype,"height",void 0),__decorate([core_1.Component({selector:"knowledge-browser-details-container-left",template:'<div #headercontainer *ngIf="model.id" class="slds-grid slds-grid--vertical-align-center slds-border--bottom" style="border-radius: 0; height: 52px"><nav role="navigation" aria-label="Breadcrumbs" class="slds-grid slds-grid_vertical-align-center slds-p-around--x-small"><ol class="slds-breadcrumb slds-list_horizontal slds-wrap"><li *ngFor="let breadcrumb of breadcrumbs; trackBy: trackByFn" class="slds-breadcrumb__item slds-text-title--caps"><a style="cursor: pointer" (click)="navigateTo(breadcrumb.id)">{{breadcrumb.name}}</a></li><li class="slds-breadcrumb__item slds-text-title--caps"><a style="cursor: pointer"><strong>{{model.data.name}}</strong></a></li></ol></nav><div *ngIf="hasContent" class="slds-col_bump-left"><button class="slds-button slds-button--icon slds-m-right--xx-small" (click)="print()"><system-custom-icon size="x-small" icon="print"></system-custom-icon></button></div></div><div *ngIf="model.id && hasContent" class="slds-grid" style="height: calc(100% - 52px)"><div [innerHTML]="html" style="height: 100%; width: 100%;" class="slds-scrollable--y spice-scrollbar slds-p-around--x-small slds-theme--default slds-rich-text-editor__output"></div></div><div *ngIf="model.isLoading" class="slds-align--absolute-center" [ngStyle]="iframeContainerStyle"><system-spinner></system-spinner></div><div *ngIf="!model.isLoading && !hasContent" class="slds-align--absolute-center slds-text-heading--medium" [ngStyle]="iframeContainerStyle"><span><system-label label="MSG_NO_RECORDS_FOUND"></system-label></span></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,platform_browser_1.DomSanitizer,core_1.ViewContainerRef,KnowledgeService])],e)}();exports.KnowledgeBrowserDetailsContainerLeft=KnowledgeBrowserDetailsContainerLeft;var KnowledgeBrowserDetails=function(){function e(e,t,s,o){this.language=e,this.favorite=t,this.knowledgeService=s,this.model=o,this.docId="",this.inAddModal=!1,this._breadcrumbs=[],this.model.module="KnowledgeDocuments"}return Object.defineProperty(e.prototype,"containerLeftClass",{get:function(){return this.inAddModal?"slds-size--1-of-1":"slds-size--2-of-3"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"breadcrumbs",{get:function(){return this._breadcrumbs},set:function(e){this._breadcrumbs=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detailsContainerStyle",{get:function(){if(!this.detailsContainer)return{};var e=this.detailsContainer.element.nativeElement;return this.footerContainer&&this.inAddModal?{height:this.footerContainer.parentElement.offsetTop-e.offsetTop+"px"}:{height:"calc(100vh - "+e.offsetTop+"px)"}},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(){var t=this;this.rightPanelContainer&&this.rightPanelContainer.resetView(),this.docId&&0<this.docId.length&&(this.model.id=this.docId,this.rightPanelContainer&&this.rightPanelContainer.renderView(),this.breadcrumbs=[],this.model.getData(!0,"",!0).subscribe(function(e){e.breadcrumbs&&0<e.breadcrumbs.length&&(t.breadcrumbs=e.breadcrumbs)}))},__decorate([core_1.ViewChild("detailscontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"detailsContainer",void 0),__decorate([core_1.ViewChild(KnowledgeBrowserDetailsContainerRight,{static:!0}),__metadata("design:type",Object)],e.prototype,"rightPanelContainer",void 0),__decorate([core_1.Input("selectedDoc"),__metadata("design:type",String)],e.prototype,"docId",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"inAddModal",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"footerContainer",void 0),__decorate([core_1.Component({selector:"knowledge-browser-details",template:'<div #detailscontainer class="slds-grid" [ngStyle]="detailsContainerStyle"><div *ngIf="docId && docId != \'\'" [ngClass]="containerLeftClass" style="height: 100%"><knowledge-browser-details-container-left [html]="model?.data?.description" [breadcrumbs]="breadcrumbs"></knowledge-browser-details-container-left></div><div *ngIf="docId && docId != \'\' && !inAddModal" class="slds-size--1-of-3 slds-theme--default slds-border--left"><knowledge-browser-details-container-right [selectedDoc]="docId"></knowledge-browser-details-container-right></div><div *ngIf="!selectedBook && docId == \'\'" class="slds-align--absolute-center slds-p-vertical--medium slds-height_full slds-text-heading--medium"><span><system-label label="LBL_MAKE_SELECTION"></system-label></span></div><div *ngIf="selectedBook && docId == \'\'" style="width: 100%"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-text-title--caps slds-p-around--x-small" style="border-radius: 0; height: 52px"><strong><system-label label="LBL_BOOK_DESCRIPTION"></system-label></strong></div><div class="slds-p-around--x-small"><div *ngIf="selectedBook?.html?.length > 0" [innerHTML]="selectedBook?.html"></div><div *ngIf="selectedBook?.html?.length == 0"><system-label label="LBL_NO_DESCRIPTION_FOUND"></system-label></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.favorite,KnowledgeService,services_1.model])],e)}();exports.KnowledgeBrowserDetails=KnowledgeBrowserDetails;var KnowledgeBrowser=function(){function KnowledgeBrowser(e,t,s,o,n){this.language=e,this.model=t,this.metadata=s,this.navigationTab=o,this.knowledgeService=n,this.activeTab="tree",this.subscription=new rxjs_1.Subscription,this.model.module="KnowledgeDocuments",this.loadReleasedFilter()}return Object.defineProperty(KnowledgeBrowser.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeBrowser.prototype,"documents",{get:function(){return this.knowledgeService.documents},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeBrowser.prototype,"selectedDoc",{get:function(){return this.knowledgeService.selectedDoc},set:function(e){this.knowledgeService.selectedDoc=e,this.knowledgeService.replaceState("/module/KnowledgeDocuments/"+e)},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeBrowser.prototype,"treeContainerStyle",{get:function(){return this.tabsHeaderContainer?{height:"calc(100vh - "+this.tabsHeaderContainer.element.nativeElement.getBoundingClientRect().bottom+"px)"}:{}},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeBrowser.prototype,"isLoading",{get:function(){return this.knowledgeService.isDocumentLoading},enumerable:!1,configurable:!0}),KnowledgeBrowser.prototype.loadReleasedFilter=function(){var e=this.metadata.getComponentConfig("KnowledgeBrowser",this.model.module);this.knowledgeService.moduleFilter=e.modulefilter||""},KnowledgeBrowser.prototype.ngAfterViewInit=function(){this.knowledgeService.setActiveModule("KnowledgeBooks"),"KnowledgeBrowser"==this.navigationTab.activeRoute.path&&this.navigationTab.setTabInfo({displayname:"Knowledge Browser",displayicon:"knowledge_base"})},KnowledgeBrowser.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},__decorate([core_1.ViewChild("maincontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeBrowser.prototype,"maincontainer",void 0),__decorate([core_1.ViewChild("tabsheadercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeBrowser.prototype,"tabsHeaderContainer",void 0),__decorate([core_1.Component({selector:"knowledge-browser",template:'<div #maincontainer class="slds-grid"><div class="slds-size--1-of-4 slds-border--right"><knowledge-book-selector></knowledge-book-selector><div class="slds-tabs--default"><ul #tabsheadercontainer class="slds-tabs--default__nav" role="tablist"><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'tree\'}" role="presentation" (click)="activeTab = \'tree\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_CHAPTERS"></system-label></a></li><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'search\'}" role="presentation" (click)="activeTab = \'search\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_SEARCH"></system-label></a></li></ul><div *ngIf="activeTab == \'tree\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="background-color: #fafaf9"><div [ngStyle]="treeContainerStyle" class="slds-scrollable--y spice-scrollbar"><system-tree *ngIf="selectedBook && documents.length > 0 && !isLoading" [sourceList]="documents" [(selectedItem)]="selectedDoc"></system-tree><div *ngIf="isLoading && selectedBook" class="slds-m-top--small"><system-spinner></system-spinner></div><div *ngIf="selectedBook && documents.length == 0 && !isLoading" class="slds-align--absolute-center slds-height_full slds-text-heading--medium"><span><system-label label="MSG_NO_RECORDS_FOUND"></system-label></span></div></div></div><div *ngIf="activeTab == \'search\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="background-color: #fafaf9"><knowledge-documents-search></knowledge-documents-search></div></div></div><div class="slds-size--3-of-4"><knowledge-browser-details [selectedDoc]="selectedDoc"></knowledge-browser-details></div></div>',providers:[KnowledgeService,services_1.model]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.metadata,services_1.navigationtab,KnowledgeService])],KnowledgeBrowser)}();exports.KnowledgeBrowser=KnowledgeBrowser;var KnowledgeManagerDetails=function(){function e(e,t,s,o,n){this.language=e,this.model=t,this.view=s,this.knowledgeService=o,this.metadata=n,this.docId="",this.renderedComponents=[],this.model.module="KnowledgeDocuments"}return Object.defineProperty(e.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),e.prototype.ngOnChanges=function(){var t=this;this.resetView(),this.docId&&""!==this.docId&&(this.view.setViewMode(),this.model.id=this.docId,this.model.getData(!0,"",!0).subscribe(function(e){return t.renderView()}))},e.prototype.ngOnDestroy=function(){this.resetView()},e.prototype.resetView=function(){for(var e=0,t=this.renderedComponents;e<t.length;e++)t[e].destroy();this.renderedComponents=[]},e.prototype.renderView=function(){var s=this,e=this.metadata.getComponentConfig("KnowledgeManagerDetails","KnowledgeDocuments").componentset;if(e)for(var e=this.metadata.getComponentSetObjects(e),o=this,t=0,n=e;t<n.length;t++)!function(t){o.metadata.addComponent(t.component,o.detailsContent).subscribe(function(e){s.renderedComponents.push(e),e.instance.componentconfig=t.componentconfig})}(n[t])},__decorate([core_1.ViewChild("detailscontent",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"detailsContent",void 0),__decorate([core_1.Input("selectedDoc"),__metadata("design:type",String)],e.prototype,"docId",void 0),__decorate([core_1.Component({selector:"knowledge-manager-details",template:'<div *ngIf="!selectedBook && docId == \'\'" class="slds-align--absolute-center slds-p-vertical--medium slds-height_full slds-text-heading--medium"><span><system-label label="LBL_MAKE_SELECTION"></system-label></span></div><div *ngIf="selectedBook && docId == \'\'" style="width: 100%"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-text-title--caps slds-p-around--x-small" style="border-radius: 0; height: 52px"><strong><system-label label="LBL_BOOK_DESCRIPTION"></system-label></strong></div><div class="slds-p-around--x-small"><div *ngIf="selectedBook?.html?.length > 0" [innerHTML]="selectedBook?.html"></div><div *ngIf="selectedBook?.html?.length == 0"><system-label label="LBL_NO_DESCRIPTION_FOUND"></system-label></div></div></div><div [hidden]="!docId || docId == \'\'" class="slds-p-around--xxx-small" style="background-color: #fff"><div #detailscontent></div></div><div system-to-bottom *ngIf="model.isLoading" class="slds-align_absolute-center"><system-spinner></system-spinner></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.view,KnowledgeService,services_1.metadata])],e)}();exports.KnowledgeManagerDetails=KnowledgeManagerDetails;var KnowledgeManagerAddModal=function(){function KnowledgeManagerAddModal(e,t,s,o){this.language=e,this.model=t,this.metadata=s,this.knowledgeService=o,this.config={clickable:!0},this.activeTab="tree",this.self={},this.presets={},this.showCopyContainer=!1,this.response=null,this.responseSubject=null,this.model.module="KnowledgeDocuments",this.responseSubject=new rxjs_1.Subject,this.response=this.responseSubject.asObservable()}return Object.defineProperty(KnowledgeManagerAddModal.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManagerAddModal.prototype,"documents",{get:function(){return this.knowledgeService.documents},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManagerAddModal.prototype,"selectedDoc",{get:function(){return this.knowledgeService.selectedDoc},set:function(e){this.knowledgeService.selectedDoc=e,this.knowledgeService.replaceState("/module/KnowledgeDocuments/"+e)},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManagerAddModal.prototype,"isLoading",{get:function(){return this.knowledgeService.isDocumentLoading},enumerable:!1,configurable:!0}),KnowledgeManagerAddModal.prototype.ngAfterViewInit=function(){this.knowledgeService.setActiveModule("KnowledgeBooks")},KnowledgeManagerAddModal.prototype.openNewModal=function(){var t=this;this.model.id="",this.self.destroy(),this.model.addModel("",{},this.presets).subscribe(function(e){t.responseSubject.next(e),t.responseSubject.complete()})},KnowledgeManagerAddModal.prototype.confirmCopy=function(){var t=this;this.copyPresets(),this.model.save(!0).subscribe(function(e){t.responseSubject.next(t.model.data),t.responseSubject.complete()}),this.close()},KnowledgeManagerAddModal.prototype.copyPresets=function(){var e,t=this.model.generateGuid();for(e in this.model.id=t,this.model.data.id=t,this.presets)this.presets.hasOwnProperty(e)&&(this.model.data[e]=this.presets[e])},KnowledgeManagerAddModal.prototype.close=function(){this.self.destroy()},__decorate([core_1.ViewChild("maincontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeManagerAddModal.prototype,"maincontainer",void 0),__decorate([core_1.ViewChild("tabsheadercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeManagerAddModal.prototype,"tabsHeaderContainer",void 0),__decorate([core_1.ViewChild("footerContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeManagerAddModal.prototype,"footerContainer",void 0),__decorate([core_1.Component({selector:"knowledge-manager-add-modal",template:'<system-modal *ngIf="showCopyContainer"><system-modal-header (close)="close()"><system-label label="LBL_NEW_FROM_TEMPLATE"></system-label></system-modal-header><system-modal-content [grow]="true" style="padding: 0; overflow-y: hidden;"><div #maincontainer class="slds-grid" style="height: 100%"><div class="slds-size--1-of-4 slds-border--right slds-grid slds-grid--vertical"><knowledge-book-selector [editable]="false"></knowledge-book-selector><div class="slds-tabs--default slds-grow"><ul #tabsheadercontainer class="slds-tabs--default__nav" role="tablist" style="height: 40px"><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'tree\'}" role="presentation" (click)="activeTab = \'tree\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_CHAPTERS"></system-label></a></li><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'search\'}" role="presentation" (click)="activeTab = \'search\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_SEARCH"></system-label></a></li></ul><div *ngIf="activeTab == \'tree\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="height: calc(100% - 40px); background-color: #fafaf9"><div class="slds-scrollable--y spice-scrollbar" style="height: 100%"><system-tree *ngIf="selectedBook && documents.length > 0 && !isLoading" [config]="config" [sourceList]="documents" [(selectedItem)]="selectedDoc"></system-tree><div *ngIf="isLoading && selectedBook" class="slds-m-top--small"><system-spinner></system-spinner></div><div *ngIf="selectedBook && documents.length == 0 && !isLoading" class="slds-align--absolute-center slds-height_full slds-text-heading--medium"><span><system-label label="MSG_NO_RECORDS_FOUND"></system-label></span></div></div></div><div *ngIf="activeTab == \'search\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="height: calc(100% - 40px); background-color: #fafaf9"><knowledge-documents-search></knowledge-documents-search></div></div></div><div class="slds-size--3-of-4"><knowledge-browser-details [selectedDoc]="selectedDoc" [footerContainer]="footerContainer" [inAddModal]="true"></knowledge-browser-details></div></div></system-modal-content><system-modal-footer><div #footerContainer><button (click)="confirmCopy()" class="slds-button slds-button--brand"><system-label label="LBL_ADD"></system-label></button></div></system-modal-footer></system-modal><system-modal *ngIf="!showCopyContainer" size="small"><system-modal-header (close)="close()"><system-label label="LBL_ADD_DOCUMENT"></system-label></system-modal-header><system-modal-content><div class="slds-grid slds-grid--align-center"><div><button (click)="openNewModal()" class="slds-button slds-button--icon slds-button--icon-border slds-p-around--xx-small slds-align--absolute-center"><system-button-icon icon="new" size="large"></system-button-icon></button><div class="slds-p-around--xx-small"><system-label label="LBL_NEW_BLANK_DOCUMENT"></system-label></div></div><div><button (click)="showCopyContainer = true" class="slds-button slds-button--icon slds-button--icon-border slds-p-around--xx-small slds-align--absolute-center"><system-button-icon icon="copy" size="large"></system-button-icon></button><div class="slds-p-around--xx-small"><system-label label="LBL_NEW_FROM_TEMPLATE"></system-label></div></div></div></system-modal-content><system-modal-footer><button (click)="close()" class="slds-button slds-button--neutral"><system-label label="LBL_CANCEL"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.model,KnowledgeService]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.metadata,KnowledgeService])],KnowledgeManagerAddModal)}();exports.KnowledgeManagerAddModal=KnowledgeManagerAddModal;var KnowledgeManager=function(){function KnowledgeManager(e,t,s,o,n,i,a,l,r,d){this.language=e,this.model=t,this.modal=s,this.backend=o,this.router=n,this.metadata=i,this.navigationTab=a,this.injector=l,this.viewContainerRef=r,this.knowledgeService=d,this.config={canadd:!0,draggable:!0,expandall:!1},this.activeTab="tree",this.model.module="KnowledgeDocuments",this.checkAccess()}return Object.defineProperty(KnowledgeManager.prototype,"selectedBook",{get:function(){return this.knowledgeService.selectedBook},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManager.prototype,"documents",{get:function(){return this.knowledgeService.documents},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManager.prototype,"selectedDoc",{get:function(){return this.knowledgeService.selectedDoc},set:function(e){this.knowledgeService.selectedDoc=e,this.knowledgeService.replaceState("/module/KnowledgeDocuments/"+e)},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManager.prototype,"treeContainerStyle",{get:function(){if(this.tabsHeaderContainer)return{height:"calc(100vh - "+this.tabsHeaderContainer.element.nativeElement.getBoundingClientRect().bottom+"px)"}},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManager.prototype,"detailsContainerStyle",{get:function(){if(this.maincontainer)return{height:"calc(100vh - "+this.maincontainer.element.nativeElement.offsetTop+"px)"}},enumerable:!1,configurable:!0}),Object.defineProperty(KnowledgeManager.prototype,"isLoading",{get:function(){return this.knowledgeService.isDocumentLoading},enumerable:!1,configurable:!0}),KnowledgeManager.prototype.ngAfterViewInit=function(){this.knowledgeService.setActiveModule("KnowledgeBooks"),"KnowledgeManager"==this.navigationTab.activeRoute.path&&this.navigationTab.setTabInfo({displayname:"Knowledge Manager",displayicon:"table"})},KnowledgeManager.prototype.checkAccess=function(){this.metadata.checkModuleAcl(this.model.module,"edit")||this.router.navigate(["module/KnowledgeBooks/browser"]),this.config.canadd=this.metadata.checkModuleAcl(this.model.module,"create")},KnowledgeManager.prototype.handleAddEvent=function(e){var t=this;this.model.id="";var s={parent_id:null!==e?e.id:null,parent_name:null!==e?e.name:"",knowledgebook_id:this.knowledgeService.selectedBook.id,status:"Draft"};this.modal.openModal("KnowledgeManagerAddModal",!0,this.injector).subscribe(function(e){e.instance.presets=s,e.instance.response.subscribe(function(e){"object"==typeof e&&(t.selectedDoc=e.id)})})},KnowledgeManager.prototype.handleTreeDrop=function(t){var s=this;t.newSortSequences&&this.backend.postRequest("module/KnowledgeDocument/List/modifySortSequence",{},t.newSortSequences),t.itemWithNewParent&&(this.backend.save("KnowledgeDocuments",t.itemWithNewParent.id,t.itemWithNewParent),this.knowledgeService.documents.some(function(e){if(e.id===t.id)return e.parent_id=t.parent_id,e.parent_sequence=t.parent_sequence,s.knowledgeService.selectedDoc=t.id,!0}))},__decorate([core_1.ViewChild("maincontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeManager.prototype,"maincontainer",void 0),__decorate([core_1.ViewChild("tabsheadercontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeManager.prototype,"tabsHeaderContainer",void 0),__decorate([core_1.Component({selector:"knowledge-manager",template:'<div #maincontainer class="slds-grid"><div class="slds-size--1-of-4 slds-border--right"><knowledge-book-selector></knowledge-book-selector><div class="slds-tabs--default"><ul #tabsheadercontainer class="slds-tabs--default__nav" role="tablist"><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'tree\'}" role="presentation" (click)="activeTab = \'tree\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_CHAPTERS"></system-label></a></li><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab == \'search\'}" role="presentation" (click)="activeTab = \'search\'"><a class="slds-tabs--default__link" style="cursor: pointer" role="tab" aria-selected="false"><system-label label="LBL_SEARCH"></system-label></a></li></ul><div *ngIf="activeTab == \'tree\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="background-color: #fafaf9"><div [ngStyle]="treeContainerStyle" class="slds-scrollable--y spice-scrollbar"><div *ngIf="selectedBook && documents.length == 0 && !isLoading" class="slds-text-align--center slds-text-heading--small slds-truncate slds-p-top--x-small"><system-label label="MSG_CREATE_FIRST_RECORD"></system-label></div><system-tree *ngIf="selectedBook && !isLoading" [config]="config" [sourceList]="documents" [(selectedItem)]="selectedDoc" (onTreeDrop)="handleTreeDrop($event)" (onItemAdd)="handleAddEvent($event)"></system-tree><div *ngIf="isLoading && selectedBook" class="slds-m-top--small"><system-spinner></system-spinner></div></div></div><div *ngIf="activeTab == \'search\'" class="slds-tabs--default__content slds-show slds-p-vertical--none" role="tabpanel" style="background-color: #fafaf9"><knowledge-documents-search></knowledge-documents-search></div></div></div><div class="slds-size--3-of-4"><div [ngStyle]="detailsContainerStyle" class="slds-scrollable--y spice-scrollbar"><knowledge-manager-details [selectedDoc]="selectedDoc"></knowledge-manager-details></div></div></div>',providers:[services_1.model,KnowledgeService]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.backend,router_1.Router,services_1.metadata,services_1.navigationtab,core_1.Injector,core_1.ViewContainerRef,KnowledgeService])],KnowledgeManager)}();exports.KnowledgeManager=KnowledgeManager;var KnowledgeContainer=function(){function KnowledgeContainer(e,t,s,o,n,i,a,l){this.activatedRoute=e,this.router=t,this.backend=s,this.location=o,this.language=n,this.toast=i,this.navigationtab=a,this.metadata=l,this.module="KnowledgeBooks",this.viewInitialized=!1,this.subscription=new rxjs_1.Subscription,this.routerSubscriber()}return KnowledgeContainer.prototype.ngAfterViewInit=function(){this.viewInitialized=!0,this.renderView()},KnowledgeContainer.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},KnowledgeContainer.prototype.routerSubscriber=function(){var t=this;this.subscription=this.navigationtab.activeRoute$.subscribe(function(e){e=e.params;e.module||t.router.navigate(["module/Home"]),t.module=e.module,e.id&&(t.modelId=e.id),t.viewInitialized&&t.renderView()})},KnowledgeContainer.prototype.renderView=function(){var e,s=this;this.module&&(e=this.metadata.checkModuleAcl(this.module,"edit")?"KnowledgeManager":"KnowledgeBrowser",this.modelId?this.backend.get(this.module,this.modelId).subscribe(function(t){t?(s.metadata.addComponent(e,s.container).subscribe(function(e){switch(s.module){case"KnowledgeBooks":e.instance.knowledgeService.selectedBook=t;break;case"KnowledgeDocuments":e.instance.knowledgeService.selectedDoc=t.id,e.instance.knowledgeService.selectedBook={id:t.knowledgebook_id,name:t.knowledgebook_name}}}),s.navigationtab.setTabInfo({displayname:t.summary_text,displaymodule:s.module})):s.metadata.addComponent(e,s.container)},function(){s.metadata.addComponent(e,s.container),s.location.replaceState("/module/"+s.module),s.toast.sendToast(s.language.getLabel("LBL_ERROR_LOADING_RECORD"),"error")}):this.metadata.addComponent(e,this.container))},__decorate([core_1.ViewChild("knowledgeContainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],KnowledgeContainer.prototype,"container",void 0),__decorate([core_1.Component({selector:"knowledge-container",template:"<div #knowledgeContainer></div>"}),__metadata("design:paramtypes",[router_1.ActivatedRoute,router_1.Router,services_1.backend,common_1.Location,services_1.language,services_1.toast,services_1.navigationtab,services_1.metadata])],KnowledgeContainer)}();exports.KnowledgeContainer=KnowledgeContainer;var KnowledgeReleaseAllButton=function(){function KnowledgeReleaseAllButton(e,t,s,o,n,i){this.language=e,this.model=t,this.modal=s,this.toast=o,this.knowledgeService=n,this.backend=i,this.disabled=!0}return KnowledgeReleaseAllButton.prototype.ngOnInit=function(){var t=this;this.handleDisabled(this.model.isEditing?"edit":"display"),this.model.mode$.subscribe(function(e){t.handleDisabled(e)}),this.model.data$.subscribe(function(e){t.handleDisabled(t.model.isEditing?"edit":"display")})},KnowledgeReleaseAllButton.prototype.execute=function(){var s=this;this.modal.confirm(this.language.getLabel("MSG_RELEASE_ALL_CONFIRM"),this.language.getLabel("LBL_RELEASE_ALL")).subscribe(function(e){e&&s.backend.postRequest("module/KnowledgeDocument/"+s.model.id+"/release/all").subscribe(function(t){t&&t.released&&(s.model.setField("status","Released"),s.knowledgeService.documentsList.forEach(function(e){e.id!=s.model.id&&!t.ids[e.id]||(e.name=e.name.replace(/\(.*\)/g,"")+" (Released)",e.status="Released")}),s.toast.sendToast(s.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"))},function(e){return s.toast.sendToast(s.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error")})})},KnowledgeReleaseAllButton.prototype.handleDisabled=function(e){return"Draft"!=this.model.getFieldValue("status")||this.model.data.acl&&!this.model.checkAccess("edit")?this.disabled=!0:void(this.disabled="edit"==e)},__decorate([core_1.Component({selector:"knowledge-browser",template:'<span><system-label label="LBL_RELEASE_ALL"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.toast,KnowledgeService,services_1.backend])],KnowledgeReleaseAllButton)}();exports.KnowledgeReleaseAllButton=KnowledgeReleaseAllButton;var ModuleKnowledge=function(){function ModuleKnowledge(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,addcomponents_module_1.AddComponentsModule],declarations:[KnowledgeContainer,KnowledgeManagerAddModal,KnowledgeManager,KnowledgeManagerDetails,KnowledgeBrowser,KnowledgeBrowserDetails,KnowledgeBrowserDetailsContainerLeft,KnowledgeBrowserDetailsContainerRight,KnowledgeBookSelector,KnowledgeDocumentsSearch,KnowledgeDocumentRelatedList,KnowledgeDocumentFavorites,KnowledgeReleaseAllButton],providers:[KnowledgeService]})],ModuleKnowledge)}();exports.ModuleKnowledge=ModuleKnowledge;