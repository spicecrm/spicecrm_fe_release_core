"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=require("../Observable"),AsyncSubject_1=require("../AsyncSubject"),map_1=require("../operators/map"),canReportError_1=require("../util/canReportError"),isScheduler_1=require("../util/isScheduler"),isArray_1=require("../util/isArray");function bindNodeCallback(s,t,n){if(t){if(!isScheduler_1.isScheduler(t))return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return bindNodeCallback(s,n).apply(void 0,r).pipe(map_1.map(function(r){return isArray_1.isArray(r)?t.apply(void 0,r):t(r)}))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a={subject:void 0,args:t,callbackFunc:s,scheduler:n,context:this};return new Observable_1.Observable(function(r){var e=a.context,c=a.subject;if(n)return n.schedule(dispatch,0,{params:a,subscriber:r,context:e});if(!c){c=a.subject=new AsyncSubject_1.AsyncSubject;try{s.apply(e,t.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.shift();t?c.error(t):(c.next(r.length<=1?r[0]:r),c.complete())}]))}catch(r){canReportError_1.canReportError(c)?c.error(r):console.warn(r)}}return c.subscribe(r)})}}function dispatch(r){var a=this,e=r.params,t=r.subscriber,c=r.context,s=e.callbackFunc,n=e.args,u=e.scheduler,i=e.subject;if(!i){i=e.subject=new AsyncSubject_1.AsyncSubject;try{s.apply(c,n.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.shift();if(t)a.add(u.schedule(dispatchError,0,{err:t,subject:i}));else{var c=r.length<=1?r[0]:r;a.add(u.schedule(dispatchNext,0,{value:c,subject:i}))}}]))}catch(r){this.add(u.schedule(dispatchError,0,{err:r,subject:i}))}}this.add(i.subscribe(t))}function dispatchNext(r){var e=r.value,t=r.subject;t.next(e),t.complete()}function dispatchError(r){var e=r.err;r.subject.error(e)}exports.bindNodeCallback=bindNodeCallback;