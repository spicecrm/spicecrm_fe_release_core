"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function c(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._unsubscribe=r)}var r;return c.prototype.unsubscribe=function(){var i;if(!this.closed){var r=this,s=r._parentOrParents,t=r._unsubscribe,n=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,s instanceof c)s.remove(this);else if(null!==s)for(var e=0;e<s.length;++e){s[e].remove(this)}if(isFunction_1.isFunction(t))try{t.call(this)}catch(r){i=r instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(r.errors):[r]}if(isArray_1.isArray(n)){e=-1;for(var o=n.length;++e<o;){var u=n[e];if(isObject_1.isObject(u))try{u.unsubscribe()}catch(r){i=i||[],r instanceof UnsubscriptionError_1.UnsubscriptionError?i=i.concat(flattenUnsubscriptionErrors(r.errors)):i.push(r)}}}if(i)throw new UnsubscriptionError_1.UnsubscriptionError(i)}},c.prototype.add=function(r){var i=r;if(!r)return c.EMPTY;switch(typeof r){case"function":i=new c(r);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof c)){var s=i;(i=new c)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var t=i._parentOrParents;if(null===t)i._parentOrParents=this;else if(t instanceof c){if(t===this)return i;i._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return i;t.push(this)}var n=this._subscriptions;return null===n?this._subscriptions=[i]:n.push(i),i},c.prototype.remove=function(r){var i=this._subscriptions;if(i){var s=i.indexOf(r);-1!==s&&i.splice(s,1)}},c.EMPTY=((r=new c).closed=!0,r),c}();function flattenUnsubscriptionErrors(r){return r.reduce(function(r,i){return r.concat(i instanceof UnsubscriptionError_1.UnsubscriptionError?i.errors:i)},[])}exports.Subscription=Subscription;