"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function a(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}var r;return a.prototype.unsubscribe=function(){var i;if(!this.closed){var r=this,s=r._parentOrParents,t=r._ctorUnsubscribe,n=r._unsubscribe,e=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,s instanceof a)s.remove(this);else if(null!==s)for(var o=0;o<s.length;++o){s[o].remove(this)}if(isFunction_1.isFunction(n)){t&&(this._unsubscribe=void 0);try{n.call(this)}catch(r){i=r instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(r.errors):[r]}}if(isArray_1.isArray(e)){o=-1;for(var u=e.length;++o<u;){var c=e[o];if(isObject_1.isObject(c))try{c.unsubscribe()}catch(r){i=i||[],r instanceof UnsubscriptionError_1.UnsubscriptionError?i=i.concat(flattenUnsubscriptionErrors(r.errors)):i.push(r)}}}if(i)throw new UnsubscriptionError_1.UnsubscriptionError(i)}},a.prototype.add=function(r){var i=r;if(!r)return a.EMPTY;switch(typeof r){case"function":i=new a(r);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof a)){var s=i;(i=new a)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var t=i._parentOrParents;if(null===t)i._parentOrParents=this;else if(t instanceof a){if(t===this)return i;i._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return i;t.push(this)}var n=this._subscriptions;return null===n?this._subscriptions=[i]:n.push(i),i},a.prototype.remove=function(r){var i=this._subscriptions;if(i){var s=i.indexOf(r);-1!==s&&i.splice(s,1)}},a.EMPTY=((r=new a).closed=!0,r),a}();function flattenUnsubscriptionErrors(r){return r.reduce(function(r,i){return r.concat(i instanceof UnsubscriptionError_1.UnsubscriptionError?i.errors:i)},[])}exports.Subscription=Subscription;