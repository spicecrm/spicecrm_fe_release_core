"use strict";var __extends=this&&this.__extends||function(){var i=function(r,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])})(r,t)};return function(r,t){function e(){this.constructor=r}i(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("../Subject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");function retryWhen(t){return function(r){return r.lift(new RetryWhenOperator(t,r))}}exports.retryWhen=retryWhen;var RetryWhenOperator=function(){function r(r,t){this.notifier=r,this.source=t}return r.prototype.call=function(r,t){return t.subscribe(new RetryWhenSubscriber(r,this.notifier,this.source))},r}(),RetryWhenSubscriber=function(s){function r(r,t,e){var i=s.call(this,r)||this;return i.notifier=t,i.source=e,i}return __extends(r,s),r.prototype.error=function(r){if(!this.isStopped){var t=this.errors,e=this.retries,i=this.retriesSubscription;if(e)this.errors=null,this.retriesSubscription=null;else{t=new Subject_1.Subject;try{e=(0,this.notifier)(t)}catch(r){return s.prototype.error.call(this,r)}i=subscribeToResult_1.subscribeToResult(this,e)}this._unsubscribeAndRecycle(),this.errors=t,this.retries=e,this.retriesSubscription=i,t.next(r)}},r.prototype._unsubscribe=function(){var r=this.errors,t=this.retriesSubscription;r&&(r.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype.notifyNext=function(r,t,e,i,s){var n=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=n,this.source.subscribe(this)},r}(OuterSubscriber_1.OuterSubscriber);