"use strict";var __extends=this&&this.__extends||function(){var i=function(r,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(r,e)};return function(r,e){function t(){this.constructor=r}i(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("../Subject"),innerSubscribe_1=require("../innerSubscribe");function retryWhen(e){return function(r){return r.lift(new RetryWhenOperator(e,r))}}exports.retryWhen=retryWhen;var RetryWhenOperator=function(){function r(r,e){this.notifier=r,this.source=e}return r.prototype.call=function(r,e){return e.subscribe(new RetryWhenSubscriber(r,this.notifier,this.source))},r}(),RetryWhenSubscriber=function(n){function r(r,e,t){var i=n.call(this,r)||this;return i.notifier=e,i.source=t,i}return __extends(r,n),r.prototype.error=function(r){if(!this.isStopped){var e=this.errors,t=this.retries,i=this.retriesSubscription;if(t)this.errors=void 0,this.retriesSubscription=void 0;else{e=new Subject_1.Subject;try{t=(0,this.notifier)(e)}catch(r){return n.prototype.error.call(this,r)}i=innerSubscribe_1.innerSubscribe(t,new innerSubscribe_1.SimpleInnerSubscriber(this))}this._unsubscribeAndRecycle(),this.errors=e,this.retries=t,this.retriesSubscription=i,e.next(r)}},r.prototype._unsubscribe=function(){var r=this.errors,e=this.retriesSubscription;r&&(r.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var r=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=r,this.source.subscribe(this)},r}(innerSubscribe_1.SimpleOuterSubscriber);