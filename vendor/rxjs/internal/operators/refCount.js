"use strict";var __extends=this&&this.__extends||function(){var r=function(n,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])})(n,t)};return function(n,t){function e(){this.constructor=n}r(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=require("../Subscriber");function refCount(){return function(n){return n.lift(new RefCountOperator(n))}}exports.refCount=refCount;var RefCountOperator=function(){function n(n){this.connectable=n}return n.prototype.call=function(n,t){var e=this.connectable;e._refCount++;var r=new RefCountSubscriber(n,e),o=t.subscribe(r);return r.closed||(r.connection=e.connect()),o},n}(),RefCountSubscriber=function(r){function n(n,t){var e=r.call(this,n)||this;return e.connectable=t,e}return __extends(n,r),n.prototype._unsubscribe=function(){var n=this.connectable;if(n){this.connectable=null;var t=n._refCount;if(t<=0)this.connection=null;else if(n._refCount=t-1,1<t)this.connection=null;else{var e=this.connection,r=n._connection;this.connection=null,!r||e&&r!==e||r.unsubscribe()}}else this.connection=null},n}(Subscriber_1.Subscriber);