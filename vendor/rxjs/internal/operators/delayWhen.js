"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subscriber_1=require("../Subscriber"),Observable_1=require("../Observable"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");function delayWhen(t,r){return r?function(e){return new SubscriptionDelayObservable(e,r).lift(new DelayWhenOperator(t))}:function(e){return e.lift(new DelayWhenOperator(t))}}exports.delayWhen=delayWhen;var DelayWhenOperator=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new DelayWhenSubscriber(e,this.delayDurationSelector))},e}(),DelayWhenSubscriber=function(i){function e(e,t){var r=i.call(this,e)||this;return r.delayDurationSelector=t,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return __extends(e,i),e.prototype.notifyNext=function(e,t,r,i,o){this.destination.next(e),this.removeSubscription(o),this.tryComplete()},e.prototype.notifyError=function(e,t){this._error(e)},e.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},e.prototype._next=function(e){var t=this.index++;try{var r=this.delayDurationSelector(e,t);r&&this.tryDelay(r,e)}catch(e){this.destination.error(e)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},e.prototype.tryDelay=function(e,t){var r=subscribeToResult_1.subscribeToResult(this,e,t);r&&!r.closed&&(this.destination.add(r),this.delayNotifierSubscriptions.push(r))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(OuterSubscriber_1.OuterSubscriber),SubscriptionDelayObservable=function(i){function e(e,t){var r=i.call(this)||this;return r.source=e,r.subscriptionDelay=t,r}return __extends(e,i),e.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new SubscriptionDelaySubscriber(e,this.source))},e}(Observable_1.Observable),SubscriptionDelaySubscriber=function(i){function e(e,t){var r=i.call(this)||this;return r.parent=e,r.source=t,r.sourceSubscribed=!1,r}return __extends(e,i),e.prototype._next=function(e){this.subscribeToSource()},e.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(Subscriber_1.Subscriber);