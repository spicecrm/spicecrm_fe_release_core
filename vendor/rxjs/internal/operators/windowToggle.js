"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("../Subject"),Subscription_1=require("../Subscription"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");function windowToggle(e,o){return function(t){return t.lift(new WindowToggleOperator(e,o))}}exports.windowToggle=windowToggle;var WindowToggleOperator=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new WindowToggleSubscriber(t,this.openings,this.closingSelector))},t}(),WindowToggleSubscriber=function(i){function t(t,e,o){var r=i.call(this,t)||this;return r.openings=e,r.closingSelector=o,r.contexts=[],r.add(r.openSubscription=subscribeToResult_1.subscribeToResult(r,e,e)),r}return __extends(t,i),t.prototype._next=function(t){var e=this.contexts;if(e)for(var o=e.length,r=0;r<o;r++)e[r].window.next(t)},t.prototype._error=function(t){var e=this.contexts;if(this.contexts=null,e)for(var o=e.length,r=-1;++r<o;){var n=e[r];n.window.error(t),n.subscription.unsubscribe()}i.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,o=-1;++o<e;){var r=t[o];r.window.complete(),r.subscription.unsubscribe()}i.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,o=-1;++o<e;){var r=t[o];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(t,e,o,r,n){if(t===this.openings){var i=void 0;try{i=(0,this.closingSelector)(e)}catch(t){return this.error(t)}var s=new Subject_1.Subject,c=new Subscription_1.Subscription,u={window:s,subscription:c};this.contexts.push(u);var p=subscribeToResult_1.subscribeToResult(this,i,u);p.closed?this.closeWindow(this.contexts.length-1):(p.context=u,c.add(p)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(t))},t.prototype.notifyError=function(t){this.error(t)},t.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},t.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,o=e[t],r=o.window,n=o.subscription;e.splice(t,1),r.complete(),n.unsubscribe()}},t}(OuterSubscriber_1.OuterSubscriber);