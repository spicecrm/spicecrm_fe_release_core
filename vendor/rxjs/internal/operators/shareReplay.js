"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReplaySubject_1=require("../ReplaySubject");function shareReplay(e,r,t){var u;return u=e&&"object"==typeof e?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:t},function(e){return e.lift(shareReplayOperator(u))}}function shareReplayOperator(e){var t,u,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=e.windowTime,n=void 0===o?Number.POSITIVE_INFINITY:o,s=e.refCount,c=e.scheduler,a=0,b=!1,f=!1;return function(e){var r;a++,!t||b?(b=!1,t=new ReplaySubject_1.ReplaySubject(i,n,c),r=t.subscribe(this),u=e.subscribe({next:function(e){t.next(e)},error:function(e){b=!0,t.error(e)},complete:function(){f=!0,u=void 0,t.complete()}}),f&&(u=void 0)):r=t.subscribe(this),this.add(function(){a--,r.unsubscribe(),r=void 0,u&&!f&&s&&0===a&&(u.unsubscribe(),t=u=void 0)})}}exports.shareReplay=shareReplay;