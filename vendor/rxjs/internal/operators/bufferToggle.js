"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subscription_1=require("../Subscription"),subscribeToResult_1=require("../util/subscribeToResult"),OuterSubscriber_1=require("../OuterSubscriber");function bufferToggle(e,r){return function(t){return t.lift(new BufferToggleOperator(e,r))}}exports.bufferToggle=bufferToggle;var BufferToggleOperator=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new BufferToggleSubscriber(t,this.openings,this.closingSelector))},t}(),BufferToggleSubscriber=function(s){function t(t,e,r){var o=s.call(this,t)||this;return o.closingSelector=r,o.contexts=[],o.add(subscribeToResult_1.subscribeToResult(o,e)),o}return __extends(t,s),t.prototype._next=function(t){for(var e=this.contexts,r=e.length,o=0;o<r;o++)e[o].buffer.push(t)},t.prototype._error=function(t){for(var e=this.contexts;0<e.length;){var r=e.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,s.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;0<t.length;){var e=t.shift();this.destination.next(e.buffer),e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,s.prototype._complete.call(this)},t.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},t.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},t.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},t.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var r=t.buffer,o=t.subscription;this.destination.next(r),e.splice(e.indexOf(t),1),this.remove(o),o.unsubscribe()}},t.prototype.trySubscribe=function(t){var e=this.contexts,r=new Subscription_1.Subscription,o={buffer:[],subscription:r};e.push(o);var s=subscribeToResult_1.subscribeToResult(this,t,o);!s||s.closed?this.closeBuffer(o):(s.context=o,this.add(s),r.add(s))},t}(OuterSubscriber_1.OuterSubscriber);