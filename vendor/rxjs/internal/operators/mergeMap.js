"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var map_1=require("./map"),from_1=require("../observable/from"),innerSubscribe_1=require("../innerSubscribe");function mergeMap(t,i,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof i?function(e){return e.pipe(mergeMap(function(r,n){return from_1.from(t(r,n)).pipe(map_1.map(function(e,t){return i(r,e,n,t)}))},r))}:("number"==typeof i&&(r=i),function(e){return e.lift(new MergeMapOperator(t,r))})}exports.mergeMap=mergeMap;var MergeMapOperator=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new MergeMapSubscriber(e,this.project,this.concurrent))},e}();exports.MergeMapOperator=MergeMapOperator;var MergeMapSubscriber=function(i){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var n=i.call(this,e)||this;return n.project=t,n.concurrent=r,n.hasCompleted=!1,n.buffer=[],n.active=0,n.index=0,n}return __extends(e,i),e.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},e.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},e.prototype._innerSub=function(e){var t=new innerSubscribe_1.SimpleInnerSubscriber(this),r=this.destination;r.add(t);var n=innerSubscribe_1.innerSubscribe(e,t);n!==t&&r.add(n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(e){this.destination.next(e)},e.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(innerSubscribe_1.SimpleOuterSubscriber);exports.MergeMapSubscriber=MergeMapSubscriber,exports.flatMap=mergeMap;