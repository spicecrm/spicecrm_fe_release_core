"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var subscribeToResult_1=require("../util/subscribeToResult"),OuterSubscriber_1=require("../OuterSubscriber"),InnerSubscriber_1=require("../InnerSubscriber");function mergeScan(e,r,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(t){return t.lift(new MergeScanOperator(e,r,i))}}exports.mergeScan=mergeScan;var MergeScanOperator=function(){function t(t,e,r){this.accumulator=t,this.seed=e,this.concurrent=r}return t.prototype.call=function(t,e){return e.subscribe(new MergeScanSubscriber(t,this.accumulator,this.seed,this.concurrent))},t}();exports.MergeScanOperator=MergeScanOperator;var MergeScanSubscriber=function(s){function t(t,e,r,i){var n=s.call(this,t)||this;return n.accumulator=e,n.acc=r,n.concurrent=i,n.hasValue=!1,n.hasCompleted=!1,n.buffer=[],n.active=0,n.index=0,n}return __extends(t,s),t.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,r=this.destination,i=void 0;try{i=(0,this.accumulator)(this.acc,t,e)}catch(t){return r.error(t)}this.active++,this._innerSub(i,t,e)}else this.buffer.push(t)},t.prototype._innerSub=function(t,e,r){var i=new InnerSubscriber_1.InnerSubscriber(this,e,r),n=this.destination;n.add(i);var s=subscribeToResult_1.subscribeToResult(this,t,void 0,void 0,i);s!==i&&n.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(t,e,r,i,n){var s=this.destination;this.acc=e,this.hasValue=!0,s.next(e)},t.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(OuterSubscriber_1.OuterSubscriber);exports.MergeScanSubscriber=MergeScanSubscriber;