"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),innerSubscribe_1=require("../innerSubscribe");function timeoutWith(r,s,n){return void 0===n&&(n=async_1.async),function(t){var e=isDate_1.isDate(r),i=e?+r-n.now():Math.abs(r);return t.lift(new TimeoutWithOperator(i,e,s,n))}}exports.timeoutWith=timeoutWith;var TimeoutWithOperator=function(){function t(t,e,i,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new TimeoutWithSubscriber(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),TimeoutWithSubscriber=function(u){function e(t,e,i,r,s){var n=u.call(this,t)||this;return n.absoluteTimeout=e,n.waitFor=i,n.withObservable=r,n.scheduler=s,n.scheduleTimeout(),n}return __extends(e,u),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(innerSubscribe_1.innerSubscribe(e,new innerSubscribe_1.SimpleInnerSubscriber(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),u.prototype._next.call(this,t)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}(innerSubscribe_1.SimpleOuterSubscriber);