"use strict";var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("../Subject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");function windowWhen(o){return function(t){return t.lift(new WindowOperator(o))}}exports.windowWhen=windowWhen;var WindowOperator=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,o){return o.subscribe(new WindowSubscriber(t,this.closingSelector))},t}(),WindowSubscriber=function(e){function t(t,o){var i=e.call(this,t)||this;return i.destination=t,i.closingSelector=o,i.openWindow(),i}return __extends(t,e),t.prototype.notifyNext=function(t,o,i,e,n){this.openWindow(n)},t.prototype.notifyError=function(t,o){this._error(t)},t.prototype.notifyComplete=function(t){this.openWindow(t)},t.prototype._next=function(t){this.window.next(t)},t.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var o=this.window;o&&o.complete();var i,e=this.window=new Subject_1.Subject;this.destination.next(e);try{i=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=subscribeToResult_1.subscribeToResult(this,i))},t}(OuterSubscriber_1.OuterSubscriber);